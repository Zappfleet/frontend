import{r as b,T as he,u as ce,D as ge,U as ye,j as M,c as s,V as xe,W as ve,X as be,k as ke,p as Se,l as we,Y as Ee,Z as Ne,F as _e,e as Oe,_ as Ce,i as ee,$ as De,a0 as X,a1 as Me,y as Pe,f as te}from"./index-4b638fea.js";import{M as je}from"./MapContainer-a1f86b32.js";import{M as Te}from"./marker-red-cc8765ae.js";import{B as Ae}from"./BottomSheetModal-a3284b58.js";import{L as Ie}from"./LocationSearch-0c7343c4.js";import{u as Ye}from"./useNeshanApi-69a62daf.js";import{u as Re}from"./useVehicleBasicData-dc6e97f6.js";import{r as U}from"./renderUi-10abc2ba.js";import{U as Ue}from"./UsersSuggestionInput-a4d8adf9.js";import{u as Fe}from"./useFavorite-7253379e.js";var de={};Object.defineProperty(de,"__esModule",{value:!0});var Q=b,Le=he;function se(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var u=se(Q),Z=se(Le);function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,o)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ne(Object(n),!0).forEach(function(o){ze(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function ze(e,t,n){return(t=function(o){var r=function(c,l){if(typeof c!="object"||c===null)return c;var d=c[Symbol.toPrimitive];if(d!==void 0){var i=d.call(c,l||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(c)}(o,"string");return typeof r=="symbol"?r:String(r)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function J(e,t){return function(n){if(Array.isArray(n))return n}(e)||function(n,o){var r=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(r!=null){var c,l,d,i,f=[],S=!0,m=!1;try{if(d=(r=r.call(n)).next,o===0){if(Object(r)!==r)return;S=!1}else for(;!(S=(c=d.call(r)).done)&&(f.push(c.value),f.length!==o);S=!0);}catch(y){m=!0,l=y}finally{try{if(!S&&r.return!=null&&(i=r.return(),Object(i)!==i))return}finally{if(m)throw l}}return f}}(e,t)||ue(e,t)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function ue(e,t){if(e){if(typeof e=="string")return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(e,t):void 0}}function re(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ae(e){var t=e.direction,n=e.onClick,o=e.disabled;return u.default.createElement("button",{type:"button",className:"rmdp-arrow-container ".concat(t," ").concat(o?"disabled":""),onClick:n,"aria-roledescription":"button to navigate ".concat(t.replace("rmdp-",""))},u.default.createElement("i",{className:"rmdp-arrow"}))}function Be(e){var t=e.max,n=e.name,o=e.value,r=e.onChange,c=e.digits;return u.default.createElement("input",{type:"text",name:n,value:o,onChange:function(d){var i=l(d.target.value);isNaN(i)||t&&Number(i)>t||r(n,i)},onKeyDown:function(d){var i;if(d.key==="ArrowUp")i=1;else{if(d.key!=="ArrowDown")return;i=-1}r(n,l(o)+i)}});function l(d){var i,f=function(m,y){var k=typeof Symbol<"u"&&m[Symbol.iterator]||m["@@iterator"];if(!k){if(Array.isArray(m)||(k=ue(m))||y&&m&&typeof m.length=="number"){k&&(m=k);var C=0,h=function(){};return{s:h,n:function(){return C>=m.length?{done:!0}:{done:!1,value:m[C++]}},e:function(x){throw x},f:h}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D,j=!0,T=!1;return{s:function(){k=k.call(m)},n:function(){var x=k.next();return j=x.done,x},e:function(x){T=!0,D=x},f:function(){try{j||k.return==null||k.return()}finally{if(T)throw D}}}}(c);try{for(f.s();!(i=f.n()).done;){var S=i.value;d=d.replace(S,c.indexOf(S))}}catch(m){f.e(m)}finally{f.f()}return Number(d)}}function G(e){return Array.isArray(e)}function qe(e){var t=e.selectedDate,n=e.focused,o=e.handleFocusedDate,r=e.state,c=e.setState,l=e.format;return Q.useEffect(function(){G(t)&&t.length!==0&&(n||d(G(t[0])?t[0][0]:t[0]))},[n,t,d]),G(t)&&u.default.createElement("div",{style:{display:"flex",padding:"5px 0"}},u.default.createElement("select",{className:"rmdp-input",style:{height:"26px",width:"90%",margin:"auto"},value:(n==null?void 0:n.day)||"",onChange:function(i){return d(t.flat().find(function(f){return f.day.toString()===i.target.value}))}},t.flat().map(function(i){return u.default.createElement("option",{key:i.day,value:i.day},i.format(l))})));function d(i){c($($({},r),{},{focused:i})),o(i)}}function oe(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"YYYY/MM/DD";return e instanceof Z.default?e.set({calendar:t,format:n}):e=new Z.default({date:e,calendar:t,format:n}),e}function me(e,t){t===void 0&&(t={});var n=t.insertAt;if(e&&typeof document<"u"){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n==="top"&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}me(".rmdp-analog-clock{background-color:#83cbe7;border:5px solid #09589e;border-radius:50%;height:130px;margin:auto 20px;position:relative;width:130px}.bottom .rmdp-analog-clock,.top .rmdp-analog-clock{margin:20px auto}.rmdp-analog-clock .dot{background-color:#ccc;border-radius:50%;bottom:0;box-shadow:0 2px 4px -1px #000;height:8px;left:0;margin:auto;position:absolute;right:0;top:0;width:8px;z-index:10}.rmdp-analog-clock .rmdp-hour{background-color:#333;height:30px;top:35px;transform-origin:50% 30px;z-index:5}.rmdp-analog-clock .rmdp-hour,.rmdp-analog-clock .rmdp-minute{border-top-left-radius:50%;border-top-right-radius:50%;left:50%;margin-left:-2px;position:absolute;width:4px}.rmdp-analog-clock .rmdp-minute{background-color:#666;height:55px;top:14px;transform-origin:50% 52px;z-index:6}.rmdp-analog-clock .rmdp-second{background-color:#0074d9;border-top-left-radius:50%;border-top-right-radius:50%;height:60px;left:50%;margin-left:-1px;position:absolute;top:10px;transform-origin:50% 55px;width:2px;z-index:7}.rmdp-analog-clock span{color:#333;display:inline-block;font-family:Arial;font-size:16px;font-weight:700;position:absolute;z-index:4}.rmdp-analog-clock .rmdp-h12{left:50%;margin-left:-9px;top:10px}.rmdp-analog-clock .rmdp-h3{right:10px;top:58px}.rmdp-analog-clock .rmdp-h6{bottom:7px;left:50%;margin-left:-4px}.rmdp-analog-clock .rmdp-h9{left:10px;top:58px}.rmdp-analog-clock .dial-lines{background-color:#4ca6f5;height:5px;left:50%;margin-left:-1px;position:absolute;transform-origin:50% 65px;width:2px;z-index:2}.rmdp-analog-clock .dial-lines:nth-of-type(5n){background-color:#0074d9;height:8px;width:3px}@media (max-height:400px),(max-width:400px){.rmdp-analog-clock{height:100px;margin:20px 10px;width:100px}.rmdp-analog-clock .dial-lines{height:3px;transform-origin:50% 50px;width:1px}.rmdp-analog-clock .dial-lines:nth-of-type(5n){background-color:#0074d9;height:5px;width:2px}.rmdp-analog-clock span{font-size:12px;font-weight:400}.rmdp-analog-clock .rmdp-h12{top:6px}.rmdp-analog-clock .rmdp-h3{right:7px;top:41px}.rmdp-analog-clock .rmdp-h6{bottom:6px}.rmdp-analog-clock .rmdp-h9{left:7px;top:41px}.rmdp-analog-clock .rmdp-hour{height:20px;top:30px;transform-origin:50% 20px}.rmdp-analog-clock .rmdp-minute{height:28px;top:19px;transform-origin:50% 31px}.rmdp-analog-clock .rmdp-second{height:33px;top:16px;transform-origin:50% 35px}.rmdp-analog-clock .dot{box-shadow:0 2px 4px -1px #000;height:7px;width:7px}}");me(".rmdp-time-picker.left div,.rmdp-time-picker.right div{margin:auto}.rmdp-time-picker{display:flex;padding:3px 0}.rmdp-time-picker.active{display:flex}.rmdp-time-picker div{align-items:center;display:flex;flex:1;flex-direction:column;margin-top:1px}.rmdp-time-picker div input{border:none;flex-grow:1;font-size:14px;padding:5px 2px;text-align:center;width:20px}.rmdp-time-picker div input::-webkit-inner-spin-button,.rmdp-time-picker div input::-webkit-outer-spin-button{-webkit-appearance:none}.rmdp-time-picker div input[type=number]{-moz-appearance:textfield}.rmdp-time-picker .dvdr{display:flex;flex-direction:column;justify-content:center;margin-top:-5px}.rmdp-time-picker div .rmdp-am{color:#000;font-size:13px;line-height:22px;margin-top:2px}.rmdp-only-time-picker{margin-bottom:0;width:220px}.rmdp-up i{margin-top:7px;transform:rotate(-135deg);-webkit-transform:rotate(-135deg)}.rmdp-down i{margin-top:3px;transform:rotate(45deg);-webkit-transform:rotate(45deg)}@media (max-height:400px),(max-width:400px){.rmdp-time-picker div input{font-size:12px}.rmdp-time-picker div .rmdp-am{font-size:12px;line-height:22px}}");var ie=function(e){return"rotate(".concat(e,"deg)")},le=[["hour","HH",24],["minute","mm",60],["second","ss",60]];function $e(e){var t=e.max,n=e.name,o=J(e.values,2),r=o[0],c=o[1],l=e.update,d=e.digits,i=e.hideDivider,f=e.step;return u.default.createElement(u.default.Fragment,null,u.default.createElement("div",null,u.default.createElement(ae,{direction:"rmdp-up",onClick:function(){return l(n,r+f)}}),u.default.createElement(Be,{max:t,value:c,onChange:l,digits:d,name:n}),u.default.createElement(ae,{direction:"rmdp-down",onClick:function(){return l(n,r-f)}})),!i&&u.default.createElement("span",{className:"dvdr"},":"))}var He=de.default=function(e){var t=e.state,n=e.setState,o=e.handleChange,r=e.handleFocusedDate,c=e.format,l=c===void 0?"YYYY/MM/DD":c,d=e.position,i=e.calendarProps.disableDayPicker,f=e.hideSeconds,S=e.hStep,m=S===void 0?1:S,y=e.mStep,k=y===void 0?1:y,C=e.sStep,h=C===void 0?1:C,D=e.minDate,j=e.maxDate,T=t.date,x=t.selectedDate,w=t.multiple,Y=t.range,A=t.focused,E=(w||Y?A:x)||T,F=E.hour,R=E.minute,L=E.second,H={hour:30*F+.5*R,minute:6*R+.1*L,second:6*L},K=Q.useMemo(function(){return Array.from(Array(60).keys()).map(function(g){return u.default.createElement("div",{key:g,className:"dial-lines",style:{transform:ie(6*(g+1))}})})},[]),V=["3","6","9","12"].map(function(g,O){return u.default.createElement("span",{key:O,className:"rmdp-h"+g},g.replace(/[0-9]/g,function(N){return T.digits[N]}))});return u.default.createElement("div",{className:d,style:{display:"grid",minWidth:i?"180px":""}},u.default.createElement("div",{className:"rmdp-analog-clock"},u.default.createElement("div",{className:"dot"}),u.default.createElement("div",null,le.map(function(g,O){var N=J(g,1)[0];return N==="second"&&f?null:u.default.createElement("div",{key:O,style:{transform:ie(H[N])},className:"rmdp-".concat(N)})})),u.default.createElement("div",null,V),u.default.createElement("div",null,K)),Array.isArray(x)&&u.default.createElement(qe,{selectedDate:x,focused:A,handleFocusedDate:r,state:t,setState:n,format:l}),u.default.createElement("div",{style:{margin:"auto 0"}},u.default.createElement("div",{className:"rmdp-time-picker"},le.map(function(g,O){var N=J(g,3),P=N[0],B=N[1],q=N[2];if(P==="second"&&f)return null;var a=1;switch(P){case"hour":a=m;break;case"minute":a=k;break;case"second":a=h}return u.default.createElement($e,{max:q,key:O,name:P,step:a,values:z(P,B),update:W,digits:T.digits,hideDivider:P==="second"||P==="minute"&&f})}))));function z(g,O){return E[g]||(E[g]=0),[E[g],E.format(O)]}function W(g,O){var N=new Z.default(E).set(g,O);D&&N<oe(D,t.calendar,t.format)||j&&N>oe(j,t.calendar,t.format)||(E[g]=O,o(x,$($({},t),{},{selectedDate:x,focused:A})))}};function Ke(e){var r;const{authInfo:t}=ce(),[n,o]=b.useState(null);return b.useEffect(()=>{var c,l,d;((d=(l=(c=t==null?void 0:t.auth)==null?void 0:c.roles)==null?void 0:l.filter(i=>i.title===ge))==null?void 0:d.length)===1&&o(ye(new Date).format("jYYYY/jMM/jDD - HH:mm"))},[t]),M("div",{children:[s("label",{children:e.title}),U(s("input",{className:"form-control",...e,name:e.inputKey})).if(e.type==xe||e.type==ve),U(s("select",{...e,name:e.inputKey,children:(r=e.options)==null?void 0:r.map(c=>s("option",{value:c.key,children:c.title},c.key))})).if(e.type==be),U(s("div",{children:s(ke,{...e,onChange:c=>{e.onChange({target:{name:e.inputKey,value:c}})},dateSeparator:" , ",calendar:Se,locale:we,format:e.format||"YYYY/MM/DD - HH:mm",className:"datetime-picker",inputClass:"datetime-input",minDate:n,plugins:e.hideTime?[]:[s(He,{hideSeconds:!0})]})})).if(e.type==Ee),U(s("div",{children:s(Ue,{...e,name:e.inputKey,freeInput:!1,permissions:["SERVICE.PERSONAL.SUBMIT"],include_external_base:!0})})).if(e.type==Ne)]})}function Ve({fields:e,onInputChange:t,mode:n,formState:o}){return s(_e,{children:e==null?void 0:e.map(r=>U(b.createElement(Ke,{...r,value:o[r.key],onChange:t,key:r.key,inputKey:r.key})).if(r.mode==null||r.mode==n))})}const pe="user-only",We="admin-only",Xe=(e={})=>{var P,B,q;console.log(5);const{result:t}=Fe(!0,"select",null),{mode:n=pe}=e,o=b.useState(e.initialValues||{}),r=b.useState({locations:[]}),c=Oe(),{type:l,submitted_by:d,mode:i,initialLocations:f,initialValues:S,className:m}=c.state||{},[y,k]=(e==null?void 0:e.externalState)!=null?e.externalState:o,{authInfo:C}=ce();b.useEffect(()=>{},[C]),b.useEffect(()=>{l==="update"&&k(S)},[l]),b.useEffect(()=>{},[y]);const[h,D]=(e==null?void 0:e.externalUserInput)!=null?e.externalUserInput:r;b.useEffect(()=>{},[h]);const{searchState:j,reverseGeocoding:T}=Ye(),{data:x}=Re({include_inactive:!1}),w=b.useRef(),Y=b.useRef(),A=b.useRef({polyline:null}),[E,F]=b.useState({readyForSubmit:!1});b.useEffect(()=>{R(h.locations)},[h]),b.useEffect(()=>{if(l===void 0&&e.initialLocations==null)return;const a=l&&l==="update"?f:e.initialLocations.map(({address:p,lat:_,lng:v})=>{var I;return{address:p,lat:_,lng:v,marker:(I=w.current)==null?void 0:I.addMarker(v,_,!0)}});D({...h,locations:a}),F({...E,readyForSubmit:a.length>1})},[]);const R=a=>{if(!(j.inProgress||w.current==null)){if(A.current.polyline!=null&&(w.current.remove(A.current.polyline.polyline),A.current.polyline=null),(a||h.locations).length>1){const p=w.current.addPolyline((a||h.locations).map(_=>[_.lng,_.lat]),!0,Ce);if(p==null)return;A.current.polyline=p}F({...E,readyForSubmit:a.length>1})}},L=()=>{if(j.inProgress||w.current==null)return;const a=w.current.addMarkerToCenter();if(a==null)return;const[p,_]=a.coordinates;T(_,p).then(v=>{D({...h,locations:[{address:v.formatted_address,lng:p,lat:_,marker:a.marker},...h.locations]})}).catch(v=>{var I;(I=w.current)==null||I.remove(a.marker)})},H=a=>{var v;const p=h.locations[a];(v=w.current)==null||v.remove(p.marker),h.locations.splice(a,1);const _=[...h.locations];D({...h,locations:_})},K=a=>{Y.current=a},V=()=>{Y.current.show()},z=()=>{Y.current.hide()},W=()=>{h.locations.map(({marker:a})=>{var p;(p=w.current)==null||p.remove(a)}),D({...h,locations:[]}),R([])},g=a=>{console.log(1),a.preventDefault();const p=fe(y,h,l,d);console.log(2,e.overrideOnSubmit,p,y._id),e.overrideOnSubmit!=null&&(e.overrideOnSubmit(p,y._id),z());const _=y._id==null?"submitRequest":"updateRequest";Pe()[_](p,y._id).then(({data:v})=>{console.log(320,v),te.showSuccess("اطلاعات با موفقیت ذخیره شد"),k({}),W(),z(),e.submitCallback!=null&&e.submitCallback(v)}).catch(v=>{te.showError(v.response.data.error)})},O=a=>{k({...y,[a.target.name]:a.target.value})},N=a=>{var v,I;const[p,_]=(v=a==null?void 0:a.location)==null?void 0:v.coordinates;(I=w.current)==null||I.viewCoordinates(p,_,16)};return s("div",{className:"PassengerServiceRequest-page",children:M("div",{className:`main-div ${l==="update"?m:""}`,children:[s(je,{mapRef:w}),s("img",{className:"absolute bottom-2/4 left-2/4 w-8 -translate-x-2/4",src:Te}),s(Ie,{mapRef:w,className:"absolute left-0 right-0 top-0 z-50 m-2 flex "}),s("div",{className:"showFavoriteLocation",children:(P=t==null?void 0:t.data)==null?void 0:P.map((a,p)=>s("div",{onClick:()=>N(a),className:"favorite-name",children:a.name},p))}),M("div",{className:"loc-name-div",children:[h.locations.map((a,p)=>s("div",{className:"loc-name",children:M("span",{children:[s("i",{className:"fa fa-remove loc-remove",onClick:()=>H(p)}),s("span",{children:a.address})]},`${a.lat}${a.lng}`)})),M("span",{className:"flex-center",children:[M("button",{onClick:L,className:"my-btn",children:[s("i",{className:"fas fa-thumbtack"})," انتخاب ایستگاه"]}),s("button",{onClick:V,className:ee("m-2 flex h-14 w-14 cursor-pointer items-center justify-center rounded-full bg-success p-3 text-primary text-white shadow duration-300 active:saturate-50",{"scale-100":E.readyForSubmit,"scale-0":!E.readyForSubmit}),children:s(De,{className:ee("absolute p-0.5 text-white duration-200"),size:40})})]})]}),s(Ae,{onCreate:K,children:M("div",{children:[M("form",{children:[M("div",{className:"mb-2",children:[s("label",{className:"inline-block py-2",children:"سرویس"}),M("select",{value:y.service||X,onChange:O,name:"service",className:"select-box w-full flex-1",children:[s("option",{disabled:!0,value:X,children:"--- سرویس مورد نظر را انتخاب کنید ---"},X),(B=x==null?void 0:x.services)==null?void 0:B.map(a=>s("option",{value:a.key,children:`${a.title}`},a.key))]})]}),s(Ve,{formState:y,fields:(q=C==null?void 0:C.org)==null?void 0:q.additionalRequestFields,onInputChange:O,mode:n})]}),s(Me,{onClick:g,className:"my-3 w-full",children:e.overrideOnSubmit!=null?"تایید":l&&l==="update"?"بروزرسانی":"ثبت درخواست"})]})})]})})};function fe(e,t,n,o){const r={},{service:c,datetime:l,...d}=e;return console.log(414141,c,e),l!=null&&(r.gmt_for_date=Array.isArray(l)?l.map(i=>typeof i=="string"||i instanceof String?i:i.toDate().toISOString()):[l]),r.details=d,r.service=c,r.locations=t.locations.map(i=>{const{lng:f,lat:S,...m}=i;return delete m.marker,{coordinates:[S,f],wait:0,meta:m}}),r.type=n&&n==="update"?n:"",r.submitted_by=n&&n==="update"?o:"",r}const it=Object.freeze(Object.defineProperty({__proto__:null,MODE_ADMIN_ONLY:We,MODE_USER_ONLY:pe,buildRequestBody:fe,default:Xe},Symbol.toStringTag,{value:"Module"}));export{pe as M,Xe as P,He as _,Ve as a,fe as b,We as c,it as d};
