import{r as s,u as We,U as h,f as j,be as Ke,bd as Qe,j as c,c as a,F as M,ar as Xe,l as O,p as H,m as U,bw as Ze,bx as ea,by as aa,bz as ta,bc as G}from"./index-0b0339af.js";import{O as Ne,F as ge}from"./FileUpload-63cbe117.js";import{u as sa}from"./useCarteSalahiyat-c616d860.js";import{c as L}from"./dateTools-2ed79b68.js";import{u as la}from"./useAganceDriver-234fe48a.js";import{u as na}from"./validation-2a5d93f1.js";import{P as ca}from"./Page403-a9be83c6.js";import{H as Me}from"./HTMLProcessor-1d27b86a.js";import"./style-65f980a9.js";const ia={fishNumber:{required:!0,showName:"شماره فیش"},fishPrice:{required:!0,showName:"مبلغ فیش"},fishDate:{required:!0,showName:"تاریخ فیش"},attachFile:{required:!0,showName:"تصویر درخواست تمدید یا معرفی نامه محل فعالیت  "}},ye={fishNumber:"",fishPrice:"",fishDate:"",attachFile:void 0},Sa=({handleBackClick:q,title:C})=>{var ie,re,oe,me,he,ue,fe,de,pe,Ye,De;const[l,je]=s.useState(null),[v,Fe]=s.useState({}),[z,Se]=s.useState(null);s.useEffect(()=>{ne(),fetch("/zarghanFiles/carteSalahiyat/carteSalahiyat.htm").then(e=>e.text()).then(e=>{Se(e)}).catch(e=>console.error(e))},[]),C="صدور کارت صلاحیت";const[we,Ae]=s.useState(!1),{authInfo:w}=We(),[Ce,ve]=s.useState(""),[B,Te]=s.useState({CREATE:!1,EDIT:!1,DELETE:!1});s.useEffect(()=>{var f,r;let e={CREATE:!1,EDIT:!1,DELETE:!1},n="";(r=(f=w==null?void 0:w.auth)==null?void 0:f.roles)==null||r.map(d=>{d.permissions.map(p=>{p===ea&&(e.CREATE=!0),p===aa&&(e.EDIT=!0,n+="- update -"),p===ta&&(e.DELETE=!0,n+="- delete -")})}),Te(e),ve(n)},[w]);const $=s.useRef(null),V=s.useRef(null),J=e=>{e.current&&e.current.clearFileInput()},W=s.useRef(new Ne),A=W.current,[_e,T]=s.useState(!1),[K,_]=s.useState(""),[Ee,N]=s.useState("select"),[Y,E]=s.useState("insert"),[P,Pe]=s.useState("insert"),[be,b]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[ra,Q]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[ke,k]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[oa,X]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[Re,Z]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[ma,R]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[ha,ee]=s.useState(!1),[x,ae]=s.useState({}),[t,u]=s.useState(ye);s.useEffect(()=>{u({...t,_id:Y==="insert"?A==null?void 0:A.toString():t==null?void 0:t._id})},[A,Y]);const te=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],xe=[{key:"",name:Ce},{key:"driverFullName",name:"نام و نام خانوادگی",img:!1},{key:"driverNatNum",name:"کد ملی"},{key:"shomareParvane",name:"شماره پرونده"}],[g,Ie]=s.useState([]),[Oe,He]=s.useState([]),[y,Ue]=s.useState([]),{result:F}=la("select",null),{result:m,type:Ge,state:ua,refreshData:fa}=sa(Ee,t),{errors:i,refreshData:da}=na(ia,t);s.useEffect(()=>{var e;F&&Ue((e=F==null?void 0:F.data)==null?void 0:e.data)},[F]),s.useEffect(()=>{console.log(400,y)},[y]),s.useEffect(()=>{var e,n;if(m)switch(Ge){case"insert":(m==null?void 0:m.status)===200?(j.showSuccess("کارت  صلاحیت ثبت شد"),N("select")):j.showError("کارت  صلاحیت ثبت نشد");break;case"update":(m==null?void 0:m.status)===200?(j.showSuccess("کارت  صلاحیت ویرایش شد"),N("select")):j.showError("کارت  صلاحیت ویرایش نشد");break;case"delete":(m==null?void 0:m.status)===200?(j.showSuccess("کارت  صلاحیت حذف شد"),N("select")):j.showError("کارت  صلاحیت حذف نشد");break;case"select":He((e=m==null?void 0:m.data)==null?void 0:e.data),Le((n=m==null?void 0:m.data)==null?void 0:n.data),I();break}},[m]);const Le=e=>{Ie(()=>e.map(n=>({...n})))},I=()=>{b(h(new Date).format("jYYYY/jMM/jDD")),Q(h(new Date).format("jYYYY/jMM/jDD")),k(h(new Date).format("jYYYY/jMM/jDD")),X(h(new Date).format("jYYYY/jMM/jDD")),Z(h(new Date).format("jYYYY/jMM/jDD")),R(h(new Date).format("jYYYY/jMM/jDD")),se(),T(!1),_(""),W.current=new Ne,u(ye),ae({}),N(null),E("insert")},se=()=>{J("moarrefiNameMahaleFaaliyat"),J("fishPic")},qe=e=>{b(e),Q(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),u({...t,fishDate:L(G(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},ze=e=>{k(e),X(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),u({...t,fromDate:L(G(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},Be=e=>{Z(e),R(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),u({...t,toDate:L(G(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},le=(e,n,f,r)=>{ae(d=>({...d,[n]:e})),r===!1&&u({...t,attachFile:{...t.attachFile,[n]:f}})};s.useEffect(()=>{console.log(200,x)},[x]);const $e=e=>{switch(e){case"insert":N("insert");break;case"update":N("update");break}},Ve=(e,n)=>{var f,r,d,p,D,S;if(n==="delete"&&(u(e),N("delete")),n==="update"){se();const o=Oe.filter(Je=>Je._id===e._id)[0];(f=o==null?void 0:o.attachFile)!=null&&f.moarrefiNameMahaleFaaliyat&&((d=$.current)==null||d.setFileInput((r=o==null?void 0:o.attachFile)==null?void 0:r.moarrefiNameMahaleFaaliyat)),(p=o==null?void 0:o.attachFile)!=null&&p.fishPic&&((S=V.current)==null||S.setFileInput((D=o==null?void 0:o.attachFile)==null?void 0:D.fishPic)),b(h(o.fishDate).format("jYYYY/jMM/jDD")),k(h(o.fromDate).format("jYYYY/jMM/jDD")),R(h(o.toDate).format("jYYYY/jMM/jDD")),u(o),E("update")}};s.useEffect(()=>{console.log(75,l),ne()},[l]),s.useEffect(()=>{},[v]);const ne=async()=>{var n,f,r,d,p,D,S,o;console.log(10,l);const e=await Ke((f=(n=l==null?void 0:l.details)==null?void 0:n.attachFile)==null?void 0:f.driverPic);Fe({pic:`<img src='${e}' width="100px" height='100px'/>`||"---",full_name:(l==null?void 0:l.full_name)||"---",father_name:((r=l==null?void 0:l.details)==null?void 0:r.fatherName)||"---",nat_num:((d=l==null?void 0:l.details)==null?void 0:d.nat_num)||"---",plak:(l==null?void 0:l.vehicles)&&((p=l==null?void 0:l.vehicles[0])==null?void 0:p.plaque)||"---",parvane_type:((D=l==null?void 0:l.details)==null?void 0:D.activityContext)&&((S=l==null?void 0:l.details)==null?void 0:S.activityContext[0])||"---",shomare_parvane:((o=l==null?void 0:l.details)==null?void 0:o.shomareParvane)||"---",expire_date:Qe(l==null?void 0:l.toDate)||"---"})};s.useEffect(()=>{},[t]),s.useEffect(()=>{},[K]);const ce=e=>{_(x[e]),T(!0)};return c("div",{className:"agance-component carteSlahiyat-component",children:[q&&a("i",{className:"fa fa-arrow-left back-icon",onClick:q}),_e&&c("div",{className:"myAttachImage",children:[a("img",{className:"upload-img",src:K}),a("i",{className:"fa fa-remove close-icon",onClick:()=>{T(!1),_("")}})]}),a("div",{className:"row",children:a("div",{className:"col-12",children:a("div",{className:"page-title",children:a("i",{onClick:()=>{Pe("insert"),ee(Y==="insert")},className:P==="insert"?"active":"",children:Y==="insert"?C:"بروزرسانی کارت  صلاحیت"})})})}),a("div",{className:"row",children:c("div",{className:"col-12",children:[a("button",{onClick:()=>Ae(!0),className:"my-btn",children:"صدور کارت"}),we===!0&&a(M,{children:a(Me,{autoReadFile:!0,HTMLFile:z,fields:v})})]})}),a("div",{style:{display:`${P==="list"?"":"none"}`},className:"row",children:c("div",{className:"col-12",children:[(g==null?void 0:g.length)>0&&a(Xe,{clickOnRow:Ve,pagesize:te[0].value,items:g,options:te,thead:xe}),(g==null?void 0:g.length)<=0&&c("p",{style:{marginTop:"40px"},children:[" ","موردی برای نمایش وجود ندارد"]})]})}),c("div",{style:{display:`${P==="insert"?"":"none"}`},className:"aganceRegister-component",children:[Y==="insert"&&B.CREATE===!1&&c("p",{children:[" ",a(ca,{})]}),(Y==="insert"&&B.CREATE===!0||Y==="update")&&c(M,{children:[Y==="update"&&c(M,{children:[a("button",{onClick:()=>{I(),E("insert")},className:"my-btn",children:C}),a(Me,{autoReadFile:!0,HTMLFile:z,fields:v})]}),c("div",{className:"row",children:[a("div",{className:"col-6",children:c("div",{className:"form-group",children:[a("p",{children:"   شماره فیش واریزی "}),a("input",{onChange:e=>u({...t,fishNumber:e.target.value}),value:(t==null?void 0:t.fishNumber)||"",type:"text",className:"form-control"}),((ie=i==null?void 0:i.fishNumber)==null?void 0:ie.length)>0&&a(M,{children:c("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),c("div",{className:"error-msg",children:[" ",(re=i==null?void 0:i.fishNumber)==null?void 0:re.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-6",children:c("div",{className:"form-group",children:[a("p",{children:"   مبلغ (ریال)"}),a("input",{onChange:e=>u({...t,fishPrice:e.target.value.replace(/,/g,"")}),value:((oe=t==null?void 0:t.fishPrice)==null?void 0:oe.replace(/\B(?=(\d{3})+(?!\d))/g,","))||"",type:"text",className:"form-control"}),((me=i==null?void 0:i.fishPrice)==null?void 0:me.length)>0&&a(M,{children:c("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),c("div",{className:"error-msg",children:[" ",(he=i==null?void 0:i.fishPrice)==null?void 0:he.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-6",children:c("div",{className:"form-group",children:[a("p",{children:"   تاریخ فیش"}),a(O,{onChange:e=>qe(e!==null?Array.isArray(e)?e[0]:e:null),calendar:H,locale:U,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:be,placeholder:Ze(h(new Date).format("jYYYY/jMM/jDD"))}),((ue=i==null?void 0:i.fishDate)==null?void 0:ue.length)>0&&a(M,{children:c("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),c("div",{className:"error-msg",children:[" ",(fe=i==null?void 0:i.fishDate)==null?void 0:fe.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-6",children:c("div",{className:"form-group",children:[a("p",{children:"بارگزاری تصویر فیش   "}),c("div",{className:"file-upload-div",children:[a(ge,{ref:V,name:"fishPic",id:(t==null?void 0:t._id)||"",handleGetBase64:le}),((de=t==null?void 0:t.attachFile)==null?void 0:de.fishPic)&&a("i",{className:"fa fa-eye my-eye-icon",onClick:()=>ce("fishPic")})]})]})}),a("div",{className:"col-12",children:c("div",{className:"form-group",children:[a("p",{children:"   تصویر درخواست تمدید یا معرفی نامه محل فعالیت   "}),c("div",{className:"file-upload-div",children:[a(ge,{ref:$,name:"moarrefiNameMahaleFaaliyat",id:(t==null?void 0:t._id)||"",handleGetBase64:le}),((pe=t==null?void 0:t.attachFile)==null?void 0:pe.moarrefiNameMahaleFaaliyat)&&a("i",{className:"fa fa-eye my-eye-icon",onClick:()=>ce("moarrefiNameMahaleFaaliyat")})]}),((Ye=i==null?void 0:i.attachFile)==null?void 0:Ye.length)>0&&a(M,{children:c("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),c("div",{className:"error-msg",children:[" ",(De=i==null?void 0:i.attachFile)==null?void 0:De.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-12",children:c("div",{className:"form-group",children:[a("span",{children:"صدور کارت صلاحیت راننده به کد ملی "}),c("select",{onChange:e=>{var f;const n=y.filter(r=>{var d,p,D;return((d=r==null?void 0:r.details)==null?void 0:d.nat_num)===e.target.value&&((p=r==null?void 0:r.details)==null?void 0:p.nat_num)!==null&&((D=r==null?void 0:r.details)==null?void 0:D.nat_num)!==void 0})[0];n&&je(n),u({...t,driverNatNum:e.target.value,shomareParvane:(f=n==null?void 0:n.details)==null?void 0:f.shomareParvane,driverFullName:n==null?void 0:n.full_name,driverId:n==null?void 0:n._id})},className:"form-control",value:(t==null?void 0:t.driverNatNum)||"1",children:[a("option",{value:"1",children:"---انتخاب کنید---"}),y==null?void 0:y.map(e=>{var n;if(e.status==="ACTIVE")return a("option",{value:(n=e==null?void 0:e.details)==null?void 0:n.nat_num,children:e==null?void 0:e.full_name})})]}),"و شماره پروانه",a("input",{onChange:e=>u({...t,shomareParvane:e.target.value}),value:(t==null?void 0:t.shomareParvane)||"",type:"text",className:"form-control"}),"با اعتبار",a("input",{onChange:e=>u({...t,year:e.target.value}),value:(t==null?void 0:t.year)||"",type:"text",className:"form-control"}),"از تاریخ",a(O,{onChange:e=>ze(e!==null?Array.isArray(e)?e[0]:e:null),calendar:H,locale:U,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:ke,placeholder:" تاریخ"}),"الی",a(O,{onChange:e=>Be(e!==null?Array.isArray(e)?e[0]:e:null),calendar:H,locale:U,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:Re,placeholder:" تاریخ"}),"بلامانع است."]})}),a("div",{className:"col-12",children:c("div",{className:"form-group",children:[a("button",{disabled:Object.keys(i).length!==0,onClick:()=>$e(Y==="insert"?"insert":"update"),className:`my-btn ${Object.keys(i).length===0?"":"my-btn-inactive"}`,children:Y==="insert"?"ثبت":"بروز رسانی"}),a("button",{onClick:()=>I(),className:"my-btn",children:"انصراف"})]})})]})]})]})]})};export{Sa as default};
