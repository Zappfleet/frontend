import{n as V,r as m,aI as j,aJ as Y,aK as U,aL as G,j as i,c as e,F as g,a1 as K,$ as z,at as J,y as v,f as b,aM as B}from"./index-4b638fea.js";import{S as o}from"./SimpleButton-b66aa1df.js";import{B as q}from"./BasicSwitcher-50dcca88.js";import{T as H}from"./TabbedPanel-861d1946.js";import{u as Q}from"./useVehicleBasicData-dc6e97f6.js";const x=t=>{var P,T,A,F,D;const{hasPermitGroup:w,hasPermitFor:n,hasAdminRank:S,permits:_}=V();m.useState(!1);const[s,u]=m.useState(!1),[r,k]=m.useState(!1),[R,L]=m.useState(!1),[C,M]=m.useState(!1);m.useEffect(()=>{u(n([j])),L(n([Y])),k(n([U])),M(n([G]))},[n]);const[l,f]=m.useState({activeNewRow:!1,isLoading:!1,input:""}),E=m.useRef(),O=()=>{f({...l,activeNewRow:!1})},N=()=>{f({...l,activeNewRow:!0})},$=a=>{f({...l,input:a.target.value})},y=a=>{const d=l.input.trim(),h=J(E);d.length!=0&&(f({...l,isLoading:!0}),t.onSubmit(h,()=>{f({...l,isLoading:!1,activeNewRow:a,input:""})}))},I=(a,d,h)=>{v().updateBasicEntity(d.key,a,t.group).then(({data:c})=>{b.showSuccess("به روز رسانی انجام شد")}).catch(()=>{b.showError("خطا در به روز رسانی"),h()})};return i("div",{className:"rounded-sm border border-stroke bg-white shadow-default dark:border-strokedark dark:bg-boxdark",children:[e("div",{className:"py-6 px-4 md:px-6 xl:px-7.5",children:(()=>{switch(t.group){case"group":return i(g,{children:[r===!0&&e(o,{onClick:N,children:`سطر جدید ${t.title}`}),r===!1&&e(o,{disabled:!0,className:"NoPermission",children:`سطر جدید ${t.title}`})]});case"service":return i(g,{children:[C===!0&&e(o,{onClick:N,children:`سطر جدید ${t.title}`}),C===!1&&e(o,{disabled:!0,className:"NoPermission",children:`سطر جدید ${t.title}`})]});case"name":return i(g,{children:[R===!0&&e(o,{onClick:N,children:`سطر جدید ${t.title}`}),R===!1&&e(o,{disabled:!0,className:"NoPermission",children:`سطر جدید ${t.title}`})]});case"color":return i(g,{children:[s===!0&&e(o,{onClick:N,children:`سطر جدید ${t.title}`}),s===!1&&e(o,{disabled:!0,className:"NoPermission",children:`سطر جدید ${t.title}`})]});default:return null}})()}),i("div",{className:"grid grid-cols-4 border-t border-stroke py-4.5 px-4 dark:border-strokedark sm:grid-cols-8 md:px-6 2xl:px-7.5",children:[e("div",{className:"col-span-3 flex items-center",children:e("p",{className:"font-medium",children:"عنوان"})}),(P=t.additionalFields)==null?void 0:P.map(({title:a,key:d})=>e("div",{className:"col-span-2 items-center sm:flex",children:e("p",{className:"font-medium",children:a})},d)),e("div",{className:"col-span-2 hidden items-center sm:flex",children:e("p",{className:"font-medium",children:"تاریخ ایجاد"})}),e("div",{className:"col-span-1 flex items-center justify-center",children:e("p",{className:"font-medium",children:"فعال"})})]}),(l.activeNewRow||((T=t.data)==null?void 0:T.length)===0)&&i("div",{className:"grid grid-cols-6 border-t border-stroke py-4.5 px-4 dark:border-strokedark sm:grid-cols-8 md:px-6 2xl:px-7.5",children:[e("div",{className:"col-span-6 flex items-center",children:i("form",{ref:E,className:"w-full flex flex-col gap-4 sm:flex-row sm:items-center",children:[e("input",{name:"name",onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),y(!0))},className:"border border-gray w-full text-sm text-black dark:text-white outline-none p-2",value:l.input,onChange:$,autoFocus:!0,placeholder:"عنوان جدید را وارد کنید"}),(A=t.renderAdditionalRowInput)==null?void 0:A.call(t)]})}),i("div",{className:"col-span-6 sm:col-span-2 flex items-center justify-center m-2",children:[e(K,{isLoading:l.isLoading,disabled:l.input.trim().length==0,onClick:()=>y(!1),className:"flex-1 !py-2 !text-sm ",children:"تایید"}),e(o,{disabled:((F=t.data)==null?void 0:F.length)===0,onClick:O,className:"!bg-danger disabled:!bg-disabled flex-1 mx-2",children:"لغو"})]})]}),(D=t.data)==null?void 0:D.map(a=>{var h;const d=c=>I({title:c.target.value},a,()=>{c.target.value=a.title});return i("div",{className:"grid grid-cols-4 border-t border-stroke py-4.5 px-4 dark:border-strokedark sm:grid-cols-8 md:px-6 2xl:px-7.5",children:[e("div",{className:"col-span-3 flex items-center",children:i("div",{className:"mb-4 relative flex show-sibling-onfocus border border-transparent p-2 rounded focus-within:border-primary flex flex-col gap-4 sm:flex-row sm:items-center",children:[e("input",{onBlur:d,defaultValue:a.title,className:"flex-1 cursor-pointer text-sm sm:flex text-black hover:text-primary p-1 dark:text-white outline-none"}),e("span",{className:"focus-sibling absolute left-1 top-1/2 -translate-y-1/2",children:e(z,{onClick:d,className:"text-success cursor-pointer",size:26})})]})}),(h=t.additionalFields)==null?void 0:h.map(({key:c,render:p})=>e("div",{className:"col-span-2 items-center sm:flex",children:e("p",{className:"font-medium",children:(p==null?void 0:p(a[c],a))||a[c]})},c)),e("div",{className:"col-span-2 hidden items-center sm:flex",children:e("p",{className:"text-sm text-black hidden sm:flex dark:text-white",children:a.createdAt})}),e("div",{className:"col-span-1 flex justify-center items-center ltr",children:e(q,{defaultValue:a.active,handleChange:(c,p)=>{I({active:c},a,p)}})})]},a.key)})]})},ae=()=>{const{data:t,refreshData:w}=Q(),n=s=>(u,r)=>{v().createBasicEntity(u,s).then(({data:k})=>{w()}).catch(console.log).finally(r)},S=(s,u,r)=>{v().updateBasicEntity(s,{unit:u},"service").then(({data:k})=>{b.showSuccess("به روز رسانی انجام شد")}).catch(()=>{b.showError("خطا در به روز رسانی"),r()})},_=[{label:"نوع خودرو",key:"groups",component:e(x,{onSubmit:n("group"),data:t.groups,group:"group",title:"نوع خودرو"})},{label:"سرویس",key:"services",component:e(x,{onSubmit:n("service"),data:t.services,group:"service",title:"سرویس",additionalFields:[{title:"واحد ظرفیت",key:"unit",render:(s,u)=>e("select",{defaultValue:s,onChange:r=>S(u.key,r.target.value,()=>{r.target.value=s}),className:"select-box",children:B.map(r=>e("option",{value:r[0],children:r[1]}))},s)}],renderAdditionalRowInput:()=>e("select",{name:"unit",className:"p-1.5 rounded bg-white border border-gray",children:B.map(s=>e("option",{value:s[0],children:s[1]}))})})},{label:"اسامی خودرو",key:"names",component:e(x,{onSubmit:n("name"),data:t.names,group:"name",title:"اسامی خودرو"})},{label:"رنگ ها",key:"colors",component:e(x,{onSubmit:n("color"),data:t.colors,group:"color",title:"رنگ"})}];return e("div",{className:"DefinitionsManager-component",children:e(H,{tabs:_})})};export{ae as default};
