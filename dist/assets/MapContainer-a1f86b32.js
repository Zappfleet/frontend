var K=Object.defineProperty;var z=(t,n,l)=>n in t?K(t,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[n]=l;var F=(t,n,l)=>(z(t,typeof n!="symbol"?n+"":n,l),l);import{r as i,R as B,a5 as Y,c as H,bb as q,bc as W}from"./index-4b638fea.js";var A={},G={get exports(){return A},set exports(t){A=t}},x={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N;function Q(){if(N)return x;N=1;var t=B,n=Symbol.for("react.element"),l=Symbol.for("react.fragment"),w=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,M={key:!0,ref:!0,__self:!0,__source:!0};function P(T,p,b){var f,L={},E=null,h=null;b!==void 0&&(E=""+b),p.key!==void 0&&(E=""+p.key),p.ref!==void 0&&(h=p.ref);for(f in p)w.call(p,f)&&!M.hasOwnProperty(f)&&(L[f]=p[f]);if(T&&T.defaultProps)for(f in p=T.defaultProps,p)L[f]===void 0&&(L[f]=p[f]);return{$$typeof:n,type:T,key:E,ref:h,props:L,_owner:r.current}}return x.Fragment=l,x.jsx=P,x.jsxs=P,x}(function(t){t.exports=Q()})(G);const I=A.jsx,X="_map_1yxt5_2",Z="_touch_1yxt5_26",J="_floaten_1yxt5_45",ee="_float_1yxt5_45",te={map:X,"map-popup-container":"_map-popup-container_1yxt5_7",touch:Z,"mobile-layers-button":"_mobile-layers-button_1yxt5_30",floaten:J,float:ee},$=t=>t?t instanceof Object?[t.longitude,t.latitude]:t:void 0,re=async()=>{try{const t=await new Promise((n,l)=>{navigator.geolocation.getCurrentPosition(w=>{n(w)},w=>l(w))});return t&&$(t.coords)||Object.values(V())}catch(t){console.error(t);const n=V();return[n.longitude,n.latitude]}},V=()=>({longitude:51.36281969540723,latitude:35.69672648316882}),ne={reverse:"https://api.neshan.org/v4/reverse",search:"https://api.neshan.org/v1/search",map:"https://static.neshan.org/sdk/openlayers/5.3.0/ol.js"},O=i.createContext({map:null,mapType:"neshan",mapContainer:null,setMap:t=>{},setMapType:t=>{},setMapContainer:t=>{}}),U={map:null,mapType:"neshan",mapContainer:null},oe=(t,n)=>{switch(n.type){case"SET_MAP":return{...t,map:n.payload};case"SET_MAP_TYPE":return{...t,title:n.payload};default:return U}},ae=t=>{const[n,l]=i.useReducer(oe,U),w={...n,setMap:r=>{l({type:"SET_MAP",payload:r})},setMapType:r=>{l({type:"SET_MAP_TYPE",payload:r})},setMapContainer:r=>{l({type:"SET_MAP_CONTAINER",payload:r})}};return I(O.Provider,{value:w,children:t.children})},se=i.forwardRef(({options:t,mapKey:n,serviceKey:l="",zoom:w=12,defaultType:r="neshan",scale:M,center:P,poi:T=!0,traffic:p=!0,onInit:b,className:f,style:L},E)=>{const h=i.useContext(O),a=i.useRef(null),[o,y]=i.useState(!1),[e,_]=i.useState(null),[g,u]=i.useState();i.useImperativeHandle(E,()=>({get mapContainer(){return a},get ol(){return typeof ol<"u"?ol:void 0},get map(){return h.map},get isInitiated(){return o}}),[o,h.map]);const C=()=>{var s,m;if(e)return e;const v=(m=(s=a.current)==null?void 0:s.querySelector(".ol-viewport"))==null?void 0:m.querySelectorAll("div:last-child");if(v)return _(Array.from(v)[v.length-1]),e},d=()=>{const s=C();s==null||s.style.setProperty("scale",""+M)},c=()=>{const s=C();s==null||s.style.setProperty("bottom","0.2em"),s==null||s.style.setProperty("left","0.4em")},j=(s,m="my-openlayer")=>{const v=document.getElementById(m);if(v)return v;const S=document.createElement("script");return S.src=s,S.id=m,document.getElementsByTagName("head")[0].appendChild(S),S},k=async()=>{var s;if(!a.current)return;const m=$(P);u(m);const v=m||await re(),S=new ol.Map({target:a.current,key:n||"",mapType:r,poi:T,traffic:p,view:new ol.View({center:ol.proj.fromLonLat(v),zoom:w}),controls:[],...t});S.setMapType(r),h.setMap(S),(s=h.map)==null||s.setMapType(r),h.setMapType(r),y(!0),b&&b(ol,S)},R=()=>{let s,m,v;return s=new Promise((S,D)=>{v=D,m=S,k().then(()=>{d(),c(),m()}).catch(()=>{v()})}),{promise:s,cancelPromise:()=>v()}};return i.useEffect(()=>{if(a.current&&h.setMapContainer(a.current),typeof ol<"u"){const s=R();return()=>s.cancelPromise()}else{const s=j(ne.map),m=()=>{R()};return s.addEventListener("load",m),()=>s.removeEventListener("load",m)}},[]),I("div",{ref:a,className:f||te.map,style:L})}),ce=i.forwardRef((t,n)=>I(ae,{children:I(se,{ref:n,...t})}));const le="web.98dc74e44c2544b493dff43bc3316fbb",ue="service.a964983a7b31434fa832e9f83a18f26f",ie="https://api.neshan.org";class pe{constructor(){F(this,"axiosClient");this.axiosClient=Y.create({baseURL:ie,headers:{"Api-Key":ue}})}async searchAddress(n,l,w){return await this.axiosClient.get("/v1/search",{params:{term:n,lat:l,lng:w}})}async reverse(n,l){return await this.axiosClient.get("/v5/reverse",{params:{lat:n,lng:l}})}}const de=new pe,me=i.forwardRef((t,n)=>{console.log(6);const[l,w]=i.useState([]),r=i.useRef(null);i.useEffect(()=>()=>{r.current&&(r.current.map.setTarget(void 0),r.current=null)},[]);function M(a){if(!r.current)return;const{map:o}=r.current;o.removeLayer(a)}function P(a,o,y){if(!r.current)return;const{ol:e,map:_}=r.current,g=a.map(c=>o?e.proj.fromLonLat(c):c),u=new e.Feature({geometry:new e.geom.LineString(g)}),C=new e.source.Vector({features:[u]}),d=new e.layer.Vector({source:C,style:new e.style.Style({stroke:new e.style.Stroke({color:`rgba(${y||"0, 102, 255"}, 0.8)`,width:3}),fill:new e.style.Fill({color:`rgba(${y||"0, 102, 255"}, 0.3)`})})});return _.addLayer(d),{route:d,coordinates:g.map(c=>o?e.proj.toLonLat(c):c)}}function T(a,o,y){if(!r.current)return;const{ol:e,map:_}=r.current,g=a.map(c=>o?e.proj.fromLonLat(c):c),u=new e.Feature({geometry:new e.geom.LineString(g)}),C=new e.source.Vector({features:[u]}),d=new e.layer.Vector({source:C,style:new e.style.Style({stroke:new e.style.Stroke({color:`rgba(${y||"255, 102, 0"}, 0.8)`,width:3}),fill:new e.style.Fill({color:`rgba(${y||"255, 102, 0"}, 0.3)`})})});return _.addLayer(d),{polyline:d,coordinates:g.map(c=>o?e.proj.toLonLat(c):c)}}function p(a,o,y){if(!r.current)return;const{ol:e,map:_}=r.current,g=a.map(c=>o?e.proj.fromLonLat(c):c),u=new e.Feature({geometry:new e.geom.Polygon([g])}),C=new e.source.Vector({features:[u]}),d=new e.layer.Vector({source:C,style:new e.style.Style({stroke:new e.style.Stroke({color:`rgba(${y||"255, 102, 0"}, 0.8)`,width:1}),fill:new e.style.Fill({color:`rgba(${y||"255, 102, 0"}, 0.3)`})})});return _.addLayer(d),{polygon:d,coordinates:g.map(c=>o?e.proj.toLonLat(c):c)}}function b(){if(!r.current)return;const{ol:a,map:o}=r.current,e=o.getView().getCenter();if(e)return a.proj.toLonLat([e[0],e[1]])}function f(){if(!r.current)return;const o=r.current.map.getView().getCenter();if(o)return L(o[0],o[1],!1)}function L(a,o,y,e,_,g){if(!r.current)return;const{ol:u,map:C}=r.current,d=y?u.proj.fromLonLat([a,o]):[a,o];let c=g||{color:"rgba(255, 0, 0, 1)"};const j=new u.Feature(new u.geom.Point(d)),k=new u.layer.Vector({source:new u.source.Vector({features:[j]}),style:new u.style.Style({image:e?new u.style.Icon({src:e,scale:_}):new u.style.Circle({radius:5,stroke:new u.style.Stroke(c),fill:new u.style.Fill(c)})})});return C.addLayer(k),w(R=>[...R,j]),{marker:k,coordinates:u.proj.toLonLat([d[0],d[1]])}}function E(a,o,y=12){if(!r.current)return;const{ol:e,map:_}=r.current;_.getView().animate({center:e.proj.fromLonLat([a,o]),zoom:y,duration:1e3})}const h=(a,o)=>{r.current={ol:a,map:o},t.mapRef&&(t.mapRef.current={addMarker:L,addMarkerToCenter:f,viewCoordinates:E,addPolygon:p,addPolyline:T,addRoute:P,remove:M,getCenterLonLat:b}),t.onMapInit&&t.onMapInit()};return i.useImperativeHandle(n,()=>({addMarker:L,addMarkerToCenter:f,viewCoordinates:E,addPolygon:p,addPolyline:T,addRoute:P,remove:M,getCenterLonLat:b}),[r.current]),H(ce,{style:{zIndex:1,height:"100%",width:"100%",pointerEvents:t.freeze?"none":"all"},center:{latitude:q,longitude:W},zoom:16,mapKey:le,onInit:h})});export{me as M,ue as N,de as n};
