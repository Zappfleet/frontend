import{r as s,u as w,a as O,b as x,j as t,N as g,c as e,s as R,L as C,d as F,e as T,R as G,O as M,F as D,D as P,f as U,g as A,E as S}from"./index-0b0339af.js";import{u as H}from"./useConfirmModal-14905c63.js";import{l as j,u as B}from"./useSocket-f4e4a1bd.js";import{u as V}from"./useVehicles-d960e0f0.js";const q=()=>{var N;const[o,l]=s.useState(!1),{authInfo:n}=w(),{userList:c,refreshData:d}=O(),[a,m]=s.useState(null);s.useEffect(()=>{var h;if(n&&c){const f=c==null?void 0:c.filter(E=>{var y;return E._id===((y=n==null?void 0:n.auth)==null?void 0:y._id)});m((h=f[0])==null?void 0:h.full_name)}},[n]);const{show:r,ui:i}=H("ModalLayout-component-login"),p=x(),v=s.useRef(null),u=s.useRef(null);s.useEffect(()=>{const h=({target:f})=>{u.current&&(!o||u.current.contains(f)||v.current.contains(f)||l(!1))};return document.addEventListener("click",h),()=>document.removeEventListener("click",h)}),s.useEffect(()=>{const h=({keyCode:f})=>{!o||f!==27||l(!1)};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)});const k=()=>{R({}),p(C)},b=()=>{r({title:"خروج از حساب",desc:"آیا قصد خروج از حساب کاربری خود را دارید؟",label_confirm:"بله, خارج شو!",label_cancel:"خیر",onConfirm:()=>k()})};return t("div",{className:"DropdownUser-component",children:[i,t(g,{ref:v,onClick:()=>l(!o),to:"#",children:[e("span",{className:"userTitle",children:a||((N=n==null?void 0:n.auth)==null?void 0:N.username)}),e("i",{className:"fa fa-user user-img"}),e("i",{className:" fa fa-angle-down "})]}),e("div",{ref:u,onFocus:()=>l(!0),onBlur:()=>l(!1),className:"profile-div",style:{display:o===!0?"block":"none"},children:t("ul",{children:[e("li",{children:t(g,{to:"/profile",children:[e("i",{className:"fa fa-user"}),e("span",{children:"پروفایل"})]})}),e("li",{children:t("button",{onClick:b,children:[e("i",{className:"fa fa-sign-out"}),e("span",{children:"خروج"})]})})]})})]})};const $=()=>e("header",{className:"bg-primary header-component",children:t("div",{className:"row header-div",children:[e("div",{className:"col-12 col-md-2 flex-right",children:e(g,{to:"/",children:e("span",{className:"titlepage",children:"سامانه ی جامع حمل و نقل زپ "})})}),e("div",{className:"col-12 col-md-8 flex-center",children:t("div",{className:"search flex-center",children:[e("input",{type:"text",placeholder:"جستجو ...",className:"form-control"}),e("i",{className:"fa fa-search flex-center"})]})}),e("div",{className:"col-2 d-block d-md-none"}),e("div",{className:"col-10 col-md-2 flex-end",children:e(q,{})})]})});const J=({children:o,activeCondition:l})=>{const[n,c]=s.useState(l);return e("li",{children:o(()=>{c(!n)},n)})},_=()=>{const o=F(),l=T(),{pathname:n}=l;s.useRef(null);const c=s.useRef(null),d=localStorage.getItem("sidebar-expanded"),[a,m]=s.useState(d===null?!1:d==="true");return s.useEffect(()=>{var r,i;localStorage.setItem("sidebar-expanded",a.toString()),a?(r=document.querySelector("body"))==null||r.classList.add("sidebar-expanded"):(i=document.querySelector("body"))==null||i.classList.remove("sidebar-expanded")},[a]),e("div",{className:"sidebar-component",children:e("aside",{ref:c,children:e("ul",{children:o==null?void 0:o.map(r=>{if(r.label!="")return r.is_title?e("h3",{children:r.label},r.key):r.sub_menu==null?e("li",{children:t(g,{to:r.href,children:[t("i",{children:[r.icon," "]}),t("span",{children:[" ",r.label," "]})]})},r.key):e("ul",{children:e(J,{activeCondition:n==="/"||n.includes("dashboard"),children:(i,p)=>{var v;return t(G.Fragment,{children:[t(g,{to:"#",onClick:u=>{u.preventDefault(),a?i():m(!0)},children:[r.icon,r.label]}),e("div",{children:e("ul",{children:(v=r.sub_menu)==null?void 0:v.map(u=>e("li",{children:t(g,{to:u.href,children:[u.icon,u.label]})},u.key))})})]})}})},r.key)})})})})};const z=()=>e("main",{className:"main-component",children:e(M,{})});function K(){return e(D,{})}function Q({vehicleID:o}){s.useState({latitude:null,longitude:null});const l=s.useRef(null),n=d=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{const{latitude:m,longitude:r}=a.coords;c(m,r,null,o)},a=>{console.error("Error getting location: ",a)}):console.error("Geolocation is not supported by this browser.")};function c(d,a,m,r){try{const i=j("http://127.0.0.1:4000",{reconnectionDelayMax:1e4,autoConnect:!0,path:"/api/v2/socket",auth:{token:localStorage.getItem("bearer_token")}});i.on("connect",()=>{let p=[];p.push({lat:d,lng:a,ownerID:r});const v="event-gps-update";i.emit(v,JSON.stringify(p))}),i.on("disconnect",()=>{console.log("Disconnected from server")})}catch(i){console.error("Error in sendFakeLocations:",i)}}return s.useEffect(()=>(l.current=setInterval(()=>{try{n([o])}catch(d){console.error("Error in sendCurrentLocationToServer:",d)}},15e3),()=>{l.current&&(clearInterval(l.current),l.current=null)}),[]),null}const I=()=>{var k;const[o,l]=s.useState(!1),{authInfo:n}=w(),{vehicles:c}=V(),d=x();s.useState(!1);const[a,m]=s.useState(void 0),[r,i]=s.useState(void 0);s.useEffect(()=>{var b,N,h;if(n!=null&&n.auth==null)d(C);else{try{i((N=(b=n==null?void 0:n.auth)==null?void 0:b.roles)==null?void 0:N.some(f=>f.title===P))}catch{i(void 0)}try{const f=(h=c==null?void 0:c.docs)==null?void 0:h.find(E=>{var y,L;return((y=E.driver_user)==null?void 0:y.id)===((L=n==null?void 0:n.auth)==null?void 0:L._id)});m(f?f._id:void 0)}catch{m(void 0)}}},[n,c,d]);const[p,v]=s.useState(null);return s.useEffect(()=>{var b,N;p&&((b=n==null?void 0:n.auth)!=null&&b._id)&&p.userIDs===((N=n==null?void 0:n.auth)==null?void 0:N._id)&&U.showSuccess(p.massage)},[p,(k=n==null?void 0:n.auth)==null?void 0:k._id]),B({listeners:{sendNotification:b=>{v(b)}}}),(n==null?void 0:n.auth)==null?e(A,{}):e(D,{children:t("div",{className:"container-fluid DefaultLayout-component",children:[e("div",{className:"row row-header",children:t("div",{className:"col-12",children:[e("i",{onClick:()=>l(!o),className:"button-bars fa fa-bars d-block d-sm-none"}),t(S,{children:[" ",e($,{})," "]})]})}),t("div",{className:"row have-sidebar",children:[e("div",{className:"col-8 handleShowSidebar",style:{display:o===!0?"block":"none"},children:t(S,{children:[e(_,{})," "]})}),e("div",{className:"col-3 d-none d-sm-block",children:e(S,{children:e(_,{})})}),t("div",{className:"col-12 col-md-9",children:[a&&e(Q,{vehicleID:a}),t(S,{children:[e(z,{})," "]})]})]}),e("div",{className:"row",children:e("div",{className:"col-12",children:t(S,{children:[" ",e(K,{})]})})})]})})};export{I as default};
