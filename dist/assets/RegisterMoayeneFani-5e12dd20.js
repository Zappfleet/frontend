import{r as s,h as x,U as j,u as Le,f as _,bd as Be,j as n,c as e,ar as Je,F as d,l as Ke,p as Qe,m as We,bJ as Xe,bK as Ze,bL as ea,bc as aa}from"./index-0b0339af.js";import{O as Ye,F as q}from"./FileUpload-63cbe117.js";import{c as ta}from"./dateTools-2ed79b68.js";import{u as la}from"./validation-2a5d93f1.js";import{P as na}from"./Page403-a9be83c6.js";function sa(C,g){const[S,F]=s.useState(null),[b,N]=s.useState(null),[h,u]=s.useState({in_progress:!1});function M(){switch(C){case"select":u({...h,in_progress:!0}),x().select_MoayeneFani().then(r=>{F(r),N("select")}).catch(r=>{console.error(6001,"Error fetching list:",r)}).finally(()=>{u({...h,in_progress:!1})});break;case"insert":g!==null&&(u({...h,in_progress:!0}),x().insert_MoayeneFani(g).then(r=>{F(r),N("insert")}).catch(r=>{console.error(6001,"Error fetching list:",r)}).finally(()=>{u({...h,in_progress:!1})}));break;case"update":g!==null&&(u({...h,in_progress:!0}),x().update_MoayeneFani(g).then(r=>{F(r),N("update")}).catch(r=>{console.error(6001,"Error fetching list:",r)}).finally(()=>{u({...h,in_progress:!1})}));break;case"delete":u({...h,in_progress:!0}),x().delete_MoayeneFani(g._id).then(r=>{F(r),N("delete")}).catch(r=>{console.error(6001,"Error fetching list:",r)}).finally(()=>{u({...h,in_progress:!1})});break}}return s.useEffect(()=>{C&&M()},[C]),{result:S,type:b,state:h,refreshData:M}}const ca={name:{required:!0,showName:""},StartActivityDate:{required:!0,showName:""},activityContext:{required:!0,showName:""},managerFullName:{required:!0,showName:""},managerCodeMelli:{required:!0,pattern:/^[0-9]{10}$/,showName:""},"address.postalCode":{required:!0,pattern:/^[0-9]{10}$/,showName:""},"address.address":{required:!0,showName:""},phone:{required:!0,pattern:/^[0-9]{11}$/,showName:""},managerPhone:{required:!0,pattern:/^[0-9]{11}$/,showName:""},"attachFile.modirPic":{required:!0,showName:""},"attachFile.mojavezSazmanHamlVaNaghl":{required:!0,showName:""},status:{required:!0,showName:""}},ke={status:"1",activityContext:"1",StartActivityDate:j(new Date).format("jYYYY/jMM/jDD"),name:"",managerFullName:"",managerCodeMelli:"",address:{address:"",postalCode:""},managerPhone:"",phone:"",attachFile:{modirPic:"",mojavezSazmanHamlVaNaghl:""}},va=({handleBackClick:C,title:g})=>{var K,Q,W,X,Z,ee,ae,te,le,ne,se,ce,re,ie,oe,me,de,he,ue,pe,ge,Ne,ve,fe,ye,De,Ce,Se,Fe;g="ثبت مرکز معاینه فنی";const{authInfo:S}=Le(),[F,b]=s.useState(""),[N,h]=s.useState({CREATE:!1,EDIT:!1,DELETE:!1});s.useEffect(()=>{var y,D;let a={CREATE:!1,EDIT:!1,DELETE:!1},m="";(D=(y=S==null?void 0:S.auth)==null?void 0:y.roles)==null||D.map(A=>{A.permissions.map(w=>{w===Xe&&(a.CREATE=!0),w===Ze&&(a.EDIT=!0,m+="- update -"),w===ea&&(a.DELETE=!0,m+="- delete -")})}),h(a),b(m)},[S]);const u=s.useRef(null),M=s.useRef(null),r=s.useRef(null),P=a=>{a.current&&a.current.clearFileInput()},H=s.useRef(new Ye),Y=H.current,[xe,R]=s.useState(!1),[be,U]=s.useState(""),[Pe,v]=s.useState("select"),[p,T]=s.useState("insert"),[k,G]=s.useState("list"),[Re,z]=s.useState(j(new Date).format("jYYYY/jMM/jDD")),[ra,$]=s.useState(j(new Date).format("jYYYY/jMM/jDD")),[ia,E]=s.useState(!1),[Te,L]=s.useState({}),[t,o]=s.useState(ke);s.useEffect(()=>{o({...t,_id:p==="insert"?Y==null?void 0:Y.toString():t==null?void 0:t._id})},[Y,p]);const{errors:l,refreshData:oa}=la(ca,t);s.useEffect(()=>{},[l]);const B=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],ze=[{key:"",name:F},{key:"name",name:"نام مرکز",img:!1},{key:"activityContext",name:"زمینه فعالیت"},{key:"StartActivityDate",name:" تاریخ شروع  فعالیت",type:"caleadar",key2:"fromdate"},{key:"managerFullName",name:"مدیر"}],[f,Ee]=s.useState([]),[Ie,Oe]=s.useState([]),{result:i,type:Ve,state:ma,refreshData:da}=sa(Pe,t);s.useEffect(()=>{var a,m;if(i)switch(Ve){case"insert":(i==null?void 0:i.status)===200?(_.showSuccess("مرکز معاینه فنی ثبت شد"),v("select")):_.showError("مرکز معاینه فنی ثبت نشد");break;case"update":(i==null?void 0:i.status)===200?(_.showSuccess("مرکز معاینه فنی ویرایش شد"),v("select")):_.showError("مرکز معاینه فنی ویرایش نشد");break;case"delete":(i==null?void 0:i.status)===200?(_.showSuccess("مرکز معاینه فنی حذف شد"),v("select")):_.showError("مرکز معاینه فنی حذف نشد");break;case"select":Oe((a=i==null?void 0:i.data)==null?void 0:a.data),qe((m=i==null?void 0:i.data)==null?void 0:m.data),I();break}},[i]);const qe=a=>{Ee(()=>a.map(m=>({...m,StartActivityDate:Be(m.StartActivityDate)})))},J=()=>{P("modirPic"),P("parvaneNamayandegi"),P("mojavezSazmanHamlVaNaghl")},I=()=>{z(j(new Date).format("jYYYY/jMM/jDD")),$(j(new Date).format("jYYYY/jMM/jDD")),J(),R(!1),U(""),H.current=new Ye,o(ke),L({}),v(null),T("insert")},He=a=>{z(a),$(a.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),o({...t,StartActivityDate:ta(aa(a.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},O=(a,m,y,D)=>{L(A=>({...A,[m]:a})),D===!1&&o({...t,attachFile:{...t.attachFile,[m]:y}})},Ue=a=>{switch(a){case"insert":v("insert");break;case"update":v("update");break}},Ge=(a,m)=>{var y,D,A,w,Ae,we,_e,je,Me;if(m==="delete"&&(o(a),v("delete")),m==="update"){J();const c=Ie.filter($e=>$e._id===a._id)[0];(y=c==null?void 0:c.attachFile)!=null&&y.modirPic&&((A=u.current)==null||A.setFileInput((D=c==null?void 0:c.attachFile)==null?void 0:D.modirPic)),(w=c==null?void 0:c.attachFile)!=null&&w.mojavezSazmanHamlVaNaghl&&((we=r.current)==null||we.setFileInput((Ae=c==null?void 0:c.attachFile)==null?void 0:Ae.mojavezSazmanHamlVaNaghl)),(_e=c==null?void 0:c.attachFile)!=null&&_e.parvaneNamayandegi&&((Me=M.current)==null||Me.setFileInput((je=c==null?void 0:c.attachFile)==null?void 0:je.parvaneNamayandegi)),z(j(c.StartActivityDate).format("jYYYY/jMM/jDD")),o(c),T("update")}};s.useEffect(()=>{},[t]);const V=a=>{U(Te[a]),R(!0)};return n("div",{className:"agance-component RegisterMoayeneFani-component",children:[C&&e("i",{className:"fa fa-arrow-left back-icon",onClick:C}),xe&&n("div",{className:"myAttachImage",children:[e("img",{className:"upload-img",src:be}),e("i",{className:"fa fa-remove close-icon",onClick:()=>R(!1)})]}),e("div",{className:"row",children:n("div",{className:"col-12",children:[e("div",{className:"page-title",children:e("i",{onClick:()=>{G("list"),E(!1)},className:k==="list"?"active":"",children:"لیست مرکز معاینه فنی ها"})}),e("div",{className:"page-title",children:e("i",{onClick:()=>{G("insert"),E(p==="insert")},className:k==="insert"?"active":"",children:p==="insert"?g:"بروزرسانی مرکز معاینه فنی"})})]})}),e("div",{style:{display:`${k==="list"?"":"none"}`},className:"row",children:n("div",{className:"col-12",children:[(f==null?void 0:f.length)<=0&&n("p",{style:{marginTop:"40px"},children:[" ","موردی برای نمایش وجود ندارد"]}),(f==null?void 0:f.length)>0&&e(Je,{clickOnRow:Ge,pagesize:B[0].value,items:f,options:B,thead:ze})]})}),n("div",{style:{display:`${k==="insert"?"":"none"}`},className:"aganceRegister-component",children:[p==="insert"&&N.CREATE===!1&&n("p",{children:[" ",e(na,{})]}),(p==="insert"&&N.CREATE===!0||p==="update")&&n(d,{children:[p==="update"&&e("button",{onClick:()=>{I(),T("insert")},className:"my-btn",children:g}),n("div",{className:"row",children:[e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"نام مرکز معاینه فنی"}),e("input",{onChange:a=>o({...t,name:a.target.value}),value:(t==null?void 0:t.name)||"",type:"text",className:"form-control"}),((K=l==null?void 0:l.name)==null?void 0:K.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(Q=l==null?void 0:l.name)==null?void 0:Q.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"تاریخ شروع فعالیت "}),e(Ke,{onChange:a=>He(a!==null?Array.isArray(a)?a[0]:a:null),calendar:Qe,locale:We,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:Re,placeholder:" تاریخ"}),((W=l==null?void 0:l.StartActivityDate)==null?void 0:W.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(X=l==null?void 0:l.StartActivityDate)==null?void 0:X.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" زمینه فعالیت (سبک ، سنگین ، سبک و سنگین)  "}),n("select",{onChange:a=>o({...t,activityContext:a.target.value}),className:"form-control",value:(t==null?void 0:t.activityContext)||"خودرو سبک",children:[e("option",{value:"خودرو سبک",children:"خودرو سبک"}),e("option",{value:"خودرو سنگین",children:"خودرو سنگین"}),e("option",{value:"خودرو سبک و سنگین",children:"خودرو سبک و سنگین"})]}),((Z=l==null?void 0:l.activityContext)==null?void 0:Z.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(ee=l==null?void 0:l.activityContext)==null?void 0:ee.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"نام و نام خانوادگی مدیر  "}),e("input",{onChange:a=>o({...t,managerFullName:a.target.value}),value:(t==null?void 0:t.managerFullName)||"",type:"text",className:"form-control"}),((ae=l==null?void 0:l.managerFullName)==null?void 0:ae.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(te=l==null?void 0:l.managerFullName)==null?void 0:te.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" کد ملی مدیر "}),e("input",{onChange:a=>o({...t,managerCodeMelli:a.target.value}),value:(t==null?void 0:t.managerCodeMelli)||"",type:"text",className:"form-control"}),((le=l==null?void 0:l.managerCodeMelli)==null?void 0:le.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(ne=l==null?void 0:l.managerCodeMelli)==null?void 0:ne.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" آدرس و موقعیت مکانی "}),e("input",{onChange:a=>o({...t,address:{...t.address,address:a.target.value}}),value:((se=t==null?void 0:t.address)==null?void 0:se.address)||"",type:"text",className:"form-control"}),((ce=l["address.address"])==null?void 0:ce.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(re=l["address.address"])==null?void 0:re.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" کد پستی "}),e("input",{onChange:a=>o({...t,address:{...t.address,postalCode:a.target.value}}),value:((ie=t==null?void 0:t.address)==null?void 0:ie.postalCode)||"",type:"text",className:"form-control"}),((oe=l["address.postalCode"])==null?void 0:oe.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(me=l["address.postalCode"])==null?void 0:me.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تلفن ثابت "}),e("input",{onChange:a=>o({...t,phone:a.target.value}),value:(t==null?void 0:t.phone)||"",type:"text",className:"form-control"}),((de=l==null?void 0:l.phone)==null?void 0:de.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(he=l==null?void 0:l.phone)==null?void 0:he.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تلفن همراه مدیر "}),e("input",{onChange:a=>o({...t,managerPhone:a.target.value}),value:(t==null?void 0:t.managerPhone)||"",type:"text",className:"form-control"}),((ue=l==null?void 0:l.managerPhone)==null?void 0:ue.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(pe=l==null?void 0:l.managerPhone)==null?void 0:pe.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"بارگزاری تصویر پروانه مرکز  "}),n("div",{className:"file-upload-div",children:[e(q,{ref:M,name:"parvaneNamayandegi",id:(t==null?void 0:t._id)||"",handleGetBase64:O}),((ge=t==null?void 0:t.attachFile)==null?void 0:ge.parvaneNamayandegi)&&e("i",{className:"fa fa-eye my-eye-icon",onClick:()=>V("parvaneNamayandegi")})]})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تصویر مدیر مرکز   "}),n("div",{className:"file-upload-div",children:[e(q,{ref:u,name:"modirPic",id:(t==null?void 0:t._id)||"",handleGetBase64:O}),((Ne=t==null?void 0:t.attachFile)==null?void 0:Ne.modirPic)&&e("i",{className:"fa fa-eye my-eye-icon",onClick:()=>V("modirPic")})]}),((ve=l["attachFile.modirPic"])==null?void 0:ve.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(fe=l["attachFile.modirPic"])==null?void 0:fe.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تصویر مجوز  اتحادیه سازمان های حمل و نقل "}),n("div",{className:"file-upload-div",children:[e(q,{ref:r,name:"mojavezSazmanHamlVaNaghl",id:(t==null?void 0:t._id)||"",handleGetBase64:O}),((ye=t==null?void 0:t.attachFile)==null?void 0:ye.mojavezSazmanHamlVaNaghl)&&e("i",{className:"fa fa-eye my-eye-icon",onClick:()=>V("mojavezSazmanHamlVaNaghl")})]}),((De=l["attachFile.mojavezSazmanHamlVaNaghl"])==null?void 0:De.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(Ce=l["attachFile.mojavezSazmanHamlVaNaghl"])==null?void 0:Ce.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" وضعیت "}),n("select",{onChange:a=>o({...t,status:a.target.value}),className:"form-control",value:t.status||"1",children:[e("option",{value:"1",children:"فعال"}),e("option",{value:"2",children:"غیر فعال"})]}),((Se=l==null?void 0:l.status)==null?void 0:Se.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(Fe=l==null?void 0:l.status)==null?void 0:Fe.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-12",children:n("div",{className:"form-group",children:[e("p",{children:" توضیحات "}),e("textarea",{onChange:a=>o({...t,desc:a.target.value}),value:(t==null?void 0:t.desc)||"",rows:5,className:"form-control"})]})}),e("div",{className:"col-12",children:n("div",{className:"form-group",children:[e("button",{disabled:Object.keys(l).length!==0,onClick:()=>Ue(p==="insert"?"insert":"update"),className:`my-btn ${Object.keys(l).length===0?"":"my-btn-inactive"}`,children:p==="insert"?"ثبت":"بروز رسانی"}),e("button",{onClick:()=>I(),className:"my-btn",children:"انصراف"})]})})]})]})]})]})};export{va as default};
