var B=Object.defineProperty;var z=(e,n,c)=>n in e?B(e,n,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[n]=c;var A=(e,n,c)=>(z(e,typeof n!="symbol"?n+"":n,c),c);import{r as u,R as Y,a4 as H,b as F,bb as q,bc as W}from"./index-a6150745.js";var N={},G={get exports(){return N},set exports(e){N=e}},x={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V;function Q(){if(V)return x;V=1;var e=Y,n=Symbol.for("react.element"),c=Symbol.for("react.fragment"),p=Object.prototype.hasOwnProperty,r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,M={key:!0,ref:!0,__self:!0,__source:!0};function P(E,y,b){var d,L={},T=null,v=null;b!==void 0&&(T=""+b),y.key!==void 0&&(T=""+y.key),y.ref!==void 0&&(v=y.ref);for(d in y)p.call(y,d)&&!M.hasOwnProperty(d)&&(L[d]=y[d]);if(E&&E.defaultProps)for(d in y=E.defaultProps,y)L[d]===void 0&&(L[d]=y[d]);return{$$typeof:n,type:E,key:T,ref:v,props:L,_owner:r.current}}return x.Fragment=c,x.jsx=P,x.jsxs=P,x}(function(e){e.exports=Q()})(G);const I=N.jsx,X="_map_1yxt5_2",Z="_touch_1yxt5_26",J="_floaten_1yxt5_45",ee="_float_1yxt5_45",te={map:X,"map-popup-container":"_map-popup-container_1yxt5_7",touch:Z,"mobile-layers-button":"_mobile-layers-button_1yxt5_30",floaten:J,float:ee},O=e=>e?e instanceof Object?[e.longitude,e.latitude]:e:void 0,re=async()=>{try{const e=await new Promise((n,c)=>{navigator.geolocation.getCurrentPosition(p=>{n(p)},p=>c(p))});return e&&O(e.coords)||Object.values($())}catch(e){console.error(e);const n=$();return[n.longitude,n.latitude]}},$=()=>({longitude:51.36281969540723,latitude:35.69672648316882}),ne={reverse:"https://api.neshan.org/v4/reverse",search:"https://api.neshan.org/v1/search",map:"https://static.neshan.org/sdk/openlayers/5.3.0/ol.js"},D=u.createContext({map:null,mapType:"neshan",mapContainer:null,setMap:e=>{},setMapType:e=>{},setMapContainer:e=>{}}),U={map:null,mapType:"neshan",mapContainer:null},oe=(e,n)=>{switch(n.type){case"SET_MAP":return{...e,map:n.payload};case"SET_MAP_TYPE":return{...e,title:n.payload};default:return U}},ae=e=>{const[n,c]=u.useReducer(oe,U),p={...n,setMap:r=>{c({type:"SET_MAP",payload:r})},setMapType:r=>{c({type:"SET_MAP_TYPE",payload:r})},setMapContainer:r=>{c({type:"SET_MAP_CONTAINER",payload:r})}};return I(D.Provider,{value:p,children:e.children})},se=u.forwardRef(({options:e,mapKey:n,serviceKey:c="",zoom:p=12,defaultType:r="neshan",scale:M,center:P,poi:E=!0,traffic:y=!0,onInit:b,className:d,style:L},T)=>{const v=u.useContext(D),a=u.useRef(null),[o,f]=u.useState(!1),[t,_]=u.useState(null),[g,i]=u.useState();u.useImperativeHandle(T,()=>({get mapContainer(){return a},get ol(){return typeof ol<"u"?ol:void 0},get map(){return v.map},get isInitiated(){return o}}),[o,v.map]);const C=()=>{var s,w;if(t)return t;const h=(w=(s=a.current)==null?void 0:s.querySelector(".ol-viewport"))==null?void 0:w.querySelectorAll("div:last-child");if(h)return _(Array.from(h)[h.length-1]),t},m=()=>{const s=C();s==null||s.style.setProperty("scale",""+M)},l=()=>{const s=C();s==null||s.style.setProperty("bottom","0.2em"),s==null||s.style.setProperty("left","0.4em")},j=(s,w="my-openlayer")=>{const h=document.getElementById(w);if(h)return h;const S=document.createElement("script");return S.src=s,S.id=w,document.getElementsByTagName("head")[0].appendChild(S),S},k=async()=>{var s;if(!a.current)return;const w=O(P);i(w);const h=w||await re(),S=new ol.Map({target:a.current,key:n||"",mapType:r,poi:E,traffic:y,view:new ol.View({center:ol.proj.fromLonLat(h),zoom:p}),controls:[],...e});S.setMapType(r),v.setMap(S),(s=v.map)==null||s.setMapType(r),v.setMapType(r),f(!0),b&&b(ol,S)},R=()=>{let s,w,h;return s=new Promise((S,K)=>{h=K,w=S,k().then(()=>{m(),l(),w()}).catch(()=>{h()})}),{promise:s,cancelPromise:()=>h()}};return u.useEffect(()=>{if(a.current&&v.setMapContainer(a.current),typeof ol<"u"){const s=R();return()=>s.cancelPromise()}else{const s=j(ne.map),w=()=>{R()};return s.addEventListener("load",w),()=>s.removeEventListener("load",w)}},[]),I("div",{ref:a,className:d||te.map,style:L})}),ce=u.forwardRef((e,n)=>I(ae,{children:I(se,{ref:n,...e})}));const le="web.98dc74e44c2544b493dff43bc3316fbb",ie="service.a964983a7b31434fa832e9f83a18f26f",ue="https://api.neshan.org";class pe{constructor(){A(this,"axiosClient");this.axiosClient=H.create({baseURL:ue,headers:{"Api-Key":ie}})}async searchAddress(n,c,p){return await this.axiosClient.get("/v1/search",{params:{term:n,lat:c,lng:p}})}async reverse(n,c){return await this.axiosClient.get("/v5/reverse",{params:{lat:n,lng:c}})}}const me=new pe;class ye extends u.Component{constructor(){super(...arguments);A(this,"state",{hasError:!1})}static getDerivedStateFromError(c){return{hasError:!0}}componentDidCatch(c,p){console.error("Uncaught error:",c,p)}render(){return this.state.hasError?F("h1",{children:"Sorry.. there was an error"}):this.props.children}}const we=u.forwardRef((e,n)=>{console.log(6);const[c,p]=u.useState([]),r=u.useRef(null);u.useEffect(()=>()=>{r.current&&(r.current.map.setTarget(void 0),r.current=null)},[]);function M(a){if(!r.current)return;const{map:o}=r.current;o.removeLayer(a)}function P(a,o,f){if(!r.current)return;const{ol:t,map:_}=r.current,g=a.map(l=>o?t.proj.fromLonLat(l):l),i=new t.Feature({geometry:new t.geom.LineString(g)}),C=new t.source.Vector({features:[i]}),m=new t.layer.Vector({source:C,style:new t.style.Style({stroke:new t.style.Stroke({color:`rgba(${f||"0, 102, 255"}, 0.8)`,width:3}),fill:new t.style.Fill({color:`rgba(${f||"0, 102, 255"}, 0.3)`})})});return _.addLayer(m),{route:m,coordinates:g.map(l=>o?t.proj.toLonLat(l):l)}}function E(a,o,f){if(!r.current)return;const{ol:t,map:_}=r.current,g=a.map(l=>o?t.proj.fromLonLat(l):l),i=new t.Feature({geometry:new t.geom.LineString(g)}),C=new t.source.Vector({features:[i]}),m=new t.layer.Vector({source:C,style:new t.style.Style({stroke:new t.style.Stroke({color:`rgba(${f||"255, 102, 0"}, 0.8)`,width:3}),fill:new t.style.Fill({color:`rgba(${f||"255, 102, 0"}, 0.3)`})})});return _.addLayer(m),{polyline:m,coordinates:g.map(l=>o?t.proj.toLonLat(l):l)}}function y(a,o,f){if(!r.current)return;const{ol:t,map:_}=r.current,g=a.map(l=>o?t.proj.fromLonLat(l):l),i=new t.Feature({geometry:new t.geom.Polygon([g])}),C=new t.source.Vector({features:[i]}),m=new t.layer.Vector({source:C,style:new t.style.Style({stroke:new t.style.Stroke({color:`rgba(${f||"255, 102, 0"}, 0.8)`,width:1}),fill:new t.style.Fill({color:`rgba(${f||"255, 102, 0"}, 0.3)`})})});return _.addLayer(m),{polygon:m,coordinates:g.map(l=>o?t.proj.toLonLat(l):l)}}function b(){if(!r.current)return;const{ol:a,map:o}=r.current,t=o.getView().getCenter();if(t)return a.proj.toLonLat([t[0],t[1]])}function d(){if(!r.current)return;const o=r.current.map.getView().getCenter();if(o)return L(o[0],o[1],!1)}function L(a,o,f,t,_,g){if(!r.current)return;const{ol:i,map:C}=r.current,m=f?i.proj.fromLonLat([a,o]):[a,o];let l=g||{color:"rgba(255, 0, 0, 1)"};const j=new i.Feature(new i.geom.Point(m)),k=new i.layer.Vector({source:new i.source.Vector({features:[j]}),style:new i.style.Style({image:t?new i.style.Icon({src:t,scale:_}):new i.style.Circle({radius:5,stroke:new i.style.Stroke(l),fill:new i.style.Fill(l)})})});return C.addLayer(k),p(R=>[...R,j]),{marker:k,coordinates:i.proj.toLonLat([m[0],m[1]])}}function T(a,o,f=12){if(!r.current)return;const{ol:t,map:_}=r.current;_.getView().animate({center:t.proj.fromLonLat([a,o]),zoom:f,duration:1e3})}const v=(a,o)=>{r.current={ol:a,map:o},e.mapRef&&(e.mapRef.current={addMarker:L,addMarkerToCenter:d,viewCoordinates:T,addPolygon:y,addPolyline:E,addRoute:P,remove:M,getCenterLonLat:b}),e.onMapInit&&e.onMapInit()};return u.useImperativeHandle(n,()=>({addMarker:L,addMarkerToCenter:d,viewCoordinates:T,addPolygon:y,addPolyline:E,addRoute:P,remove:M,getCenterLonLat:b}),[r.current]),F(ye,{children:F(ce,{style:{zIndex:1,height:"100%",width:"100%",pointerEvents:e.freeze?"none":"all"},center:{latitude:q,longitude:W},zoom:16,mapKey:le,onInit:v})})});export{we as M,ie as N,me as n};
