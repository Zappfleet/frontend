import{m as ie,r as l,ah as le,ai as re,aj as oe,ak as ce,u as de,al as ue,am as me,b as e,g as he,F as pe,j as a,h as fe,an as ge,ao as T,ap as ve,a0 as Ee,aq as _e,ar as V,f as w,as as Se,at as Ne,au as Te,x as D,av as I,aw as q}from"./index-a6150745.js";import{u as Me}from"./useRoles-638b8077.js";const M="role_",Re={username:{isMinLength:{value:1,message:I}},password:{isMinLength:{value:6,message:q}},phone:{isMinLength:{value:11,message:q}},status:{isMinLength:{value:1,message:I}}};function ye(U={}){const c={};return Object.entries(U).map(x=>{const C=x[0];c[C]={isMinLength:{value:1,message:I}}}),{...Re,...c}}const Ue=()=>{var $,G,B;const{hasPermitGroup:U,hasPermitFor:c,hasAdminRank:x,permits:C}=ie();l.useState(!1);const[F,z]=l.useState(!1),[be,H]=l.useState(!1),[Le,K]=l.useState(!1),[ke,Q]=l.useState(!1);l.useEffect(()=>{z(c([le])),H(c([re])),K(c([oe])),Q(c([ce]))},[c]);const E=l.useRef(),{authInfo:i}=de(),{data:m}=Me(),{userList:_,refreshData:W}=ue(),P=(s,t)=>s.map(n=>{const g=n.roles.map(h=>{var d,u;return(u=(d=t==null?void 0:t.roles)==null?void 0:d.find(o=>o._id===h))==null?void 0:u.title}).join(" ");n.roles.map(h=>{var d,u;const N=(u=(d=t==null?void 0:t.roles)==null?void 0:d.find(o=>o._id===h))==null?void 0:u.title;return{id:h,title:N}});let v="";return n.status==="ACTIVE"?v="فعال":v="غیر فعال",{...n,rolesTitle:g,status:v}});l.useEffect(()=>{_&&m&&P(_,m)},[_]);const X=l.useRef(),[y,b]=l.useState(null),[p,A]=l.useState({isLoading:!1,selectedSignupMethod:null}),f=(i==null?void 0:i.org.signupMethods.find(({key:s})=>s==p.selectedSignupMethod))||(i==null?void 0:i.org.signupMethods[0]),J=ye((f==null?void 0:f.userFields)||{}),{validate:Y,errors:S,appendManuallError:Z,clearErrors:L}=me(J);function ee(){L(),V(E),b(null)}async function se(s){if(console.log(75,s),s.reg_key==null){w.showError("امکان ویرایش این کاربر وجود ندارد");return}A({...p,selectedSignupMethod:s.reg_key}),setTimeout(()=>{L();const t={...s,...s.details};delete t.details,delete t.roles,Se(E,t);const n=document.querySelectorAll(`[id^="${M}"]`);for(let r=0;r<n.length;r++){const g=n[r];g.checked=!1}s.roles.map(r=>{document.getElementById(`${M}${r}`).checked=!0}),b(s)},100)}if(i==null)return e(he,{});const R=y!=null,te=s=>{s.preventDefault();const t=Ne(E),n=[];R&&n.push("password");const r=Y(t,n),g=[],v={},h=Object.entries(t).map(o=>{const[k,O]=o;return k.startsWith(M)?O==!0?(g.push(k.split("_")[1]),!0):!1:(v[k]=O,!1)}).some(o=>o);if(h||Z({role:Te}),r||!h)return;const N={...v,roles:g,key:f.key},d=({data:o})=>{V(E),L(),W(),b(null),w.showSuccess("اطلاعات با موفقیت ثبت شد")},u=o=>{w.showError(o.message)};R?D().updateUser(y._id,N).then(d).catch(u):D().createUser(N).then(d).catch(u)},ae=s=>{A({...p,selectedSignupMethod:s.target.value})},j=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],ne=[{key:"username",name:"نام کاربری"},{key:"phone",name:"تلفن"},{key:"full_name",name:"نام و نام خانوادگی"},{key:"rolesTitle",name:"نقش"},{key:"status",name:"وضعیت"}];return e(pe,{children:e("div",{className:"UsersManager-component",children:a("div",{className:"row",children:[e("div",{className:"col-12 col-md-4 order-2 order-md-1",children:a("div",{className:"right",children:[e("div",{className:fe("absolute left-5 h-2",{hidden:y==null}),children:e(ge,{onClick:ee,className:"cursor-pointer text-2xl hover:text-danger"})}),!R&&a("div",{children:[e("label",{children:"نوع ثبت نام"}),e("select",{className:"form-control",ref:X,onChange:ae,children:(G=($=i==null?void 0:i.org)==null?void 0:$.signupMethods)==null?void 0:G.map(({key:s,title:t})=>e("option",{value:s,children:t},s))})]}),a("form",{ref:E,children:[Object.entries(f.userFields).map(s=>{const[t,n]=s,r=p.isLoading||f.userFields[t].editable==!1&&R;return a("div",{className:"div-li",children:[a("label",{children:[n.title,e(T,{message:S[t]})]}),a("div",{className:"have-icon",children:[e("input",{className:"form-control",name:t,type:"text",disabled:r,placeholder:`${n.title} را وارد کنید`}),e("i",{className:"fa fa-user icon"})]})]},t)}),a("div",{className:"div-li",children:[a("label",{children:["شماره همراه",e(T,{message:S.phone})]}),a("div",{className:"have-icon",children:[e("input",{className:"form-control",type:"text",name:"phone",disabled:p.isLoading,placeholder:"شماره همراه خود را وارد کنید"}),e("i",{className:"fa fa-phone icon"})]})]}),a("div",{className:"div-li",children:[a("label",{children:["رمز ورود",e(T,{message:S.password})]}),a("div",{className:"have-icon",children:[e("input",{className:"form-control",type:"password",name:"password",autoComplete:"new-password",placeholder:"رمز ورود خود را وارد کنید"}),e("i",{className:"fa fa-key icon"})]})]}),a("div",{className:"div-li",children:[a("label",{children:["وضعیت",e(T,{message:S.status})]}),e("select",{className:"form-control",name:"status",children:ve.map(s=>{const[t,n]=s;return e("option",{value:t,children:n})})})]}),a("div",{className:"div-li",children:[a("label",{children:["نقش ها",e(T,{message:S.role})]}),(B=m==null?void 0:m.roles)==null?void 0:B.map(s=>a("div",{children:[e("label",{htmlFor:s._id,children:s.title}),e("input",{name:`${M}${s._id}`,id:`${M}${s._id}`,type:"checkbox"})]}))]}),a("div",{children:[F===!0&&e("div",{children:e("button",{className:"my-btn",onClick:te,children:"ثبت نام"})}),F===!1&&e(Ee,{disabled:!0,isLoading:p.isLoading,className:"NoPermission mt-3 w-full cursor-pointer  rounded-lg  p-2 text-white transition hover:bg-opacity-90",children:"ثبت نام"})]})]})]})}),e("div",{className:"col-12 col-md-8 order-1 order-md-2",children:_&&m&&i&&e(_e,{pagesize:j[0].value,items:P(_,m),options:j,thead:ne,clickOnRow:se})})]})})})};export{Ue as default};
