import{o as le,r as i,aj as ie,ak as re,al as oe,am as ce,u as de,af as ue,a as me,an as he,c as s,g as pe,F as fe,j as t,k as ge,ao as ve,ap as N,aq as Ee,a1 as _e,ar as Se,as as O,f as L,at as Ne,au as Te,av as Me,h as V,aw as I,ax as D}from"./index-0b0339af.js";const T="role_",Re={username:{isMinLength:{value:1,message:I}},password:{isMinLength:{value:6,message:D}},phone:{isMinLength:{value:11,message:D}},status:{isMinLength:{value:1,message:I}}};function ye(U={}){const c={};return Object.entries(U).map(x=>{const C=x[0];c[C]={isMinLength:{value:1,message:I}}}),{...Re,...c}}const Ie=()=>{var j,$,G;const{hasPermitGroup:U,hasPermitFor:c,hasAdminRank:x,permits:C}=le();i.useState(!1);const[F,q]=i.useState(!1),[be,z]=i.useState(!1),[ke,H]=i.useState(!1),[we,K]=i.useState(!1);i.useEffect(()=>{q(c([ie])),z(c([re])),H(c([oe])),K(c([ce]))},[c]);const v=i.useRef(),{authInfo:l}=de(),{data:E}=ue(),{userList:R,refreshData:Q}=me(),W=(e,a)=>e==null?void 0:e.map(n=>{const f=n.roles.map(m=>{var d,u;return(u=(d=a==null?void 0:a.roles)==null?void 0:d.find(o=>o._id===m))==null?void 0:u.title}).join(" ");n.roles.map(m=>{var d,u;const S=(u=(d=a==null?void 0:a.roles)==null?void 0:d.find(o=>o._id===m))==null?void 0:u.title;return{id:m,title:S}});let g="";return n.status==="ACTIVE"?g="فعال":g="غیر فعال",{...n,rolesTitle:f,status:g}});i.useEffect(()=>{},[R]);const X=i.useRef(),[y,b]=i.useState(null),[h,P]=i.useState({isLoading:!1,selectedSignupMethod:null}),p=(l==null?void 0:l.org.signupMethods.find(({key:e})=>e==h.selectedSignupMethod))||(l==null?void 0:l.org.signupMethods[0]),J=ye((p==null?void 0:p.userFields)||{}),{validate:Y,errors:_,appendManuallError:Z,clearErrors:k}=he(J);function ee(){k(),O(v),b(null)}async function se(e){if(console.log(75,e),e.reg_key==null){L.showError("امکان ویرایش این کاربر وجود ندارد");return}P({...h,selectedSignupMethod:e.reg_key}),setTimeout(()=>{k();const a={...e,...e.details};delete a.details,delete a.roles,Ne(v,a);const n=document.querySelectorAll(`[id^="${T}"]`);for(let r=0;r<n.length;r++){const f=n[r];f.checked=!1}e.roles.map(r=>{document.getElementById(`${T}${r}`).checked=!0}),b(e)},100)}if(l==null)return s(pe,{});const M=y!=null,ae=e=>{e.preventDefault();const a=Te(v),n=[];M&&n.push("password");const r=Y(a,n),f=[],g={},m=Object.entries(a).map(o=>{const[w,B]=o;return w.startsWith(T)?B==!0?(f.push(w.split("_")[1]),!0):!1:(g[w]=B,!1)}).some(o=>o);if(m||Z({role:Me}),r||!m)return;const S={...g,roles:f,key:p.key},d=({data:o})=>{O(v),k(),Q(),b(null),L.showSuccess("اطلاعات با موفقیت ثبت شد")},u=o=>{L.showError(o.message)};M?V().updateUser(y._id,S).then(d).catch(u):V().createUser(S).then(d).catch(u)},te=e=>{P({...h,selectedSignupMethod:e.target.value})},A=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],ne=[{key:"",name:"- update -"},{key:"username",name:"نام کاربری"},{key:"phone",name:"تلفن"},{key:"full_name",name:"نام و نام خانوادگی"},{key:"rolesTitle",name:"نقش"},{key:"status",name:"وضعیت"}];return s(fe,{children:s("div",{className:"UsersManager-component",children:t("div",{className:"row",children:[s("div",{className:"col-12 col-md-4 order-2 order-md-1",children:t("div",{className:"right",children:[s("div",{className:ge("absolute left-5 h-2",{hidden:y==null}),children:s(ve,{onClick:ee,className:"cursor-pointer text-2xl hover:text-danger"})}),!M&&t("div",{children:[s("label",{children:"نوع ثبت نام"}),s("select",{className:"form-control",disabled:!1,ref:X,onChange:te,children:($=(j=l==null?void 0:l.org)==null?void 0:j.signupMethods)==null?void 0:$.map(({key:e,title:a})=>s("option",{value:e,children:a},e))})]}),t("form",{ref:v,children:[Object.entries(p.userFields).map(e=>{const[a,n]=e,r=h.isLoading||p.userFields[a].editable==!1&&M;return t("div",{className:"div-li",children:[t("label",{children:[n.title,s(N,{message:_[a]})]}),t("div",{className:"have-icon",children:[s("input",{className:"form-control",name:a,type:"text",disabled:r,placeholder:`${n.title} را وارد کنید`}),s("i",{className:"fa fa-user icon"})]})]},a)}),t("div",{className:"div-li",children:[t("label",{children:["شماره همراه",s(N,{message:_.phone})]}),t("div",{className:"have-icon",children:[s("input",{className:"form-control",type:"text",name:"phone",disabled:h.isLoading,placeholder:"شماره همراه خود را وارد کنید"}),s("i",{className:"fa fa-phone icon"})]})]}),t("div",{className:"div-li",children:[t("label",{children:["رمز ورود",s(N,{message:_.password})]}),t("div",{className:"have-icon",children:[s("input",{className:"form-control",type:"password",name:"password",autoComplete:"new-password",placeholder:"رمز ورود خود را وارد کنید"}),s("i",{className:"fa fa-key icon"})]})]}),t("div",{className:"div-li",children:[t("label",{children:["وضعیت",s(N,{message:_.status})]}),s("select",{className:"form-control",name:"status",children:Ee.map(e=>{const[a,n]=e;return s("option",{value:a,children:n})})})]}),t("div",{className:"div-li",children:[t("label",{children:["نقش ها",s(N,{message:_.role})]}),(G=E==null?void 0:E.roles)==null?void 0:G.map(e=>t("div",{children:[s("label",{htmlFor:e._id,children:e.title}),s("input",{name:`${T}${e._id}`,id:`${T}${e._id}`,type:"checkbox"})]}))]}),t("div",{children:[F===!0&&s("div",{children:s("button",{className:"my-btn",onClick:ae,children:"ثبت نام"})}),F===!1&&s(_e,{disabled:!0,isLoading:h.isLoading,className:"NoPermission mt-3 w-full cursor-pointer  rounded-lg  p-2 text-white transition hover:bg-opacity-90",children:"ثبت نام"})]})]})]})}),s("div",{className:"col-12 col-md-8 order-1 order-md-2",children:R&&E&&l&&s(Se,{pagesize:A[0].value,items:W(R,E),options:A,thead:ne,clickOnRow:se})})]})})})};export{Ie as default};
