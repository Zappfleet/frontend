import{r as t,y as k,u as be,U as o,f as w,bd as O,j as l,c as a,F as U,aq as Ie,k as G,p as B,l as L,be as Re,bf as Te,bg as Fe,bh as V}from"./index-4b638fea.js";import{O as ne,F as xe}from"./FileUpload-a1b75713.js";import{u as Oe}from"./useAganceRegister-325531e9.js";import{c as z}from"./dateTools-587f68dc.js";import{P as Ue}from"./Page403-34de9313.js";import{W as ce}from"./WordProcessor-87b83d1d.js";import"./style-3087b5d5.js";function Ge(Y,h){const[N,j]=t.useState(null),[A,S]=t.useState(null),[u,f]=t.useState({in_progress:!1});function P(){switch(Y){case"select":console.log(12548,Y),f({...u,in_progress:!0}),k().select_sodureParvane().then(n=>{j(n),S("select")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...u,in_progress:!1})});break;case"insert":h!==null&&(f({...u,in_progress:!0}),k().insert_sodureParvane(h).then(n=>{j(n),S("insert")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...u,in_progress:!1})}));break;case"update":h!==null&&(f({...u,in_progress:!0}),k().update_sodureParvane(h).then(n=>{j(n),S("update")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...u,in_progress:!1})}));break;case"delete":f({...u,in_progress:!0}),k().delete_sodureParvane(h._id).then(n=>{j(n),S("delete")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...u,in_progress:!1})});break}}return t.useEffect(()=>{Y&&P()},[Y]),{result:N,type:A,state:u,refreshData:P}}const Be="/assets/sodureParvaneAgance-fd9aa198.docx",Le="/assets/sodureParvaneBar-6312d572.docx",Ze=({handleBackClick:Y,title:h})=>{var se,re;h="صدور و تمدید پروانه آژانس";const{authInfo:N}=be(),[j,A]=t.useState(""),[S,u]=t.useState(!1),[f,P]=t.useState(!1),[n,oe]=t.useState({CREATE:!1,EDIT:!1,DELETE:!1});t.useEffect(()=>{var m,D;let e={CREATE:!1,EDIT:!1,DELETE:!1},r="";(D=(m=N==null?void 0:N.auth)==null?void 0:m.roles)==null||D.map(M=>{M.permissions.map(d=>{d===Re&&(e.CREATE=!0),d===Te&&(e.EDIT=!0,r+="- update -"),d===Fe&&(e.DELETE=!0,r+="- delete -")})}),oe(e),A(r)},[N]);const y=t.useRef(null),W=()=>{y.current&&y.current.clearFileInput()},$=t.useRef(new ne),C=$.current,[le,_]=t.useState(!1),[ie,q]=t.useState(""),[ue,g]=t.useState("select"),[p,b]=t.useState("insert"),[I,de]=t.useState("insert"),[fe,R]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[J,H]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[me,T]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[K,Q]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[he,F]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[X,Z]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[Ve,ee]=t.useState(!1),[De,ae]=t.useState({}),[s,i]=t.useState({fishDate:J,fromDate:K,toDate:X});t.useEffect(()=>{i({...s,_id:C.toString()})},[C]);const te=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],pe=[{key:"",name:j},{key:"fishNumber",name:"شماره فیش ",img:!1},{key:"fishPrice",name:"مبلغ "},{key:"fishDate",name:"تاریخ",type:"caleadar",key2:"fromdate"},{key:"aganceName",name:"نام آژانس"},{key:"fromDate",name:" تاریخ شروع "},{key:"toDate",name:"تاریخ پایان"}],[Ye,ge]=t.useState([]),[ve,Ee]=t.useState([]),[v,Ne]=t.useState([]),{result:E}=Oe("select",{}),{result:c,type:je,state:ze,refreshData:We}=Ge(ue,s);t.useEffect(()=>{var e;E!=null&&E.status&&Ne((e=E==null?void 0:E.data)==null?void 0:e.data)},[E]),t.useEffect(()=>{var e,r;if(c)switch(je){case"insert":(c==null?void 0:c.status)===200?(w.showSuccess(" صدور پروانه ثبت شد"),g("select")):w.showError("صدور پروانه ثبت نشد");break;case"update":(c==null?void 0:c.status)===200?(w.showSuccess("صدور پروانه ویرایش شد"),g("select")):w.showError("صدور پروانه ویرایش نشد");break;case"delete":(c==null?void 0:c.status)===200?(w.showSuccess("صدور پروانه حذف شد"),g("select")):w.showError("صدور پروانه حذف نشد");break;case"select":Ee((e=c==null?void 0:c.data)==null?void 0:e.data),Se((r=c==null?void 0:c.data)==null?void 0:r.data),x();break}},[c]),t.useEffect(()=>{},[J,K,X]);const Se=e=>{console.log(23,e,v),ge(()=>e.map(r=>{var m;return{...r,aganceName:(m=(v==null?void 0:v.filter(D=>D._id===(r==null?void 0:r.aganceID)))[0])==null?void 0:m.name,fishDate:O(r.fishDate),fromDate:O(r.fromDate),toDate:O(r.toDate)}}))},x=()=>{R(o(new Date).format("jYYYY/jMM/jDD")),H(o(new Date).format("jYYYY/jMM/jDD")),T(o(new Date).format("jYYYY/jMM/jDD")),Q(o(new Date).format("jYYYY/jMM/jDD")),F(o(new Date).format("jYYYY/jMM/jDD")),Z(o(new Date).format("jYYYY/jMM/jDD")),W(),_(!1),q(""),$.current=new ne,i({}),ae({}),g(null),b("insert")},Me=e=>{R(e),H(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),i({...s,fishDate:z(V(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},we=e=>{T(e),Q(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),i({...s,fromDate:z(V(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},Pe=e=>{F(e),Z(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),i({...s,toDate:z(V(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},ye=(e,r,m,D)=>{ae(M=>({...M,[r]:e})),D===!1&&i({...s,attachFile:{...s.attachFile,[r]:m}})},ke=e=>{switch(e){case"insert":g("insert");break;case"update":g("update");break}},Ae=(e,r)=>{var m,D,M;if(r==="delete"&&(i(e),g("delete")),r==="update"){W();const d=ve.filter(_e=>_e._id===e._id)[0];(m=d==null?void 0:d.attachFile)!=null&&m.fishPic&&((M=y.current)==null||M.setFileInput((D=e==null?void 0:e.attachFile)==null?void 0:D.fishPic)),R(o(d.fishDate).format("jYYYY/jMM/jDD")),T(o(d.fromDate).format("jYYYY/jMM/jDD")),F(o(d.toDate).format("jYYYY/jMM/jDD")),i(d),b("update")}};t.useEffect(()=>{},[s]);const Ce=e=>{q(De[e]),_(!0)};return l("div",{className:"agance-component SodureParvane-component",children:[Y&&a("i",{className:"fa fa-arrow-left back-icon",onClick:Y}),le&&l("div",{className:"myAttachImage",children:[a("img",{className:"upload-img",src:ie}),a("i",{className:"fa fa-remove close-icon",onClick:()=>_(!1)})]}),a("div",{className:"row",children:a("div",{className:"col-12",children:a("div",{className:"page-title",children:a("i",{onClick:()=>{de("insert"),ee(p==="insert")},className:I==="insert"?"active":"",children:p==="insert"?h:"بروزرسانی آژانس"})})})}),a("div",{className:"row",children:l("div",{className:"col-12",children:[a("button",{onClick:()=>u(!0),className:"my-btn",children:"صدور پروانه آژانس"}),S===!0&&a(U,{children:a(ce,{autoReadFile:!0,wordFile:Be,fields:s})}),a("button",{onClick:()=>P(!0),className:"my-btn",children:"صدور پروانه بار"}),f===!0&&a(U,{children:a(ce,{autoReadFile:!0,wordFile:Le,fields:s})})]})}),a("div",{style:{display:`${I==="list"?"":"none"}`},className:"row",children:a("div",{className:"col-12",children:a(Ie,{clickOnRow:Ae,pagesize:te[0].value,items:Ye,options:te,thead:pe})})}),l("div",{style:{display:`${I==="insert"?"":"none"}`},className:"aganceRegister-component",children:[p==="insert"&&n.CREATE===!1&&l("p",{children:[" ",a(Ue,{})]}),(p==="insert"&&n.CREATE===!0||p==="update")&&l(U,{children:[p==="update"&&a("button",{onClick:()=>{x(),b("insert")},className:"my-btn",children:h}),l("div",{className:"row",children:[a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"شماره فیش واریزی "}),a("input",{onChange:e=>i({...s,fishNumber:e.target.value}),value:(s==null?void 0:s.fishNumber)||"",type:"text",className:"form-control"})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:" مبلغ (ریال)"}),a("input",{onChange:e=>i({...s,fishPrice:e.target.value.replace(/,/g,"")}),value:((se=s==null?void 0:s.fishPrice)==null?void 0:se.replace(/\B(?=(\d{3})+(?!\d))/g,","))||"",type:"text",className:"form-control"})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"تاریخ   "}),a(G,{onChange:e=>Me(e!==null?Array.isArray(e)?e[0]:e:null),calendar:B,locale:L,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:fe,placeholder:"از تاریخ"})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:" تصویر فیش   "}),l("div",{className:"file-upload-div",children:[a(xe,{ref:y,name:"fishPic",id:C.toString(),handleGetBase64:ye}),((re=s==null?void 0:s.attachFile)==null?void 0:re.fishPic)&&a("i",{className:"fa fa-eye my-eye-icon",onClick:()=>Ce("fishPic")})]})]})}),a("div",{className:"col-12",children:l("div",{className:"form-group",children:[a("span",{children:"صدور پروانه نمایندگی آژانس   "}),a("select",{onChange:e=>i({...s,aganceID:e.target.value}),className:"form-control",value:(s==null?void 0:s.aganceID)||"-1",children:v==null?void 0:v.filter(e=>e.status==="1").map(e=>a("option",{value:e._id,children:e.name}))}),"با اعتبار",a("input",{onChange:e=>i({...s,year:e.target.value}),value:(s==null?void 0:s.year)||"",type:"text",className:"form-control"}),"از تاریخ",a(G,{onChange:e=>we(e!==null?Array.isArray(e)?e[0]:e:null),calendar:B,locale:L,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:me,placeholder:"از تاریخ"}),"الی",a(G,{onChange:e=>Pe(e!==null?Array.isArray(e)?e[0]:e:null),calendar:B,locale:L,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:he,placeholder:"تا تاریخ"}),"بلامانع است."]})}),a("div",{className:"col-12",children:l("div",{className:"form-group",children:[a("button",{onClick:()=>ke(p==="insert"?"insert":"update"),className:"my-btn",children:p==="insert"?"ثبت":"بروز رسانی"}),a("button",{onClick:()=>x(),className:"my-btn",children:"انصراف"})]})})]})]})]})]})};export{Ze as default};
