import{r as u,y as L,n as v,bW as P,u as b,j as d,c as t,F as x,f as w}from"./index-4b638fea.js";import{U as H}from"./UsersSuggestionInput-a4d8adf9.js";import{S as p}from"./SimpleButton-b66aa1df.js";import"./Chips-0adb3513.js";import"./SuggestionTextInput-de8ae0dd.js";function j({user_id:r}){const[a,n]=u.useState();u.useEffect(()=>{r!=null&&(n(null),c(r).then(i=>{(i==null?void 0:i.data)!=null&&n(i.data)}))},[r]);async function c(i){try{return await L().getDeligationsOn(i)}catch(E){console.log(E)}}async function l(i,E,N){try{return await L().submitDeligationOn(i,E,N)}catch{}}return{submitDeligationOn:l,deligations:a}}function y(r){switch(r){case"SERVICE_MANAGMENT":return"مدیریت سرویس ها";case"REQUEST_APPROVAL":return"رد و تایید درخواست ها";case"LOCATION_MANAGMENT":return"مدیریت مکان های منتخب";case"VEHICLE_MANAGMENT":return"خودرو و آژانس";case"USERS_MANAGEMENT":return"مدیریت کاربران";case"AREAS_MANAGEMENT":return"مدیریت محدوده ها"}}const _={SERVICE_MANAGMENT:["SERVICE.ORG.DIRECT_SUBMIT","SERVICE.ORG.DIRECT_EDIT","SERVICE.ORG.DIRECT_CANCEL","SERVICE.ORG.DISPATCH","SERVICE.ORG.GET.AGENCY_FULL","SERVICE.ORG.GET.AGENCY_LIMITED"],REQUEST_APPROVAL:["SERVICE.ORG.REQUEST_APPROVAL","SERVICE.ORG.GET.AREA_FULL","SERVICE.ORG.GET.AREA_LIMITED"],LOCATION_MANAGMENT:["LOCATION.ORG.SUBMIT","LOCATION.ORG.EDIT","LOCATION.ORG.CANCEL","LOCATION.ORG.LIST"],VEHICLE_MANAGMENT:["VEHICLES.CREATE","VEHICLES.DELETE","VEHICLES.EDIT","VEHICLES.LIST"],USERS_MANAGEMENT:["USERS.CREATE","USERS.DELETE","USERS.EDIT","USERS.LIST"],AREAS_MANAGEMENT:["AREAS.CREATE","AREAS.DELETE","AREAS.EDIT","AREAS.LIST"]};function W(){var I,h,C,O,G,f;const{hasPermitGroup:r,hasPermitFor:a,hasAdminRank:n,permits:c}=v();u.useState(!1);const[l,i]=u.useState(!1);u.useEffect(()=>{i(a([P]))},[a]);const{authInfo:E}=b(),N=(C=(h=(I=E==null?void 0:E.auth)==null?void 0:I.roles)==null?void 0:h.map(({permissions:e})=>e))==null?void 0:C.flat(),[s,R]=u.useState({selectedUsers:[],source:[],dest:[]}),{deligations:S,submitDeligationOn:g}=j({user_id:(G=(O=s==null?void 0:s.selectedUsers)==null?void 0:O[0])==null?void 0:G._id});u.useEffect(()=>{if(S==null||N==null)return;const e=D(S.permissions),A=N.filter(m=>!S.permissions.includes(m)),o=D(A);R({...s,source:o,dest:e})},[S]);function T(e,A,o){const m={...s};m[A]=m[A].filter(V=>V.key!=e.key),m[o].push(e),R(m)}function M(e){R({...s,selectedUsers:(e==null?void 0:e.length)>0?[e[1]||e[0]]:[]})}async function U(){const e=s.dest.map(({value:o})=>o).flat(),A=s.source.map(({value:o})=>o).flat();g(s.selectedUsers[0]._id,e,A).then(()=>{w.showSuccess("تفویض اختیار انجام شد")})}return d("div",{className:"DeligationManager-component",children:[t("div",{className:"row",children:t("div",{className:"col-12",children:d("div",{className:"search-user-div",children:[t("h1",{className:"mx-2 mt-6",children:"جهت تفویض اختیارات خود به همکاران نام یا کد پرسنلی را جستجو کنید"}),t(H,{smallChips:!0,externalState:[s.selectedUsers,M],showListOnTop:!1,permissions:[],search_all:!0})]})})}),((f=s==null?void 0:s.selectedUsers)==null?void 0:f.length)>0&&S!=null&&d(x,{children:[d("div",{className:"row",children:[t("div",{className:"col-6",children:t("div",{children:d("div",{className:"box",children:[t("div",{className:"title",children:"مجوز های من"}),s.source.map(e=>t("div",{className:"item-div",onClick:()=>T(e,"source","dest"),children:e.label}))]})})}),t("div",{className:"col-6",children:t("div",{children:d("div",{className:"box",children:[t("div",{className:"title",children:"تفویض شده"}),s.dest.map(e=>t("div",{className:"item-div",onClick:()=>T(e,"dest","source"),children:e.label}))]})})})]}),t("div",{className:"row",children:t("div",{className:"col-12",children:d("div",{className:"btn-div",children:[l===!0&&t(p,{onClick:U,children:"اعمال تفویض اختیار"}),l===!1&&t(p,{disabled:!0,className:"NoPermission",children:"اعمال تفویض اختیار"})]})})})]})]})}function D(r){const a={};for(let n=0;n<r.length;n++){const c=r[n];Object.entries(_).map(([l],i)=>{_[l].includes(c)&&(a[l]==null&&(a[l]=[]),a[l].push(c))})}return Object.entries(a).map(([n,c])=>({key:n,value:c,label:y(n)}))}export{W as default};
