import{r as d,b as e,j as l,h as re,i as oe,p as de,k as ue,l as Ne,B as Ve,u as Se,m as me,P as ge,n as Ce,o as Oe,F as q,q as Be,t as $e,v as Ge,w as ye,x as M,f as R,y as Ee,z as He,M as ae,A as je,E as Ye,C as ze,S as We,G as fe,H as Qe,I as pe,J as we,K as Je}from"./index-a6150745.js";import{B as Ke}from"./Breadcrumb-4723adc1.js";import{a as Re,M as xe,u as Ie}from"./useConfirmModal-06992f97.js";import{P as Te,M as Xe,_ as Me,a as Ze,b as et,c as tt}from"./PassengerServiceRequest-8438de00.js";import{u as st}from"./useRestrictionShowRequests-26a99d3a.js";import{r as x}from"./renderUi-054e105a.js";import{F as at}from"./index.esm-e143600b.js";import{u as ne}from"./useVehicleBasicData-c63851ee.js";import{S as ie}from"./SimpleButton-08510570.js";import{M as nt}from"./MapContainer-4d9f8ebf.js";import{g as lt,c as it}from"./carIcon-581ea059.js";import{u as ct}from"./useSocket-8b3223ec.js";import{M as rt}from"./MissionHistory-e04c4acd.js";import{R as ot}from"./RequestHistory-45d2ae95.js";import{U as dt,a as ut}from"./UsersSuggestionInput-e4a9c6c6.js";import{T as mt}from"./TitledSparator-ee9cb6d1.js";import"./marker-red-cc8765ae.js";import"./BottomSheetModal-e5567c0c.js";import"./useFavorite-4befdb3f.js";import"./useNeshanApi-89a34043.js";import"./useVehicles-13ecc312.js";import"./useItemSetToggle-8cfcb24a.js";import"./comments-4f6f4135.js";import"./Comments-28f160d8.js";import"./useComments-08a326de.js";import"./Chips-194944be.js";import"./SuggestionTextInput-0628c8fd.js";const ht=t=>{const[s,r]=d.useState(t.defaultActiveTab),n=c=>{r(c),t.onTabChange(c)};return e("div",{className:"TabLayout-component",children:e("select",{className:"form-select",onChange:c=>n(c.target.value),children:t.tabs.map(c=>e("option",{value:c.key,selected:s===c.key,children:c.label},c.key))})})};const ke="request.admin",ft="request.dispatch",De="request.history",Fe="mission.history";const pt=t=>{const[s,r]=d.useState(!1),n=()=>{r(!s)};return l("div",{className:"FloatingButtonWithModal-component",children:[e("i",{className:"fa fa-plus icon",style:{display:s?"none":"block"},onClick:n}),e("i",{className:"fa fa-remove icon",style:{display:s?"block":"none"},onClick:n}),e("div",{style:{display:s?"block":"none"},className:"pishkhan-div",children:t.children})]})},ce=t=>{const s=Re();return{ui:e(xe,{...s,...t,renderContent:u=>u?l("div",{className:re({"lg:w-90":!t.ignoreFixedWidth}),children:[e("label",{className:"inline-block px-1 pt-2 text-sm",children:t.title||"<title>"}),e("div",{children:t.renderContent})]}):""}),show:u=>{s.handle_open(u)},hide:()=>{s.handle_close()}}},_t=t=>{const{ui:s,show:r}=ce({renderContent:l("div",{children:[l("div",{className:"m-2",children:[e("label",{className:"inline-block p-2  text-primary",children:"بازه تاریخی"}),e(oe,{range:!0,dateSeparator:" , ",calendar:de,locale:ue,format:"DD MMMM YYYY",className:"datetime-picker",inputClass:"datetime-input"})]}),l("div",{className:"m-2",children:[e("label",{className:"inline-block w-full p-2 text-primary",children:"وضعیت"}),e("div",{className:"flex flex-col",children:Ne.map(([c,u])=>l("span",{className:"inline-flex pl-4",children:[e("label",{htmlFor:c,className:"w-32 cursor-pointer p-1 px-2",children:u}),e("input",{name:`${c}`,id:`${c}`,type:"checkbox",className:"cursor-pointer"})]},c))})]}),e("button",{className:"mt-2 w-full rounded bg-primary p-2 text-white",children:"اعمال"})]})}),n=()=>{r({})};return l("div",{className:re("relative w-full rounded-lg shadow",t.className),children:[s,e("input",{type:"text",placeholder:"جستجو...",className:"w-full bg-transparent p-2 pl-9 pr-4 focus:outline-none"}),e(Ve,{onClick:n,className:"absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer",size:24})]})};const qe=t=>{const s=Re();return{ui:e(xe,{...s,...t,mode:"fullscreen",renderContent:t.renderContent,zIndex:t.zIndex}),show:u=>{s.handle_open(u)},close:()=>{s.handle_close()}}};function Ue(){const{show:t,ui:s,close:r}=qe({renderContent:({data:n,submitCallback:c})=>{if(n==null)return"";const u={_id:n._id,service:n.service,datetime:[n.gmt_for_date],...n.details},N=n.locations.map(p=>({lat:p.coordinates[0],lng:p.coordinates[1],...p.meta}));return l("div",{children:[e("h2",{className:"p-2 text-primary",children:"ویرایش درخواست کاربر"}),e(Te,{mode:Xe,submitCallback:c,initialLocations:N,initialValues:u,className:"!top-12"})]})}});return{showFullScreenModal:t,FullScreenModalUi:s,closeFullScreenModal:r}}const ee="confirm",vt="reject",bt=t=>{var L;const{requests:s,triggerRemoveFromList:r,update:n}=t.requests,{authInfo:c}=Se(),{result:u,state:N,refreshData:p}=st("select",6,0),[m,v]=d.useState(100);d.useEffect(()=>{u&&u.data&&u.data[0]&&v(parseInt(u.data[0].value))},[u]),d.useEffect(()=>{},[m]);const _=new Date,S=new Date;S.setDate(_.getDate()+m);const{hasPermitGroup:a,hasPermitFor:y,hasAdminRank:b,permits:g}=me(),[C,k]=d.useState(!1),[$,U]=d.useState(!1),{showFullScreenModal:P,FullScreenModalUi:X,closeFullScreenModal:Z}=Ue(),{show:W,ui:Q}=Ie(null);d.useEffect(()=>{k(y([ge,Ce])),U(y([Oe]))},[y]);const G=f=>{P({data:f,submitCallback:E=>{Z(),t.editCallback(E)}})},J=f=>{W({title:"افزودن درخواست به پیش نویس",desc:"از افزودن درخواست به پیشنویس اطمینان دارید؟",label_confirm:"بله، اضافه کن",label_cancel:"خیر",onConfirm:()=>{var E;(E=t.handle_assignRequestToDraft)==null||E.call(t,f)}})},A=(f,E)=>{W({title:"تغییر وضعیت درخواست",desc:`از ${E==ee?"تایید":"رد"} درخواست اطمینان دارید؟`,label_confirm:`${E==ee?"تایید کن":"رد کن"}`,label_cancel:"خیر",onConfirm:()=>{M().updateRequestStatus(f._id,E).then(({data:I})=>{E!=ee?r(f._id):n(I)}).catch(I=>{R.showError(I.message)})}})};return l(q,{children:[Q,X,(L=s==null?void 0:s.docs)==null?void 0:L.map(f=>{var V,O,B,H,j;let E=new Date(f.gmt_for_date);if(!(E>=Be(_)&&E<=$e(S)))return null;const I=(V=t.draftMission)==null?void 0:V.contains(f);return l("div",{className:`ServiceRequestCard-component ${f.removed?"!pointer-events-none":""} ${I?"selected-border":""} `,children:[l("div",{className:"row",children:[l("div",{className:"col-3",children:[e("p",{className:"title1",children:"درخواست دهنده"}),e("p",{children:(O=f.submitted_by)==null?void 0:O.full_name})]}),l("div",{className:"col-3",children:[e("p",{className:"title1",children:"زمان مورد درخواست "}),e("p",{children:Ge(f.gmt_for_date)})]}),(H=(B=c==null?void 0:c.org)==null?void 0:B.requestsDetailsDisplayColumns)==null?void 0:H.map(({key:D,title:F})=>l("div",{className:"col-3",children:[l("p",{className:"title1",children:[" ",F,"  "]}),e("p",{children:f.details[D]})]},D))]}),e("div",{className:"row",children:e("div",{className:"col-12",children:e("div",{className:"location-div",children:(j=f.locations)==null?void 0:j.map((D,F)=>l("div",{className:"loc",children:[e("span",{className:"loc-title",children:`ایستگاه ${ye(f.locations.length,F)}`}),e("p",{children:D.meta.address})]}))})})}),e("div",{className:"row",children:e("div",{className:"col-12",children:l("div",{className:"buttons",children:[f.status!="PENDING"&&e("span",{children:Ne[f.status]}),C===!0&&e("button",{onClick:()=>G(f),className:"my-btn",children:"ویرایش"}),C===!1&&e("button",{disabled:!0,className:"my-btn NoPermission",children:"ویرایش"}),!I&&f.status=="CONFIRM"&&e("button",{onClick:()=>J(f),className:"my-btn",children:"افزودن به پیش نویس"}),f.status=="PENDING"&&l(q,{children:[C===!0&&l(q,{children:[e("button",{onClick:()=>A(f,ee),className:"my-btn",children:"تایید درخواست"}),e("button",{onClick:()=>A(f,vt),className:"my-btn",children:"رد درخواست"})]}),C===!1&&l(q,{children:[e("button",{disabled:!0,className:"my-btn NoPermission",children:"تایید درخواست"}),e("button",{disabled:!0,className:"my-btn NoPermission",children:"رد درخواست"})]})]})]})})})]},f._id)})]})},Nt=t=>l("span",{...t,className:re("flex",{"flex-col":!t.inline,"flex-row":t.inline},t.className||""),children:[e("span",{className:"text-primary pb-1",children:t.title}),e("p",{className:"whitespace-pre-wrap",children:t.desc})]}),St="/assets/user-01-b007ff3f.png",z="tab-requests",se="tab-services",te="tab-fleet",gt="publish",_e="ready",Pe="PUBLISHED";function le(t){var c,u,N,p;const{vehicle:s,basicData:r}=t;if(s==null||r==null)return"";const n=((c=s==null?void 0:s.extra)==null?void 0:c.agency_name)==null;return l("div",{className:"VehicleItem-component",children:[e("div",{children:n?e("span",{className:"name",children:((u=s==null?void 0:s.driver_user)==null?void 0:u.full_name)||"بدون راننده"}):l("span",{children:[e("span",{className:"name",children:"آژانس : "}),e("span",{children:(N=s==null?void 0:s.extra)==null?void 0:N.agency_name})]})}),n&&l(q,{children:[Object.entries(s.extra).map(([m,v])=>e("span",{children:Ee(v,r[`${m}s`])})),"(",(p=s.services)==null?void 0:p.map((m,v)=>{var _,S,a;return l("span",{children:[(S=(_=r==null?void 0:r.services)==null?void 0:_.find)==null?void 0:S.call(_,y=>y.key==m.service).title,v!=((a=s.services)==null?void 0:a.length)-1?" , ":""]})}),")"]})]})}const Ct=t=>{var n,c;const{missions:s}=He({mode:ae,status:Pe}),{data:r}=ne();return(c=(n=s==null?void 0:s.data)==null?void 0:n.docs)==null?void 0:c.map(u=>e(q,{children:e(yt,{vehicleBasicData:r,prompt_onMissionReady:t.prompt_onMissionReady,triggerVehicleAssignment:t.triggerVehicleAssignment,mission:u},u._id)}))};function yt(t){const{mission:s,vehicleBasicData:r}=t;return e("div",{className:"bg-white dark:bg-boxdark shadow p-4 rounded-md",children:l("div",{className:"flex flex-col lg:flex-row",children:[e("div",{className:"flex-1 whitespace-nowrap overflow-hidden ",children:s.service_requests.map(n=>e(Et,{request:n},n._id))}),l("div",{className:"lg:w-64",children:[l("div",{onClick:()=>{var n;return(n=t.triggerVehicleAssignment)==null?void 0:n.call(t,t.mission,se)},className:"p-2 mx-1 h-32 relative",children:[x(e("div",{className:"rounded border border-dashed hover:text-primary hover:border-primary absolute top-2 left-0 right-0 bottom-2 cursor-pointer flex items-center justify-center",children:e(at,{className:"duration-300",size:32})})).if(s.vehicle_id==null),x(e("div",{className:"rounded border border-dashed hover:text-primary hover:border-primary absolute top-2 left-0 right-0 bottom-2 cursor-pointer flex-col flex items-center justify-center",children:e(le,{vehicle:s.vehicle_id,basicData:r})})).if(s.vehicle_id!=null)]}),x(e("div",{className:"px-1",children:e(ie,{onClick:()=>{var n;return(n=t.prompt_onMissionReady)==null?void 0:n.call(t,t.mission)},className:"mt-4 mb-2 w-full",children:"تایید نهایی"})})).if(s.status==Pe&&s.vehicle_id!=null)]})]})})}function Et(t){var r;const{request_id:s}=t.request;return e("div",{className:"card inline-block align-top w-full lg:w-1/4",children:l("div",{className:"m-2 p-2 bg-white rounded-lg border border-gray-4 shadow",children:[l("span",{className:"flex items-center mb-2",children:[e("span",{className:"h-10 w-10 rounded-full",children:e("img",{src:St,alt:"User"})}),e("label",{className:"mx-1",children:s.submitted_by.full_name})]}),l("span",{className:"flex items-center justify-center text-center pb-2",children:[e(je,{className:"w-12",size:20}),e(oe,{disableDayPicker:!0,calendar:de,locale:ue,format:"HH:mm",className:"datetime-picker",inputClass:"datetime-input !w-32 !text-center !text-lg !p-4",plugins:[e(Me,{hideSeconds:!0})],value:s.gmt_for_date})]}),(r=s.locations)==null?void 0:r.map((n,c)=>{var u;return e(Nt,{className:"flex-1 my-1 text-xs",title:`ایستگاه ${ye(s.locations.length,c)}`,desc:(u=n==null?void 0:n.meta)==null?void 0:u.address},n._id)})]})})}const Ae=t=>{var y,b;const{fleetData:s}=t,{data:r}=ne(),n=d.useRef(),[c,u]=d.useState(!1),[N,p]=d.useState(null),[m,v]=d.useState(null);lt(c,N,n,it,.015),d.useEffect(()=>{var g,C,k,$;if(console.log(7820,(C=(g=s==null?void 0:s.data)==null?void 0:g.vehicles)==null?void 0:C.docs),n){v("driver");const U=[];($=(k=s==null?void 0:s.data)==null?void 0:k.vehicles)==null||$.docs.map(P=>{(_===null||_===P._id)&&U.push(P._id)}),p(U),u(!0)}},[s,n]);const[_,S]=d.useState(null),a=g=>{S(g),console.log(55,g)};return e("div",{className:"TransportFleet-component",children:l("div",{className:"row",children:[e("div",{className:"col-12 col-md-3",children:l("div",{className:"search-div",children:[_!==null&&e("button",{className:"my-btn",onClick:()=>S(null),children:"نمایش همه"}),e("input",{className:"search",placeholder:"جستجوی رانندگان ..."}),e("div",{className:"driver-list",children:(b=(y=s==null?void 0:s.data)==null?void 0:y.vehicles)==null?void 0:b.docs.map(g=>l("div",{className:"vehicle-list",onClick:()=>{var C;return(C=t.handle_onVehicleClick)==null?void 0:C.call(t,g)},children:[e("i",{className:"fa fa-eye icon-eye",onClick:()=>a(g._id)}),e(le,{vehicle:g,basicData:r})]},g._id))})]})}),e("div",{className:"col-12 col-md-8",children:e("div",{className:"map-div",children:e("div",{className:"location-div",children:e(nt,{mapRef:n})})})})]})})};function wt(){const[t,s]=d.useState({data:null}),r=p=>{var m,v;return((v=(m=t.data)==null?void 0:m.service_requests)==null?void 0:v.find(({request:_})=>_._id==p._id))!=null},n=p=>{const m={...t.data},v=p._id;m.service_requests=m.service_requests.map(({request:_})=>_._id==v?{request:{...p,submitted_by:_.submitted_by}}:{request:_}),s({...t,data:m})},c=p=>{if(t.data==null)return;const m={...t.data};return m.service_requests.push({request:p}),s({...t,data:m}),M().assignRequestToMission(t.data._id,p._id)},u=p=>{if(t.data==null)return;const m={...t.data};return m.service_requests=m.service_requests.filter(({request:v})=>v._id!=p._id),s({...t,data:m}),M().removeRequestFromMission(t.data._id,p._id)},N=()=>{M().getDraftMission().then(({data:p})=>s({data:p})).catch(console.log)};return d.useEffect(()=>{N()},[]),{data:t.data,assignRequestToDraft:c,removeRequestFromDraft:u,contains:r,update:n,reloadDraft:N}}function Le(){const[t,s]=d.useState({vehicles:null});function r(n){M().getSortedVehicles(n).then(({data:c})=>{s({...t,vehicles:c})}).catch(console.log)}return d.useEffect(()=>{r()},[]),{data:t}}const ve="select-vehicle-for-mission",Rt={status:"PENDING,CONFIRM"},xt=()=>{var J,A,L,f,E,I,V,O,B,H,j,D,F;const[t,s]=d.useState({}),r=Le(),[n,c]=d.useState({}),{show:u,ui:N}=Ie(""),p=o=>{var h,w,T,Y,he;if(((w=(h=r==null?void 0:r.data)==null?void 0:h.vehicles)==null?void 0:w.docs)==null)return;const i={};(he=(Y=(T=r==null?void 0:r.data)==null?void 0:T.vehicles)==null?void 0:Y.docs)==null||he.map(K=>{i[K._id]={vehicle_gps:o[K._id],user_gps:(K==null?void 0:K.driver_user)&&o[K.driver_user._id]}}),s(i)};ct({listeners:{[Ye]:p}});const{data:m}=ne(),{showFullScreenModal:v,FullScreenModalUi:_,closeFullScreenModal:S}=Ue(),a=wt(),y=ze({initialParams:Rt,mode:ae}),[b,g]=d.useState({visible_tab:z});function C(o,i=!0){g({...b,visible_tab:o}),i&&c({})}function k(o){a.contains(o)&&a.update(o),y.update(o)}async function $(o){v({data:o,submitCallback:i=>{S(),k(i)}})}async function U(o){try{const{data:i}=await a.removeRequestFromDraft(o);y.update(i.serviceRequest,!0),R.showSuccess("درخواست از پیش نویس حذف شد")}catch(i){R.showError(pe(i))}}async function P(o){try{const{data:i}=await a.assignRequestToDraft(o);y.update(i.serviceRequest),R.showSuccess("درخواست به پیش نویس اضافه شد")}catch(i){R.showError(pe(i))}}function X(o){n.current==ve&&M().assignVehicleToMission(n.mission._id,o._id).then(()=>{n.callback_tab==z&&a.reloadDraft(),R.showSuccess("خودرو به سرویس اختصاص یافت"),C(n.callback_tab),c({})}).catch(i=>{R.showError(i.message)})}function Z(o){M().removeVehicleFromMission(o._id).then(()=>{a.reloadDraft(),R.showSuccess("خودرو از سرویس حذف شد")}).catch(i=>{R.showError(i.message)})}function W(o){u({title:"تایید نهایی سرویس",desc:"به تایید نهایی سرویس اطمینان دارید؟",label_confirm:"تایید شود!",label_cancel:"خیر",onConfirm:()=>{M().updateMissionStatus(o==null?void 0:o._id,_e).then(()=>{R.showSuccess("سرویس ما موفقیت تایید شد."),a.reloadDraft()}).catch(i=>{R.showError(i.message)})}})}function Q({setAsReady:o}){u({title:o?"تایید سرویس":"انتشار سرویس",desc:o?"آیا از تایید نهایی سرویس اطمینان دارید؟":"آیا از انتشار سرویس اطمینان دارید؟",label_confirm:o?"تایید شود!":"منتشر شود!",label_cancel:"خیر",onConfirm:()=>{var i;M().updateMissionStatus((i=a==null?void 0:a.data)==null?void 0:i._id,o?_e:gt).then(()=>{R.showSuccess("اطلاعات با موفقیت حذف شد"),a.reloadDraft()}).catch(h=>{R.showError(h.message)})}})}function G(o,i){C(te,!1),c({current:ve,mission:o,callback_tab:i})}return l("div",{className:"RequestManagment-component",children:[N,_,l("div",{className:"row",children:[e("div",{className:"col-12 col-md-8",children:e(_t,{})}),l("div",{className:"col-12 col-md-4",children:[e("button",{onClick:()=>C(z),className:`link ${b.visible_tab==z?"active-tab":"no-active"}`,children:e("span",{children:"درخواست"})}),e("button",{onClick:()=>C(se),className:` link ${b.visible_tab==se?"active-tab":"no-active"}`,children:e("span",{children:"سرویس"})}),e("button",{onClick:()=>C(te),className:` link ${b.visible_tab==te?"active-tab":"no-active"}`,children:e("span",{children:"ناوگان"})})]})]}),e("div",{className:"row",children:l("div",{className:"col-12",children:[x(e(bt,{editCallback:k,requests:y,draftMission:a,handle_assignRequestToDraft:P})).if(b.visible_tab==z),x(e(Ct,{prompt_onMissionReady:W,triggerVehicleAssignment:G})).if(b.visible_tab==se),x(e(Ae,{handle_onVehicleClick:X,fleetData:r})).if(b.visible_tab==te)]})}),l(pt,{children:[x(e(We,{})).if((a==null?void 0:a.data)==null),x(e("label",{className:"lbl-text",children:"هیچ درخواستی در پیش نویس وجود ندارد"})).if(((A=(J=a==null?void 0:a.data)==null?void 0:J.service_requests)==null?void 0:A.length)===0),x(e("div",{children:(f=(L=a==null?void 0:a.data)==null?void 0:L.service_requests)==null?void 0:f.map(({request:o})=>{var i,h;return l("div",{className:"relative mx-2 my-4 rounded py-2 pl-6 pr-10 shadow duration-200",children:[e(fe,{onClick:w=>U(o),className:"absolute right-0 top-0 h-10 w-10 cursor-pointer p-2 hover:text-danger"}),l("div",{className:"relative flex items-center border-b border-gray-2",children:[l("div",{className:"flex flex-col",children:[e("span",{className:"text-primary",children:(i=o.submitted_by)==null?void 0:i.full_name}),e("span",{className:"text-xs",children:Ee(o.service,m.services)})]}),e("div",{className:"py-2 pr-6 text-xs",children:e(oe,{onChange:w=>{},disableDayPicker:!0,calendar:de,locale:ue,format:"HH:mm",className:"datetime-picker",inputClass:"datetime-input !w-24 !text-center !text-lg !p-4",plugins:[e(Me,{hideSeconds:!0})],value:o.gmt_for_date})}),e(Qe,{onClick:()=>$(o),className:"absolute left-0 top-0 h-10 w-10 cursor-pointer p-2 hover:text-secondary"})]}),l("div",{children:[e("span",{className:"text-primary",children:"مبدا : "}),e("span",{className:"inline-block pt-2",children:(h=o.locations[0].meta)==null?void 0:h.address})]})]})})})).if((a==null?void 0:a.data)!=null),x(e("div",{onClick:()=>G(a==null?void 0:a.data,z),className:"h-28 px-4 pb-4",children:e("div",{className:"relative mx-1 h-full p-2",children:l("div",{className:"absolute bottom-2 left-0 right-0 top-2 flex cursor-pointer items-center justify-center rounded border border-dashed hover:border-primary hover:text-primary",children:[e(fe,{onClick:o=>{o.stopPropagation(),Z(a==null?void 0:a.data)},className:"absolute right-2 top-2 cursor-pointer hover:text-danger"}),e(le,{vehicle:(E=a==null?void 0:a.data)==null?void 0:E.vehicle,basicData:m})]})})})).if(((V=(I=a==null?void 0:a.data)==null?void 0:I.service_requests)==null?void 0:V.length)>0&&((O=a==null?void 0:a.data)==null?void 0:O.vehicle)!=null),x(e(q,{children:l("button",{className:"my-btn",onClick:()=>G(a==null?void 0:a.data,z),children:[e("i",{className:"fas fa-car car-icon"})," انتخاب راننده"]})})).if(((H=(B=a==null?void 0:a.data)==null?void 0:B.service_requests)==null?void 0:H.length)>0&&((j=a==null?void 0:a.data)==null?void 0:j.vehicle)==null),x(l("div",{className:"flex px-4",children:[e(ie,{onClick:()=>Q({setAsReady:!0}),className:"m-1 w-full bg-secondary",children:"انتشار"}),e(ie,{onClick:()=>Q({setAsReady:!0}),className:"m-1 w-full",children:"تایید نهایی"})]})).if(((F=(D=a==null?void 0:a.data)==null?void 0:D.service_requests)==null?void 0:F.length)>0)]})]})};function It(){var o;const[t,s]=d.useState(!1),{hasPermitFor:r}=me();d.useEffect(()=>{s(r([we]))},[r]),d.useEffect(()=>{},[t]);const[n,c]=d.useState({activeUser:null}),{authInfo:u}=Se(),[N,p]=d.useState({}),[m,v]=d.useState({}),[_,S]=d.useState({}),[a,y]=d.useState(null),[b,g]=d.useState([]),C=Le(),{data:k}=ne(),$=i=>{p({...N,[i.target.name]:i.target.value}),console.log(51,N)},U=()=>{p({}),v({}),S({}),y(null),g([]),c({...n,activeUser:null})},P=()=>{console.log(3e3,b);const i=b.map((w,T)=>{const Y=et(N,_[b[T]._id],"","");return Y.submitted_for=w,Y});console.log(441,i);const h={extra:{...N},data:i,vehicle_id:a==null?void 0:a._id};console.log(71,h),M().submitFullMission(h).then(({data:w})=>{console.log(8),R.showSuccess("سرویس با موفقیت ثبت شد"),U(),L(),F()}).catch(w=>{console.log(7),R.showError(w.message)})},X=i=>{y(i),Q(),A({})},{ui:Z,show:W,hide:Q}=ce({title:"انتخاب خودرو",zIndex:9000001,ignoreFixedWidth:!0,renderContent:e("div",{children:e("div",{children:e(Ae,{handle_onVehicleClick:X,fleetData:C})})})}),G=()=>{W({}),L()},{ui:J,show:A,hide:L}=ce({title:"اطلاعات تکمیلی",zIndex:4,renderContent:l("div",{children:[e(Ze,{formState:N,fields:(o=u==null?void 0:u.org)==null?void 0:o.additionalTripFields,onInputChange:$}),e(mt,{title:"انتخاب خودرو"}),l("div",{onClick:G,children:[x(e("i",{className:" fa fa-car"})).if(a==null),e("div",{children:e(le,{vehicle:a,basicData:k})})]}),e("button",{className:"my-btn",onClick:P,children:"ثبت سفر"})]})}),f=()=>{A({})},E=i=>{const h=b.filter(Y=>Y._id!=i._id);g(h);const w={...m};delete w[i._id],v(w);const T={..._};delete T[i._id],S(T),h.length==0&&c({...n,activeUser:null})},I=i=>{const h=i.target.value;Object.keys(m).length<(h==null?void 0:h.length)&&(h==null||h.map(T=>{m[T._id]==null&&(V(T,{}),O(T,{locations:[]}))})),n.activeUser==null&&B(h==null?void 0:h[0])},V=(i,h)=>{v({...m,[i._id]:h})},O=(i,h)=>{S({..._,[i._id]:h})},B=i=>{c({...n,activeUser:i})},H=(i,h)=>{console.log(5)},{show:j,ui:D,close:F}=qe({renderContent:({})=>l("div",{className:"useCreateTripModal-component",children:[e("div",{children:e("div",{children:e(dt,{freeInput:t===!0,hideChips:!0,showListOnTop:!1,externalState:[b,g],permissions:["SERVICE.PERSONAL.SUBMIT"],include_external_base:!0,onChange:I})})}),l("div",{children:[e("div",{children:e(ut,{highlights:n.activeUser?[n.activeUser]:[],smallChips:!0,list:b,onChipsItemClick:B,handleRemove:E})}),l("div",{children:[x(e("div",{className:"search-default-text",children:"مسافر مورد نظر را جستجو کنید ..."})).if((b==null?void 0:b.length)==0),b.map(i=>{var h;if(i._id==((h=n.activeUser)==null?void 0:h._id))return e(Te,{mode:tt,externalState:[m[i._id],w=>V(i,w)],externalUserInput:[_[i._id],w=>O(i,w)],overrideOnSubmit:H},i._id)})]})]}),l("div",{children:[J,e("button",{className:"my-btn regist-btn",onClick:f,children:"ثبت درخواست"})]}),Z]})});return{showFullScreenModal:j,FullScreenModalUi:D,closeFullScreenModal:F}}const be=[{key:ke,label:"مدیریت درخواست ها"},{key:De,label:"تاریخچه درخواست ها"},{key:Fe,label:"تاریخچه سرویس ها"}];function ss(){const[t,s]=d.useState(be[0].key),r=It(),{hasPermitGroup:n,hasPermitFor:c,hasAdminRank:u,permits:N,authInfo:p,type:m}=me(),[v,_]=d.useState(!1),[S,a]=d.useState(!1),[y,b]=d.useState(!1);return d.useEffect(()=>{},[S]),d.useEffect(()=>{a(c([we,Je])),b(c([ge,Ce])),_(!0)},[c]),d.useEffect(()=>{},[v]),l(q,{children:[v===!1&&e("p",{children:"در حال لود شدن ...."}),v===!0&&l("div",{className:"tripmission-component",children:[e("div",{className:"row",children:e("div",{className:"col-12",children:e(Ke,{pageName:"مدیریت سفر ها"})})}),e("div",{className:"row",children:e("div",{className:"col-12",children:l("div",{className:"NoPermission-div ",children:[S===!0&&l("button",{className:"my-btn flex-center",onClick:()=>{r.showFullScreenModal({data:{}})},children:[e("span",{children:"ایجاد سفر"}),e("i",{className:"fa fa-plus plus flex-center"})]}),S===!1&&e(q,{children:l("button",{disabled:!0,className:"my-btn NoPermission",children:[e("span",{children:"ایجاد سفر"}),e("i",{className:"fa fa-warning info-icon"}),e("div",{className:"info-message alert alert-warning",children:m==="SystemInActive"?"سیستم غیر فعال است":m==="No_WorkingWeek"?"امروز روز کاری نیست":""})]})})]})})}),e("div",{className:"row",children:e("div",{className:"col-12",children:e(ht,{tabs:be,defaultActiveTab:t,onTabChange:s})})}),e("div",{className:"row",children:l("div",{className:"col-12",children:[function(){switch(t){case ke:return e(xt,{});case ft:return"2";case De:return e(ot,{mode:ae});case Fe:return e(rt,{mode:ae,paging:!1,status:"DONE"})}}(),r.FullScreenModalUi]})})]})]})}export{ss as default};
