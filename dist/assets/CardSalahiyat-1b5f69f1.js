import{r as s,y as T,u as He,U as h,f as C,j as l,c as a,F as v,aq as Ve,k as H,p as V,l as $,bt as $e,bu as ze,bv as We,bw as Je,bh as z}from"./index-4b638fea.js";import{O as ye,F as je}from"./FileUpload-a1b75713.js";import{c as W}from"./dateTools-587f68dc.js";import{u as Ke}from"./useAganceDriver-96d5f859.js";import{W as ve}from"./WordProcessor-87b83d1d.js";import{u as Qe}from"./validation-753ab0c5.js";import{P as Xe}from"./Page403-34de9313.js";import"./style-3087b5d5.js";function Ze(M,D){const[P,S]=s.useState(null),[w,A]=s.useState(null),[f,d]=s.useState({in_progress:!1});function b(){switch(M){case"select":d({...f,in_progress:!0}),T().select_carteSalahiyat().then(n=>{S(n),A("select")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{d({...f,in_progress:!1})});break;case"insert":D!==null&&(d({...f,in_progress:!0}),T().insert_carteSalahiyat(D).then(n=>{S(n),A("insert")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{d({...f,in_progress:!1})}));break;case"update":D!==null&&(d({...f,in_progress:!0}),T().update_carteSalahiyat(D).then(n=>{S(n),A("update")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{d({...f,in_progress:!1})}));break;case"delete":d({...f,in_progress:!0}),T().delete_carteSalahiyat(D._id).then(n=>{S(n),A("delete")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{d({...f,in_progress:!1})});break}}return s.useEffect(()=>{M&&b()},[M]),{result:P,type:w,state:f,refreshData:b}}const Me="/assets/carteSalahiyat-8453080f.docx",ea={fishNumber:{required:!0,showName:"شماره فیش"},fishPrice:{required:!0,min:100,showName:"مبلغ فیش"},fishDate:{required:!0,showName:"تاریخ فیش"},attachFile:{required:!0,showName:"تصویر درخواست تمدید یا معرفی نامه محل فعالیت  "}},Se={fishNumber:"",fishPrice:"",fishDate:"",attachFile:void 0},Da=({handleBackClick:M,title:D})=>{var ie,oe,me,he,ue,fe,de,pe,De,Ye,ge;D="صدور کارت صلاحیت";const[P,S]=s.useState(!1),{authInfo:w}=He(),[A,f]=s.useState(""),[d,b]=s.useState({CREATE:!1,EDIT:!1,DELETE:!1});s.useEffect(()=>{var p,o;let e={CREATE:!1,EDIT:!1,DELETE:!1},r="";(o=(p=w==null?void 0:w.auth)==null?void 0:p.roles)==null||o.map(Y=>{Y.permissions.map(g=>{g===ze&&(e.CREATE=!0),g===We&&(e.EDIT=!0,r+="- update -"),g===Je&&(e.DELETE=!0,r+="- delete -")})}),b(e),f(r)},[w]);const n=s.useRef(null),J=s.useRef(null),K=e=>{e.current&&e.current.clearFileInput()},Q=s.useRef(new ye),k=Q.current;s.useEffect(()=>{u({...t,_id:k.toString()})},[k]);const[we,R]=s.useState(!1),[X,I]=s.useState(""),[Ae,y]=s.useState("select"),[N,x]=s.useState("insert"),[O,Ce]=s.useState("insert"),[Fe,U]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[aa,Z]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[_e,G]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[ta,ee]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[be,ae]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[sa,L]=s.useState(h(new Date).format("jYYYY/jMM/jDD")),[la,te]=s.useState(!1),[q,se]=s.useState({}),[t,u]=s.useState(Se),le=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],ke=[{key:"",name:A},{key:"driverFullName",name:"نام و نام خانوادگی",img:!1},{key:"driverNatNum",name:"کد ملی"},{key:"shomareParvane",name:"شماره پرونده"}],[j,Ee]=s.useState([]),[Te,Pe]=s.useState([]),[E,Re]=s.useState([]),{result:F}=Ke("select",null),{result:i,type:Ie,state:ra,refreshData:ca}=Ze(Ae,t),{errors:c,refreshData:na}=Qe(ea,t);s.useEffect(()=>{var e;F&&Re((e=F==null?void 0:F.data)==null?void 0:e.data)},[F]),s.useEffect(()=>{console.log(400,E)},[E]),s.useEffect(()=>{var e,r;if(i)switch(Ie){case"insert":(i==null?void 0:i.status)===200?(C.showSuccess("کارت  صلاحیت ثبت شد"),y("select")):C.showError("کارت  صلاحیت ثبت نشد");break;case"update":(i==null?void 0:i.status)===200?(C.showSuccess("کارت  صلاحیت ویرایش شد"),y("select")):C.showError("کارت  صلاحیت ویرایش نشد");break;case"delete":(i==null?void 0:i.status)===200?(C.showSuccess("کارت  صلاحیت حذف شد"),y("select")):C.showError("کارت  صلاحیت حذف نشد");break;case"select":Pe((e=i==null?void 0:i.data)==null?void 0:e.data),xe((r=i==null?void 0:i.data)==null?void 0:r.data),B();break}},[i]);const xe=e=>{Ee(()=>e.map(r=>({...r})))},B=()=>{U(h(new Date).format("jYYYY/jMM/jDD")),Z(h(new Date).format("jYYYY/jMM/jDD")),G(h(new Date).format("jYYYY/jMM/jDD")),ee(h(new Date).format("jYYYY/jMM/jDD")),ae(h(new Date).format("jYYYY/jMM/jDD")),L(h(new Date).format("jYYYY/jMM/jDD")),re(),R(!1),I(""),Q.current=new ye,u(Se),se({}),y(null),x("insert")},re=()=>{K("moarrefiNameMahaleFaaliyat"),K("fishPic")},Oe=e=>{U(e),Z(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),u({...t,fishDate:W(z(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},Ue=e=>{G(e),ee(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),u({...t,fromDate:W(z(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},Ge=e=>{ae(e),L(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),u({...t,toDate:W(z(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},ce=(e,r,p,o)=>{se(Y=>({...Y,[r]:e})),o===!1&&u({...t,attachFile:{...t.attachFile,[r]:p}})};s.useEffect(()=>{console.log(200,q)},[q]);const Le=e=>{switch(e){case"insert":y("insert");break;case"update":y("update");break}},qe=(e,r)=>{var p,o,Y,g,_,Ne;if(r==="delete"&&(u(e),y("delete")),r==="update"){re();const m=Te.filter(Be=>Be._id===e._id)[0];(p=m==null?void 0:m.attachFile)!=null&&p.moarrefiNameMahaleFaaliyat&&((Y=n.current)==null||Y.setFileInput((o=m==null?void 0:m.attachFile)==null?void 0:o.moarrefiNameMahaleFaaliyat)),(g=m==null?void 0:m.attachFile)!=null&&g.fishPic&&((Ne=J.current)==null||Ne.setFileInput((_=m==null?void 0:m.attachFile)==null?void 0:_.fishPic)),U(h(m.fishDate).format("jYYYY/jMM/jDD")),G(h(m.fromDate).format("jYYYY/jMM/jDD")),L(h(m.toDate).format("jYYYY/jMM/jDD")),u(m),x("update")}};s.useEffect(()=>{},[t]),s.useEffect(()=>{},[X]);const ne=e=>{I(q[e]),R(!0)};return l("div",{className:"agance-component",children:[M&&a("i",{className:"fa fa-arrow-left back-icon",onClick:M}),we&&l("div",{className:"myAttachImage",children:[a("img",{className:"upload-img",src:X}),a("i",{className:"fa fa-remove close-icon",onClick:()=>{R(!1),I("")}})]}),a("div",{className:"row",children:a("div",{className:"col-12",children:a("div",{className:"page-title",children:a("i",{onClick:()=>{Ce("insert"),te(N==="insert")},className:O==="insert"?"active":"",children:N==="insert"?D:"بروزرسانی کارت  صلاحیت"})})})}),a("div",{className:"row",children:l("div",{className:"col-12",children:[a("button",{onClick:()=>S(!0),className:"my-btn",children:"صدور کارت"}),P===!0&&a(v,{children:a(ve,{autoReadFile:!0,wordFile:Me,fields:t})})]})}),a("div",{style:{display:`${O==="list"?"":"none"}`},className:"row",children:l("div",{className:"col-12",children:[(j==null?void 0:j.length)>0&&a(Ve,{clickOnRow:qe,pagesize:le[0].value,items:j,options:le,thead:ke}),(j==null?void 0:j.length)<=0&&l("p",{style:{marginTop:"40px"},children:[" ","موردی برای نمایش وجود ندارد"]})]})}),l("div",{style:{display:`${O==="insert"?"":"none"}`},className:"aganceRegister-component",children:[N==="insert"&&d.CREATE===!1&&l("p",{children:[" ",a(Xe,{})]}),(N==="insert"&&d.CREATE===!0||N==="update")&&l(v,{children:[N==="update"&&l(v,{children:[a("button",{onClick:()=>{B(),x("insert")},className:"my-btn",children:D}),a(ve,{autoReadFile:!0,wordFile:Me,fields:{nat_num:t==null?void 0:t.driverNatNum}})]}),l("div",{className:"row",children:[a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"   شماره فیش واریزی "}),a("input",{onChange:e=>u({...t,fishNumber:e.target.value}),value:(t==null?void 0:t.fishNumber)||"",type:"text",className:"form-control"}),((ie=c==null?void 0:c.fishNumber)==null?void 0:ie.length)>0&&a(v,{children:l("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),l("div",{className:"error-msg",children:[" ",(oe=c==null?void 0:c.fishNumber)==null?void 0:oe.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"   مبلغ (ریال)"}),a("input",{onChange:e=>u({...t,fishPrice:e.target.value.replace(/,/g,"")}),value:((me=t==null?void 0:t.fishPrice)==null?void 0:me.replace(/\B(?=(\d{3})+(?!\d))/g,","))||"",type:"text",className:"form-control"}),((he=c==null?void 0:c.fishPrice)==null?void 0:he.length)>0&&a(v,{children:l("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),l("div",{className:"error-msg",children:[" ",(ue=c==null?void 0:c.fishPrice)==null?void 0:ue.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"   تاریخ فیش"}),a(H,{onChange:e=>Oe(e!==null?Array.isArray(e)?e[0]:e:null),calendar:V,locale:$,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:Fe,placeholder:$e(h(new Date).format("jYYYY/jMM/jDD"))}),((fe=c==null?void 0:c.fishDate)==null?void 0:fe.length)>0&&a(v,{children:l("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),l("div",{className:"error-msg",children:[" ",(de=c==null?void 0:c.fishDate)==null?void 0:de.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"بارگزاری تصویر فیش   "}),l("div",{className:"file-upload-div",children:[a(je,{ref:J,name:"fishPic",id:k.toString(),handleGetBase64:ce}),((pe=t==null?void 0:t.attachFile)==null?void 0:pe.fishPic)&&a("i",{className:"fa fa-eye my-eye-icon",onClick:()=>ne("fishPic")})]})]})}),a("div",{className:"col-12",children:l("div",{className:"form-group",children:[a("p",{children:"   تصویر درخواست تمدید یا معرفی نامه محل فعالیت   "}),l("div",{className:"file-upload-div",children:[a(je,{ref:n,name:"moarrefiNameMahaleFaaliyat",id:k.toString(),handleGetBase64:ce}),((De=t==null?void 0:t.attachFile)==null?void 0:De.moarrefiNameMahaleFaaliyat)&&a("i",{className:"fa fa-eye my-eye-icon",onClick:()=>ne("moarrefiNameMahaleFaaliyat")})]}),((Ye=c==null?void 0:c.attachFile)==null?void 0:Ye.length)>0&&a(v,{children:l("div",{className:"validate",children:[a("i",{className:"fa fa-exclamation-triangle"}),l("div",{className:"error-msg",children:[" ",(ge=c==null?void 0:c.attachFile)==null?void 0:ge.map(e=>a("p",{children:e}))," "]})]})})]})}),a("div",{className:"col-12",children:l("div",{className:"form-group",children:[a("span",{children:"صدور کارت صلاحیت راننده به کد ملی "}),l("select",{onChange:e=>{var p;const r=E.filter(o=>{var Y,g,_;return((Y=o==null?void 0:o.details)==null?void 0:Y.nat_num)===e.target.value&&((g=o==null?void 0:o.details)==null?void 0:g.nat_num)!==null&&((_=o==null?void 0:o.details)==null?void 0:_.nat_num)!==void 0})[0];u({...t,driverNatNum:e.target.value,shomareParvane:(p=r==null?void 0:r.details)==null?void 0:p.shomareParvane,driverFullName:r==null?void 0:r.full_name,driverId:r==null?void 0:r._id})},className:"form-control",value:(t==null?void 0:t.driverNatNum)||"1",children:[a("option",{value:"1",children:"---انتخاب کنید---"}),E.map(e=>{var r;if(e.status==="ACTIVE")return a("option",{value:(r=e==null?void 0:e.details)==null?void 0:r.nat_num,children:e==null?void 0:e.full_name})})]}),"و شماره پروانه",a("input",{onChange:e=>u({...t,shomareParvane:e.target.value}),value:(t==null?void 0:t.shomareParvane)||"",type:"text",className:"form-control"}),"با اعتبار",a("input",{onChange:e=>u({...t,year:e.target.value}),value:(t==null?void 0:t.year)||"",type:"text",className:"form-control"}),"از تاریخ",a(H,{onChange:e=>Ue(e!==null?Array.isArray(e)?e[0]:e:null),calendar:V,locale:$,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:_e,placeholder:" تاریخ"}),"الی",a(H,{onChange:e=>Ge(e!==null?Array.isArray(e)?e[0]:e:null),calendar:V,locale:$,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:be,placeholder:" تاریخ"}),"بلامانع است."]})}),a("div",{className:"col-12",children:l("div",{className:"form-group",children:[a("button",{disabled:Object.keys(c).length!==0,onClick:()=>Le(N==="insert"?"insert":"update"),className:`my-btn ${Object.keys(c).length===0?"":"my-btn-inactive"}`,children:N==="insert"?"ثبت":"بروز رسانی"}),a("button",{onClick:()=>B(),className:"my-btn",children:"انصراف"})]})})]})]})]})]})};export{Da as default};
