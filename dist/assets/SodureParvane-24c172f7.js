import{r as t,x as k,u as _e,T as o,f as w,bd as O,j as l,b as a,F as U,aq as Ie,i as G,p as B,k as L,be as Re,bf as Te,bg as Fe,bh as V}from"./index-a6150745.js";import{O as ne,F as xe}from"./FileUpload-024ec978.js";import{u as Oe}from"./useAganceRegister-b0231e2b.js";import{c as z}from"./dateTools-fc0a0a29.js";import{P as Ue}from"./Page403-9b5beb5c.js";import{W as ce}from"./WordProcessor-d5d739a2.js";function Ge(p,m){const[E,N]=t.useState(null),[A,j]=t.useState(null),[d,f]=t.useState({in_progress:!1});function P(){switch(p){case"select":console.log(12548,p),f({...d,in_progress:!0}),k().select_sodureParvane().then(n=>{N(n),j("select")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...d,in_progress:!1})});break;case"insert":m!==null&&(f({...d,in_progress:!0}),k().insert_sodureParvane(m).then(n=>{N(n),j("insert")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...d,in_progress:!1})}));break;case"update":m!==null&&(f({...d,in_progress:!0}),k().update_sodureParvane(m).then(n=>{N(n),j("update")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...d,in_progress:!1})}));break;case"delete":f({...d,in_progress:!0}),k().delete_sodureParvane(m._id).then(n=>{N(n),j("delete")}).catch(n=>{console.error(6001,"Error fetching list:",n)}).finally(()=>{f({...d,in_progress:!1})});break}}return t.useEffect(()=>{p&&P()},[p]),{result:E,type:A,state:d,refreshData:P}}const Be="/assets/sodureParvaneAgance-fd9aa198.docx",Le="/assets/sodureParvaneBar-6312d572.docx",Xe=({handleBackClick:p,title:m})=>{var se,re;m="صدور و تمدید پروانه آژانس";const{authInfo:E}=_e(),[N,A]=t.useState(""),[j,d]=t.useState(!1),[f,P]=t.useState(!1),[n,oe]=t.useState({CREATE:!1,EDIT:!1,DELETE:!1});t.useEffect(()=>{var h,v;let e={CREATE:!1,EDIT:!1,DELETE:!1},r="";(v=(h=E==null?void 0:E.auth)==null?void 0:h.roles)==null||v.map(M=>{M.permissions.map(u=>{u===Re&&(e.CREATE=!0),u===Te&&(e.EDIT=!0,r+="- update -"),u===Fe&&(e.DELETE=!0,r+="- delete -")})}),oe(e),A(r)},[E]);const y=t.useRef(null),W=()=>{y.current&&y.current.clearFileInput()},$=t.useRef(new ne),b=$.current,[le,C]=t.useState(!1),[ie,q]=t.useState(""),[de,Y]=t.useState("select"),[D,_]=t.useState("insert"),[I,ue]=t.useState("insert"),[fe,R]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[J,H]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[me,T]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[K,Q]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[he,F]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[X,Z]=t.useState(o(new Date).format("jYYYY/jMM/jDD")),[Ve,ee]=t.useState(!1),[De,ae]=t.useState({}),[s,i]=t.useState({fishDate:J,fromDate:K,toDate:X});t.useEffect(()=>{i({...s,_id:b.toString()})},[b]);const te=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],pe=[{key:"",name:N},{key:"fishNumber",name:"شماره فیش ",img:!1},{key:"fishPrice",name:"مبلغ "},{key:"fishDate",name:"تاریخ",type:"caleadar",key2:"fromdate"},{key:"aganceName",name:"نام آژانس"},{key:"fromDate",name:" تاریخ شروع "},{key:"toDate",name:"تاریخ پایان"}],[Ye,ge]=t.useState([]),[ve,Ee]=t.useState([]),[S,Ne]=t.useState([]),{result:g}=Oe("select",{}),{result:c,type:je,state:ze,refreshData:We}=Ge(de,s);t.useEffect(()=>{var e;g!=null&&g.status&&Ne((e=g==null?void 0:g.data)==null?void 0:e.data)},[g]),t.useEffect(()=>{var e,r;if(c)switch(je){case"insert":(c==null?void 0:c.status)===200?(w.showSuccess(" صدور پروانه ثبت شد"),Y("select")):w.showError("صدور پروانه ثبت نشد");break;case"update":(c==null?void 0:c.status)===200?(w.showSuccess("صدور پروانه ویرایش شد"),Y("select")):w.showError("صدور پروانه ویرایش نشد");break;case"delete":(c==null?void 0:c.status)===200?(w.showSuccess("صدور پروانه حذف شد"),Y("select")):w.showError("صدور پروانه حذف نشد");break;case"select":Ee((e=c==null?void 0:c.data)==null?void 0:e.data),Se((r=c==null?void 0:c.data)==null?void 0:r.data),x();break}},[c]),t.useEffect(()=>{},[J,K,X]);const Se=e=>{ge(()=>e.map(r=>({...r,aganceName:(S==null?void 0:S.filter(h=>h._id===(r==null?void 0:r.aganceID)))[0].name,fishDate:O(r.fishDate),fromDate:O(r.fromDate),toDate:O(r.toDate)})))},x=()=>{R(o(new Date).format("jYYYY/jMM/jDD")),H(o(new Date).format("jYYYY/jMM/jDD")),T(o(new Date).format("jYYYY/jMM/jDD")),Q(o(new Date).format("jYYYY/jMM/jDD")),F(o(new Date).format("jYYYY/jMM/jDD")),Z(o(new Date).format("jYYYY/jMM/jDD")),W(),C(!1),q(""),$.current=new ne,i({}),ae({}),Y(null),_("insert")},Me=e=>{R(e),H(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),i({...s,fishDate:z(V(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},we=e=>{T(e),Q(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),i({...s,fromDate:z(V(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},Pe=e=>{F(e),Z(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),i({...s,toDate:z(V(e.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},ye=(e,r,h,v)=>{ae(M=>({...M,[r]:e})),v===!1&&i({...s,attachFile:{...s.attachFile,[r]:h}})},ke=e=>{switch(e){case"insert":Y("insert");break;case"update":Y("update");break}},Ae=(e,r)=>{var h,v,M;if(r==="delete"&&(i(e),Y("delete")),r==="update"){W();const u=ve.filter(Ce=>Ce._id===e._id)[0];(h=u==null?void 0:u.attachFile)!=null&&h.fishPic&&((M=y.current)==null||M.setFileInput((v=e==null?void 0:e.attachFile)==null?void 0:v.fishPic)),R(o(u.fishDate).format("jYYYY/jMM/jDD")),T(o(u.fromDate).format("jYYYY/jMM/jDD")),F(o(u.toDate).format("jYYYY/jMM/jDD")),i(u),_("update")}};t.useEffect(()=>{},[s]);const be=e=>{q(De[e]),C(!0)};return l("div",{className:"agance-component SodureParvane-component",children:[p&&a("i",{className:"fa fa-arrow-left back-icon",onClick:p}),le&&l("div",{className:"myAttachImage",children:[a("img",{className:"upload-img",src:ie}),a("i",{className:"fa fa-remove close-icon",onClick:()=>C(!1)})]}),a("div",{className:"row",children:a("div",{className:"col-12",children:a("div",{className:"page-title",children:a("i",{onClick:()=>{ue("insert"),ee(D==="insert")},className:I==="insert"?"active":"",children:D==="insert"?m:"بروزرسانی آژانس"})})})}),a("div",{className:"row",children:l("div",{className:"col-12",children:[a("button",{onClick:()=>d(!0),className:"my-btn",children:"صدور پروانه آژانس"}),j===!0&&a(U,{children:a(ce,{autoReadFile:!0,wordFile:Be,fields:s})}),a("button",{onClick:()=>P(!0),className:"my-btn",children:"صدور پروانه بار"}),f===!0&&a(U,{children:a(ce,{autoReadFile:!0,wordFile:Le,fields:s})})]})}),a("div",{style:{display:`${I==="list"?"":"none"}`},className:"row",children:a("div",{className:"col-12",children:a(Ie,{clickOnRow:Ae,pagesize:te[0].value,items:Ye,options:te,thead:pe})})}),l("div",{style:{display:`${I==="insert"?"":"none"}`},className:"aganceRegister-component",children:[D==="insert"&&n.CREATE===!1&&l("p",{children:[" ",a(Ue,{})]}),(D==="insert"&&n.CREATE===!0||D==="update")&&l(U,{children:[D==="update"&&a("button",{onClick:()=>{x(),_("insert")},className:"my-btn",children:m}),l("div",{className:"row",children:[a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"شماره فیش واریزی "}),a("input",{onChange:e=>i({...s,fishNumber:e.target.value}),value:(s==null?void 0:s.fishNumber)||"",type:"text",className:"form-control"})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:" مبلغ (ریال)"}),a("input",{onChange:e=>i({...s,fishPrice:e.target.value.replace(/,/g,"")}),value:((se=s==null?void 0:s.fishPrice)==null?void 0:se.replace(/\B(?=(\d{3})+(?!\d))/g,","))||"",type:"text",className:"form-control"})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:"تاریخ   "}),a(G,{onChange:e=>Me(e!==null?Array.isArray(e)?e[0]:e:null),calendar:B,locale:L,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:fe,placeholder:"از تاریخ"})]})}),a("div",{className:"col-6",children:l("div",{className:"form-group",children:[a("p",{children:" تصویر فیش   "}),l("div",{className:"file-upload-div",children:[a(xe,{ref:y,name:"fishPic",id:b.toString(),handleGetBase64:ye}),((re=s==null?void 0:s.attachFile)==null?void 0:re.fishPic)&&a("i",{className:"fa fa-eye my-eye-icon",onClick:()=>be("fishPic")})]})]})}),a("div",{className:"col-12",children:l("div",{className:"form-group",children:[a("span",{children:"صدور پروانه نمایندگی آژانس   "}),a("select",{onChange:e=>i({...s,aganceID:e.target.value}),className:"form-control",value:(s==null?void 0:s.aganceID)||"-1",children:S==null?void 0:S.filter(e=>e.status==="1").map(e=>a("option",{value:e._id,children:e.name}))}),"با اعتبار",a("input",{onChange:e=>i({...s,year:e.target.value}),value:(s==null?void 0:s.year)||"",type:"text",className:"form-control"}),"از تاریخ",a(G,{onChange:e=>we(e!==null?Array.isArray(e)?e[0]:e:null),calendar:B,locale:L,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:me,placeholder:"از تاریخ"}),"الی",a(G,{onChange:e=>Pe(e!==null?Array.isArray(e)?e[0]:e:null),calendar:B,locale:L,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:he,placeholder:"تا تاریخ"}),"بلامانع است."]})}),a("div",{className:"col-12",children:l("div",{className:"form-group",children:[a("button",{onClick:()=>ke(D==="insert"?"insert":"update"),className:"my-btn",children:D==="insert"?"ثبت":"بروز رسانی"}),a("button",{onClick:()=>x(),className:"my-btn",children:"انصراف"})]})})]})]})]})]})};export{Xe as default};
