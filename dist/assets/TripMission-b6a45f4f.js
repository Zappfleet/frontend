import{r as d,c as e,j as l,k as Ne,l as Se,p as ge,m as Ce,n as Ee,B as Be,u as ye,o as ue,P as we,q as Re,t as $e,F as A,v as Ge,w as He,x as Ye,y as je,h as k,f as I,z as Ie,A as ze,M as ie,C as Qe,G as We,S as Je,H as _e,I as Ke,J as fe,K as Te,Q as Xe}from"./index-0b0339af.js";import{B as Ze}from"./Breadcrumb-285bd9c2.js";import{a as xe,M as De,u as Me}from"./useConfirmModal-14905c63.js";import{P as ke,M as et,_ as tt,a as st,b as at,c as nt}from"./PassengerServiceRequest-ae001faa.js";import{u as lt}from"./useRestrictionShowRequests-ddb1f2b9.js";import{r as T}from"./renderUi-49d0f127.js";import{F as it}from"./index.esm-8d48e606.js";import{u as ce}from"./useVehicleBasicData-94dff65a.js";import{S as oe}from"./SimpleButton-b54f8e70.js";import{M as ct}from"./MapContainer-3ed43c51.js";import{g as rt,c as ot}from"./carIcon-f5071405.js";import{u as dt}from"./useSocket-f4e4a1bd.js";import{M as ut}from"./MissionHistory-88daccbd.js";import{R as ht}from"./RequestHistory-f9a9be2a.js";import{U as mt,a as _t}from"./UsersSuggestionInput-007d7b87.js";import{T as ft}from"./TitledSparator-58a2d9b8.js";import"./marker-red-cc8765ae.js";import"./BottomSheetModal-f5116632.js";import"./LocationSearch-3b785f69.js";import"./useNeshanApi-2b6ec5ba.js";import"./useFavorite-a4f00f3c.js";import"./useVehicles-d960e0f0.js";import"./useItemSetToggle-41eb145a.js";import"./comments-4f6f4135.js";import"./Comments-f89e8dec.js";import"./useComments-5e918d22.js";import"./Chips-65a50fec.js";import"./SuggestionTextInput-599de7a6.js";const pt=a=>{const[t,o]=d.useState(a.defaultActiveTab),i=c=>{o(c),a.onTabChange(c)};return e("div",{className:"TabLayout-component",children:e("select",{className:"form-select",onChange:c=>i(c.target.value),children:a.tabs.map(c=>e("option",{value:c.key,selected:t===c.key,children:c.label},c.key))})})};const Fe="request.admin",vt="request.dispatch",qe="request.history",Pe="mission.history";const bt=a=>{const[t,o]=d.useState(!1),i=()=>{o(!t)};return l("div",{className:"FloatingButtonWithModal-component",children:[e("i",{className:"fa fa-plus icon",style:{display:t?"none":"block"},onClick:i}),e("i",{className:"fa fa-remove icon",style:{display:t?"block":"none"},onClick:i}),e("div",{style:{display:t?"block":"none"},className:"pishkhan-div",children:a.children})]})},de=a=>{const t=xe();return{ui:e(De,{...t,...a,renderContent:u=>u?l("div",{className:Ne({"lg:w-90":!a.ignoreFixedWidth}),children:[e("label",{className:"inline-block px-1 pt-2 text-sm",children:a.title||"<title>"}),e("div",{children:a.renderContent})]}):""}),show:u=>{t.handle_open(u)},hide:()=>{t.handle_close()}}},Nt=a=>{const{ui:t,show:o}=de({renderContent:l("div",{children:[l("div",{className:"m-2",children:[e("label",{className:"inline-block p-2  text-primary",children:"بازه تاریخی"}),e(Se,{range:!0,dateSeparator:" , ",calendar:ge,locale:Ce,format:"DD MMMM YYYY",className:"datetime-picker",inputClass:"datetime-input"})]}),l("div",{className:"m-2",children:[e("label",{className:"inline-block w-full p-2 text-primary",children:"وضعیت"}),e("div",{className:"flex flex-col",children:Ee.map(([c,u])=>l("span",{className:"inline-flex pl-4",children:[e("label",{htmlFor:c,className:"w-32 cursor-pointer p-1 px-2",children:u}),e("input",{name:`${c}`,id:`${c}`,type:"checkbox",className:"cursor-pointer"})]},c))})]}),e("button",{className:"mt-2 w-full rounded bg-primary p-2 text-white",children:"اعمال"})]})}),i=()=>{o({})};return l("div",{className:Ne("relative w-full rounded-lg shadow",a.className),children:[t,e("input",{type:"text",placeholder:"جستجو...",className:"w-full bg-transparent p-2 pl-9 pr-4 focus:outline-none"}),e(Be,{onClick:i,className:"absolute left-3 top-1/2 -translate-y-1/2 cursor-pointer",size:24})]})};const Ue=a=>{const t=xe();return{ui:e(De,{...t,...a,mode:"fullscreen",renderContent:a.renderContent,zIndex:a.zIndex}),show:u=>{t.handle_open(u)},close:()=>{t.handle_close()}}};function Ae(){const{show:a,ui:t,close:o}=Ue({renderContent:({data:i,submitCallback:c})=>{if(i==null)return"";const u={_id:i._id,service:i.service,datetime:[i.gmt_for_date],...i.details},g=i.locations.map(f=>({lat:f.coordinates[0],lng:f.coordinates[1],...f.meta}));return l("div",{children:[e("h2",{className:"p-2 text-primary",children:"ویرایش درخواست کاربر"}),e(ke,{mode:et,submitCallback:c,initialLocations:g,initialValues:u,className:"!top-12"})]})}});return{showFullScreenModal:a,FullScreenModalUi:t,closeFullScreenModal:o}}const ae="confirm",St="reject",gt=a=>{var V,G;const{requests:t,triggerRemoveFromList:o,update:i}=a.requests,{authInfo:c}=ye(),{result:u,state:g,refreshData:f}=lt("select",6,0),[h,v]=d.useState(100);d.useEffect(()=>{u&&u.data&&u.data[0]&&v(parseInt(u.data[0].value))},[u]),d.useEffect(()=>{},[h]);const p=new Date,E=new Date;E.setDate(p.getDate()+h);const{hasPermitGroup:s,hasPermitFor:w,hasAdminRank:b,permits:y}=ue(),[N,L]=d.useState(!1),[D,F]=d.useState(!1),{showFullScreenModal:O,FullScreenModalUi:J,closeFullScreenModal:K}=Ae(),{show:Q,ui:X}=Me(null);d.useEffect(()=>{L(w([we,Re])),F(w([$e]))},[w]);const Z=m=>{O({data:m,submitCallback:S=>{K(),a.editCallback(S)}})},W=m=>{Q({title:"افزودن درخواست به پیش نویس",desc:"از افزودن درخواست به پیشنویس اطمینان دارید؟",label_confirm:"بله، اضافه کن",label_cancel:"خیر",onConfirm:()=>{var S;(S=a.handle_assignRequestToDraft)==null||S.call(a,m)}})},q=(m,S)=>{console.log(13,m.id,S),Q({title:"تغییر وضعیت درخواست",desc:`از ${S==ae?"تایید":"رد"} درخواست اطمینان دارید؟`,label_confirm:`${S==ae?"تایید کن":"رد کن"}`,label_cancel:"خیر",onConfirm:()=>{k().updateRequestStatus(m._id,S).then(({data:x})=>{S!=ae?o(m._id):i(x)}).catch(x=>{I.showError(x.message)})}})};return l(A,{children:[X,J,(G=(V=t==null?void 0:t.docs)==null?void 0:V.sort((m,S)=>new Date(m.gmt_for_date).getTime()-new Date(S.gmt_for_date).getTime()))==null?void 0:G.map(m=>{var B,$,H,Y,j;let S=new Date(m.gmt_for_date);if(!(S>=Ge(p)&&S<=He(E)))return null;const x=(B=a.draftMission)==null?void 0:B.contains(m);return l("div",{className:`ServiceRequestCard-component ${m.removed?"!pointer-events-none":""} ${x?"selected-border":""} `,children:[l("div",{className:"row",children:[l("div",{className:"col-3",children:[e("p",{className:"title1",children:"درخواست دهنده"}),e("p",{children:($=m.submitted_by)==null?void 0:$.full_name})]}),l("div",{className:"col-3",children:[e("p",{className:"title1",children:"زمان مورد درخواست "}),e("p",{children:Ye(m.gmt_for_date)})]}),(Y=(H=c==null?void 0:c.org)==null?void 0:H.requestsDetailsDisplayColumns)==null?void 0:Y.map(({key:M,title:P})=>l("div",{className:"col-3",children:[l("p",{className:"title1",children:[" ",P,"  "]}),e("p",{children:m.details[M]})]},M))]}),e("div",{className:"row",children:e("div",{className:"col-12",children:e("div",{className:"location-div",children:(j=m.locations)==null?void 0:j.map((M,P)=>l("div",{className:"loc",children:[e("span",{className:"loc-title",children:`ایستگاه ${je(m.locations.length,P)}`}),e("p",{children:M.meta.address})]}))})})}),e("div",{className:"row",children:e("div",{className:"col-12",children:l("div",{className:"buttons",children:[m.status!="PENDING"&&e("span",{children:Ee[m.status]}),N===!0&&e("button",{onClick:()=>Z(m),className:"my-btn",children:"ویرایش"}),N===!1&&e("button",{disabled:!0,className:"my-btn NoPermission",children:"ویرایش"}),!x&&m.status=="CONFIRM"&&e("button",{onClick:()=>W(m),className:"my-btn",children:"افزودن به پیش نویس"}),m.status=="PENDING"&&l(A,{children:[N===!0&&l(A,{children:[e("button",{onClick:()=>q(m,ae),className:"my-btn",children:"تایید درخواست"}),e("button",{onClick:()=>q(m,St),className:"my-btn",children:"رد درخواست"})]}),N===!1&&l(A,{children:[e("button",{disabled:!0,className:"my-btn NoPermission",children:"تایید درخواست"}),e("button",{disabled:!0,className:"my-btn NoPermission",children:"رد درخواست"})]})]})]})})})]},m._id)})]})},z="tab-requests",le="tab-services",ne="tab-fleet",Ct="publish",pe="ready",Le="PUBLISHED";function re(a){var c,u,g,f;const{vehicle:t,basicData:o}=a;if(t==null||o==null)return"";const i=((c=t==null?void 0:t.extra)==null?void 0:c.agency_name)==null;return l("div",{className:"VehicleItem-component",children:[e("div",{children:i?e("span",{className:"name",children:((u=t==null?void 0:t.driver_user)==null?void 0:u.full_name)||"بدون راننده"}):l("span",{children:[e("span",{className:"name",children:"آژانس : "}),e("span",{children:(g=t==null?void 0:t.extra)==null?void 0:g.agency_name})]})}),i&&l(A,{children:[Object.entries(t.extra).map(([h,v])=>e("span",{children:Ie(v,o[`${h}s`])})),"(",(f=t.services)==null?void 0:f.map((h,v)=>{var p,E,s;return l("span",{children:[(E=(p=o==null?void 0:o.services)==null?void 0:p.find)==null?void 0:E.call(p,w=>w.key==h.service).title,v!=((s=t.services)==null?void 0:s.length)-1?" , ":""]})}),")"]})]})}const Et=a=>{var i,c;const{missions:t}=ze({mode:ie,status:Le}),{data:o}=ce();return(c=(i=t==null?void 0:t.data)==null?void 0:i.docs)==null?void 0:c.map(u=>e(A,{children:e(yt,{vehicleBasicData:o,prompt_onMissionReady:a.prompt_onMissionReady,triggerVehicleAssignment:a.triggerVehicleAssignment,mission:u},u._id)}))};function yt(a){const{mission:t,vehicleBasicData:o}=a;return e("div",{className:"bg-white dark:bg-boxdark shadow p-4 rounded-md",children:l("div",{className:"flex flex-col lg:flex-row",children:[e("div",{className:"flex-1 whitespace-nowrap overflow-hidden ",children:t.service_requests.map(i=>{})}),l("div",{className:"lg:w-64",children:[l("div",{onClick:()=>{var i;return(i=a.triggerVehicleAssignment)==null?void 0:i.call(a,a.mission,le)},className:"p-2 mx-1 h-32 relative",children:[T(e("div",{className:"rounded border border-dashed hover:text-primary hover:border-primary absolute top-2 left-0 right-0 bottom-2 cursor-pointer flex items-center justify-center",children:e(it,{className:"duration-300",size:32})})).if(t.vehicle_id==null),T(e("div",{className:"rounded border border-dashed hover:text-primary hover:border-primary absolute top-2 left-0 right-0 bottom-2 cursor-pointer flex-col flex items-center justify-center",children:e(re,{vehicle:t.vehicle_id,basicData:o})})).if(t.vehicle_id!=null)]}),T(e("div",{className:"px-1",children:e(oe,{onClick:()=>{var i;return(i=a.prompt_onMissionReady)==null?void 0:i.call(a,a.mission)},className:"mt-4 mb-2 w-full",children:"تایید نهایی"})})).if(t.status==Le&&t.vehicle_id!=null)]})]})})}const Oe=a=>{var w,b;const{fleetData:t}=a,{data:o}=ce(),i=d.useRef(),[c,u]=d.useState(!1),[g,f]=d.useState(null),[h,v]=d.useState(null);rt(c,g,i,ot,.015),d.useEffect(()=>{var y,N,L,D;if(console.log(7820,(N=(y=t==null?void 0:t.data)==null?void 0:y.vehicles)==null?void 0:N.docs),i){v("driver");const F=[];(D=(L=t==null?void 0:t.data)==null?void 0:L.vehicles)==null||D.docs.map(O=>{(p===null||p===O._id)&&F.push(O._id)}),f(F),u(!0)}},[t,i]);const[p,E]=d.useState(null),s=y=>{E(y),console.log(55,y)};return e("div",{className:"TransportFleet-component",children:l("div",{className:"row",children:[e("div",{className:"col-12 col-md-3",children:l("div",{className:"search-div",children:[p!==null&&e("button",{className:"my-btn",onClick:()=>E(null),children:"نمایش همه"}),e("input",{className:"search",placeholder:"جستجوی رانندگان ..."}),e("div",{className:"driver-list",children:(b=(w=t==null?void 0:t.data)==null?void 0:w.vehicles)==null?void 0:b.docs.map(y=>l("div",{className:"vehicle-list",onClick:()=>{var N;return(N=a.handle_onVehicleClick)==null?void 0:N.call(a,y)},children:[e("i",{className:"fa fa-eye icon-eye",onClick:()=>s(y._id)}),e(re,{vehicle:y,basicData:o})]},y._id))})]})}),e("div",{className:"col-12 col-md-8",children:e("div",{className:"map-div",children:e("div",{className:"location-div",children:e(ct,{mapRef:i})})})})]})})};function wt(){const[a,t]=d.useState({data:null}),o=f=>{var h,v;return((v=(h=a.data)==null?void 0:h.service_requests)==null?void 0:v.find(({request:p})=>p._id==f._id))!=null},i=f=>{const h={...a.data},v=f._id;h.service_requests=h.service_requests.map(({request:p})=>p._id==v?{request:{...f,submitted_by:p.submitted_by}}:{request:p}),t({...a,data:h})},c=f=>{if(a.data==null)return;const h={...a.data};return h.service_requests.push({request:f}),t({...a,data:h}),k().assignRequestToMission(a.data._id,f._id)},u=f=>{if(a.data==null)return;const h={...a.data};return h.service_requests=h.service_requests.filter(({request:v})=>v._id!=f._id),t({...a,data:h}),k().removeRequestFromMission(a.data._id,f._id)},g=()=>{k().getDraftMission().then(({data:f})=>t({data:f})).catch(console.log)};return d.useEffect(()=>{g()},[]),{data:a.data,assignRequestToDraft:c,removeRequestFromDraft:u,contains:o,update:i,reloadDraft:g}}function Ve(){const[a,t]=d.useState({vehicles:null});function o(i){k().getSortedVehicles(i).then(({data:c})=>{t({...a,vehicles:c})}).catch(console.log)}return d.useEffect(()=>{o()},[]),{data:a}}const ve="select-vehicle-for-mission",Rt={status:"PENDING,CONFIRM"},It=()=>{var V,G,m,S,x,B,$,H,Y,j,M,P,_;const[a,t]=d.useState({}),o=Ve(),[i,c]=d.useState({}),{show:u,ui:g}=Me(""),f=n=>{var C,R,ee,te,se;if(((R=(C=o==null?void 0:o.data)==null?void 0:C.vehicles)==null?void 0:R.docs)==null)return;const r={};(se=(te=(ee=o==null?void 0:o.data)==null?void 0:ee.vehicles)==null?void 0:te.docs)==null||se.map(U=>{r[U._id]={vehicle_gps:n[U._id],user_gps:(U==null?void 0:U.driver_user)&&n[U.driver_user._id]}}),t(r)};dt({listeners:{[Qe]:f}});const{data:h}=ce(),{showFullScreenModal:v,FullScreenModalUi:p,closeFullScreenModal:E}=Ae(),s=wt(),w=We({initialParams:Rt,mode:ie}),[b,y]=d.useState(0);d.useEffect(()=>{var r,C;let n=0;(C=(r=s==null?void 0:s.data)==null?void 0:r.service_requests)==null||C.map(R=>{var ee,te,se,U,he,me;console.log(20,R,(se=(te=(ee=R==null?void 0:R.request)==null?void 0:ee.details)==null?void 0:te.userlist)==null?void 0:se.length),n+=(me=(he=(U=R==null?void 0:R.request)==null?void 0:U.details)==null?void 0:he.userlist)==null?void 0:me.length}),y(n)},[s]);const[N,L]=d.useState({visible_tab:z});function D(n,r=!0){L({...N,visible_tab:n}),r&&c({})}function F(n){s.contains(n)&&s.update(n),w.update(n)}async function O(n){v({data:n,submitCallback:r=>{E(),F(r)}})}async function J(n){try{const{data:r}=await s.removeRequestFromDraft(n);w.update(r.serviceRequest,!0),I.showSuccess("درخواست از پیش نویس حذف شد")}catch(r){I.showError(fe(r))}}async function K(n){try{const{data:r}=await s.assignRequestToDraft(n);w.update(r.serviceRequest),I.showSuccess("درخواست به پیش نویس اضافه شد")}catch(r){I.showError(fe(r))}}function Q(n){i.current==ve&&k().assignVehicleToMission(i.mission._id,n._id).then(()=>{i.callback_tab==z&&s.reloadDraft(),I.showSuccess("خودرو به سرویس اختصاص یافت"),D(i.callback_tab),c({})}).catch(r=>{I.showError(r.message)})}function X(n){k().removeVehicleFromMission(n._id).then(()=>{s.reloadDraft(),I.showSuccess("خودرو از سرویس حذف شد")}).catch(r=>{I.showError(r.message)})}function Z(n){u({title:"تایید نهایی سرویس",desc:"به تایید نهایی سرویس اطمینان دارید؟",label_confirm:"تایید شود!",label_cancel:"خیر",onConfirm:()=>{k().updateMissionStatus(n==null?void 0:n._id,pe).then(()=>{I.showSuccess("سرویس ما موفقیت تایید شد."),s.reloadDraft()}).catch(r=>{I.showError(r.message)})}})}function W({setAsReady:n}){u({title:n?"تایید سرویس":"انتشار سرویس",desc:n?"آیا از تایید نهایی سرویس اطمینان دارید؟":"آیا از انتشار سرویس اطمینان دارید؟",label_confirm:n?"تایید شود!":"منتشر شود!",label_cancel:"خیر",onConfirm:()=>{var r;k().updateMissionStatus((r=s==null?void 0:s.data)==null?void 0:r._id,n?pe:Ct).then(()=>{I.showSuccess("اطلاعات با موفقیت ثبت شد"),s.reloadDraft()}).catch(C=>{I.showError(C.message)})}})}function q(n,r){D(ne,!1),c({current:ve,mission:n,callback_tab:r})}return l("div",{className:"RequestManagment-component",children:[g,p,l("div",{className:"row",children:[e("div",{className:"col-12 col-md-8",children:e(Nt,{})}),l("div",{className:"col-12 col-md-4",children:[e("button",{onClick:()=>D(z),className:`link ${N.visible_tab==z?"active-tab":"no-active"}`,children:e("span",{children:"درخواست"})}),e("button",{onClick:()=>D(le),className:` link ${N.visible_tab==le?"active-tab":"no-active"}`,children:e("span",{children:"سرویس"})}),e("button",{onClick:()=>D(ne),className:` link ${N.visible_tab==ne?"active-tab":"no-active"}`,children:e("span",{children:"ناوگان"})})]})]}),e("div",{className:"row",children:l("div",{className:"col-12",children:[T(e(gt,{editCallback:F,requests:w,draftMission:s,handle_assignRequestToDraft:K})).if(N.visible_tab==z),T(e(Et,{prompt_onMissionReady:Z,triggerVehicleAssignment:q})).if(N.visible_tab==le),T(e(Oe,{handle_onVehicleClick:Q,fleetData:o})).if(N.visible_tab==ne)]})}),l(bt,{children:[T(e(Je,{})).if((s==null?void 0:s.data)==null),T(e("label",{className:"lbl-text",children:"هیچ درخواستی در پیش نویس وجود ندارد"})).if(((G=(V=s==null?void 0:s.data)==null?void 0:V.service_requests)==null?void 0:G.length)===0),T(e("div",{children:(S=(m=s==null?void 0:s.data)==null?void 0:m.service_requests)==null?void 0:S.map(({request:n})=>{var r,C;return l("div",{className:"relative mx-2 my-4 rounded py-2 pl-6 pr-10 shadow duration-200",children:[e(_e,{onClick:R=>J(n),className:"absolute right-0 top-0 h-10 w-10 cursor-pointer p-2 hover:text-danger"}),l("div",{className:"relative flex items-center border-b border-gray-2",children:[l("div",{className:"flex flex-col",children:[e("span",{className:"text-primary",children:(r=n.submitted_by)==null?void 0:r.full_name}),e("span",{className:"text-xs",children:Ie(n.service,h.services)})]}),e("div",{className:"py-2 pr-6 text-xs",children:e(Se,{onChange:R=>{},disableDayPicker:!0,calendar:ge,locale:Ce,format:"HH:mm",className:"datetime-picker",inputClass:"datetime-input !w-24 !text-center !text-lg !p-4",plugins:[e(tt,{hideSeconds:!0})],value:n.gmt_for_date})}),e(Ke,{onClick:()=>O(n),className:"absolute left-0 top-0 h-10 w-10 cursor-pointer p-2 hover:text-secondary"})]}),l("div",{children:[e("span",{className:"text-primary",children:"مبدا : "}),e("span",{className:"inline-block pt-2",children:(C=n.locations[0].meta)==null?void 0:C.address})]})]})})})).if((s==null?void 0:s.data)!=null),T(e("div",{onClick:()=>q(s==null?void 0:s.data,z),className:"h-28 px-4 pb-4",children:e("div",{className:"relative mx-1 h-full p-2",children:l("div",{className:"absolute bottom-2 left-0 right-0 top-2 flex cursor-pointer items-center justify-center rounded border border-dashed hover:border-primary hover:text-primary",children:[e(_e,{onClick:n=>{n.stopPropagation(),X(s==null?void 0:s.data)},className:"absolute right-2 top-2 cursor-pointer hover:text-danger"}),e(re,{disabled:b>3,vehicle:(x=s==null?void 0:s.data)==null?void 0:x.vehicle,basicData:h})]})})})).if((($=(B=s==null?void 0:s.data)==null?void 0:B.service_requests)==null?void 0:$.length)>0&&((H=s==null?void 0:s.data)==null?void 0:H.vehicle)!=null),T(l(A,{children:[b<=3&&l("button",{className:"my-btn",onClick:()=>q(s==null?void 0:s.data,z),children:[e("i",{className:"fas fa-car car-icon"})," انتخاب راننده"]}),b>3&&l("div",{className:"alert alert-warning",children:["حداکثر تعداد مسافر 3 نفر است",e("br",{}),l("p",{children:[" تعداد مسافر شما ",b," نفر است"]})]})]})).if(((j=(Y=s==null?void 0:s.data)==null?void 0:Y.service_requests)==null?void 0:j.length)>0&&((M=s==null?void 0:s.data)==null?void 0:M.vehicle)==null),T(l("div",{className:"flex px-4",children:[e(oe,{onClick:()=>W({setAsReady:!0}),className:"m-1 w-full bg-secondary",children:"انتشار"}),e(oe,{onClick:()=>W({setAsReady:!0}),className:"m-1 w-full",children:"تایید نهایی"})]})).if(((_=(P=s==null?void 0:s.data)==null?void 0:P.service_requests)==null?void 0:_.length)>0&&b<=3)]})]})};function Tt(){var P;const[a,t]=d.useState(!1),{hasPermitFor:o}=ue();d.useEffect(()=>{t(o([Te]))},[o]),d.useEffect(()=>{},[a]);const[i,c]=d.useState({activeUser:null}),{authInfo:u}=ye(),[g,f]=d.useState({}),[h,v]=d.useState({}),[p,E]=d.useState({}),[s,w]=d.useState(null),[b,y]=d.useState([]),N=Ve(),{data:L}=ce(),D=_=>{f({...g,[_.target.name]:_.target.value}),console.log(51,g)},F=()=>{f({}),v({}),E({}),w(null),y([]),c({...i,activeUser:null})},O=()=>{console.log(3e3,b);const _=b.map((r,C)=>{const R=at(g,p[b[C]._id],"","");return R.submitted_for=r,R});console.log(441,_);const n={extra:{...g},data:_,vehicle_id:s==null?void 0:s._id};console.log(71,n),k().submitFullMission(n).then(({data:r})=>{console.log(8),I.showSuccess("سرویس با موفقیت ثبت شد"),F(),V(),M()}).catch(r=>{console.log(7),I.showError(r.message)})},J=_=>{w(_),X(),q({})},{ui:K,show:Q,hide:X}=de({title:"انتخاب خودرو",zIndex:9000001,ignoreFixedWidth:!0,renderContent:e("div",{children:e("div",{children:e(Oe,{handle_onVehicleClick:J,fleetData:N})})})}),Z=()=>{Q({}),V()},{ui:W,show:q,hide:V}=de({title:"اطلاعات تکمیلی",zIndex:4,renderContent:l("div",{children:[e(st,{formState:g,fields:(P=u==null?void 0:u.org)==null?void 0:P.additionalTripFields,onInputChange:D}),e(ft,{title:"انتخاب خودرو"}),l("div",{onClick:Z,children:[T(e("i",{className:" fa fa-car"})).if(s==null),e("div",{children:e(re,{vehicle:s,basicData:L})})]}),e("button",{className:"my-btn",onClick:O,children:"ثبت سفر"})]})}),G=()=>{q({})},m=_=>{const n=b.filter(R=>R._id!=_._id);y(n);const r={...h};delete r[_._id],v(r);const C={...p};delete C[_._id],E(C),n.length==0&&c({...i,activeUser:null})},S=_=>{const n=_.target.value;Object.keys(h).length<(n==null?void 0:n.length)&&(n==null||n.map(C=>{h[C._id]==null&&(x(C,{}),B(C,{locations:[]}))})),i.activeUser==null&&$(n==null?void 0:n[0])},x=(_,n)=>{v({...h,[_._id]:n})},B=(_,n)=>{E({...p,[_._id]:n})},$=_=>{c({...i,activeUser:_})},H=(_,n)=>{console.log(5)},{show:Y,ui:j,close:M}=Ue({renderContent:({})=>l("div",{className:"useCreateTripModal-component",children:[e("div",{children:e("div",{children:e(mt,{freeInput:a===!0,hideChips:!0,showListOnTop:!1,externalState:[b,y],permissions:["SERVICE.PERSONAL.SUBMIT"],include_external_base:!0,onChange:S})})}),l("div",{children:[e("div",{children:e(_t,{highlights:i.activeUser?[i.activeUser]:[],smallChips:!0,list:b,onChipsItemClick:$,handleRemove:m})}),l("div",{children:[T(e("div",{className:"search-default-text",children:"مسافر مورد نظر را جستجو کنید ..."})).if((b==null?void 0:b.length)==0),b.map(_=>{var n;if(_._id==((n=i.activeUser)==null?void 0:n._id))return e(ke,{mode:nt,externalState:[h[_._id],r=>x(_,r)],externalUserInput:[p[_._id],r=>B(_,r)],overrideOnSubmit:H},_._id)})]})]}),l("div",{children:[W,e("button",{className:"my-btn regist-btn",onClick:G,children:"ثبت درخواست"})]}),K]})});return{showFullScreenModal:Y,FullScreenModalUi:j,closeFullScreenModal:M}}const be=[{key:Fe,label:"مدیریت درخواست ها"},{key:qe,label:"تاریخچه درخواست ها"},{key:Pe,label:"تاریخچه سرویس ها"}];function as(){const[a,t]=d.useState(be[0].key),o=Tt(),{hasPermitGroup:i,hasPermitFor:c,hasAdminRank:u,permits:g,authInfo:f,type:h}=ue(),[v,p]=d.useState(!1),[E,s]=d.useState(!1),[w,b]=d.useState(!1);return d.useEffect(()=>{},[E]),d.useEffect(()=>{s(c([Te,Xe])),b(c([we,Re])),p(!0)},[c]),d.useEffect(()=>{},[v]),l(A,{children:[v===!1&&e("p",{children:"در حال لود شدن ...."}),v===!0&&l("div",{className:"tripmission-component",children:[e("div",{className:"row",children:e("div",{className:"col-12",children:e(Ze,{pageName:"مدیریت سفر ها"})})}),e("div",{className:"row",children:e("div",{className:"col-12",children:l("div",{className:"NoPermission-div ",children:[E===!0&&l("button",{className:"my-btn flex-center",onClick:()=>{o.showFullScreenModal({data:{}})},children:[e("span",{children:"ایجاد سفر"}),e("i",{className:"fa fa-plus plus flex-center"})]}),E===!1&&e(A,{children:l("button",{disabled:!0,className:"my-btn NoPermission",children:[e("span",{children:"ایجاد سفر"}),e("i",{className:"fa fa-warning info-icon"}),e("div",{className:"info-message alert alert-warning",children:h==="SystemInActive"?"سیستم غیر فعال است":h==="No_WorkingWeek"?"امروز روز کاری نیست":""})]})})]})})}),e("div",{className:"row",children:e("div",{className:"col-12",children:e(pt,{tabs:be,defaultActiveTab:a,onTabChange:t})})}),e("div",{className:"row",children:l("div",{className:"col-12",children:[function(){switch(a){case Fe:return e(It,{});case vt:return"2";case qe:return e(ht,{mode:ie});case Pe:return e(ut,{mode:ie,paging:!1,status:"DONE"})}}(),o.FullScreenModalUi]})})]})]})}export{as as default};
