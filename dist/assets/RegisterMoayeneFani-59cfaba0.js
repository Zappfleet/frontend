import{r as s,y as _,U as k,u as Be,f as j,bd as Je,j as n,c as e,aq as Le,F as d,k as Ke,p as Qe,l as We,bH as Xe,bI as Ze,bJ as ea,bh as aa}from"./index-4b638fea.js";import{O as Ye,F as V}from"./FileUpload-a1b75713.js";import{c as ta}from"./dateTools-587f68dc.js";import{u as la}from"./validation-753ab0c5.js";import{P as na}from"./Page403-34de9313.js";function sa(D,p){const[C,F]=s.useState(null),[b,N]=s.useState(null),[h,u]=s.useState({in_progress:!1});function M(){switch(D){case"select":u({...h,in_progress:!0}),_().select_MoayeneFani().then(i=>{F(i),N("select")}).catch(i=>{console.error(6001,"Error fetching list:",i)}).finally(()=>{u({...h,in_progress:!1})});break;case"insert":p!==null&&(u({...h,in_progress:!0}),_().insert_MoayeneFani(p).then(i=>{F(i),N("insert")}).catch(i=>{console.error(6001,"Error fetching list:",i)}).finally(()=>{u({...h,in_progress:!1})}));break;case"update":p!==null&&(u({...h,in_progress:!0}),_().update_MoayeneFani(p).then(i=>{F(i),N("update")}).catch(i=>{console.error(6001,"Error fetching list:",i)}).finally(()=>{u({...h,in_progress:!1})}));break;case"delete":u({...h,in_progress:!0}),_().delete_MoayeneFani(p._id).then(i=>{F(i),N("delete")}).catch(i=>{console.error(6001,"Error fetching list:",i)}).finally(()=>{u({...h,in_progress:!1})});break}}return s.useEffect(()=>{D&&M()},[D]),{result:C,type:b,state:h,refreshData:M}}const ca={name:{required:!0,showName:""},StartActivityDate:{required:!0,showName:""},activityContext:{required:!0,showName:""},managerFullName:{required:!0,showName:""},managerCodeMelli:{required:!0,pattern:/^[0-9]{10}$/,showName:""},"address.postalCode":{required:!0,pattern:/^[0-9]{10}$/,showName:""},"address.address":{required:!0,showName:""},phone:{required:!0,pattern:/^[0-9]{11}$/,showName:""},managerPhone:{required:!0,pattern:/^[0-9]{11}$/,showName:""},"attachFile.modirPic":{required:!0,showName:""},"attachFile.mojavezSazmanHamlVaNaghl":{required:!0,showName:""},status:{required:!0,showName:""}},xe={status:"1",activityContext:"1",StartActivityDate:k(new Date).format("jYYYY/jMM/jDD"),name:"",managerFullName:"",managerCodeMelli:"",address:{address:"",postalCode:""},managerPhone:"",phone:"",attachFile:{modirPic:"",mojavezSazmanHamlVaNaghl:""}},fa=({handleBackClick:D,title:p})=>{var K,Q,W,X,Z,ee,ae,te,le,ne,se,ce,ie,re,oe,me,de,he,ue,pe,ge,Ne,fe,ve,ye,Se,De,Ce,Fe;p="ثبت مرکز معاینه فنی";const{authInfo:C}=Be(),[F,b]=s.useState(""),[N,h]=s.useState({CREATE:!1,EDIT:!1,DELETE:!1});s.useEffect(()=>{var y,S;let a={CREATE:!1,EDIT:!1,DELETE:!1},m="";(S=(y=C==null?void 0:C.auth)==null?void 0:y.roles)==null||S.map(A=>{A.permissions.map(w=>{w===Xe&&(a.CREATE=!0),w===Ze&&(a.EDIT=!0,m+="- update -"),w===ea&&(a.DELETE=!0,m+="- delete -")})}),h(a),b(m)},[C]);const u=s.useRef(null),M=s.useRef(null),i=s.useRef(null),P=a=>{a.current&&a.current.clearFileInput()},H=s.useRef(new Ye),Y=H.current;s.useEffect(()=>{o({...l,_id:Y.toString()})},[Y]);const[_e,R]=s.useState(!1),[be,U]=s.useState(""),[Pe,f]=s.useState("select"),[g,T]=s.useState("insert"),[x,G]=s.useState("list"),[Re,z]=s.useState(k(new Date).format("jYYYY/jMM/jDD")),[ia,$]=s.useState(k(new Date).format("jYYYY/jMM/jDD")),[ra,E]=s.useState(!1),[Te,B]=s.useState({}),[l,o]=s.useState(xe),{errors:t,refreshData:oa}=la(ca,l);s.useEffect(()=>{},[t]);const J=[{id:1,value:10},{id:2,value:30},{id:3,value:50}],ze=[{key:"",name:F},{key:"name",name:"نام مرکز",img:!1},{key:"activityContext",name:"زمینه فعالیت"},{key:"StartActivityDate",name:" تاریخ شروع  فعالیت",type:"caleadar",key2:"fromdate"},{key:"managerFullName",name:"مدیر"}],[v,Ee]=s.useState([]),[Ie,Oe]=s.useState([]),{result:r,type:qe,state:ma,refreshData:da}=sa(Pe,l);s.useEffect(()=>{var a,m;if(r)switch(qe){case"insert":(r==null?void 0:r.status)===200?(j.showSuccess("مرکز معاینه فنی ثبت شد"),f("select")):j.showError("مرکز معاینه فنی ثبت نشد");break;case"update":(r==null?void 0:r.status)===200?(j.showSuccess("مرکز معاینه فنی ویرایش شد"),f("select")):j.showError("مرکز معاینه فنی ویرایش نشد");break;case"delete":(r==null?void 0:r.status)===200?(j.showSuccess("مرکز معاینه فنی حذف شد"),f("select")):j.showError("مرکز معاینه فنی حذف نشد");break;case"select":Oe((a=r==null?void 0:r.data)==null?void 0:a.data),Ve((m=r==null?void 0:r.data)==null?void 0:m.data),I();break}},[r]);const Ve=a=>{Ee(()=>a.map(m=>({...m,StartActivityDate:Je(m.StartActivityDate)})))},L=()=>{P("modirPic"),P("parvaneNamayandegi"),P("mojavezSazmanHamlVaNaghl")},I=()=>{z(k(new Date).format("jYYYY/jMM/jDD")),$(k(new Date).format("jYYYY/jMM/jDD")),L(),R(!1),U(""),H.current=new Ye,o(xe),B({}),f(null),T("insert")},He=a=>{z(a),$(a.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})),o({...l,StartActivityDate:ta(aa(a.format("YYYY/MM/DD",{calendar:"persian",locale:"fa"})))})},O=(a,m,y,S)=>{B(A=>({...A,[m]:a})),S===!1&&o({...l,attachFile:{...l.attachFile,[m]:y}})},Ue=a=>{switch(a){case"insert":f("insert");break;case"update":f("update");break}},Ge=(a,m)=>{var y,S,A,w,Ae,we,je,ke,Me;if(m==="delete"&&(o(a),f("delete")),m==="update"){L();const c=Ie.filter($e=>$e._id===a._id)[0];(y=c==null?void 0:c.attachFile)!=null&&y.modirPic&&((A=u.current)==null||A.setFileInput((S=c==null?void 0:c.attachFile)==null?void 0:S.modirPic)),(w=c==null?void 0:c.attachFile)!=null&&w.mojavezSazmanHamlVaNaghl&&((we=i.current)==null||we.setFileInput((Ae=c==null?void 0:c.attachFile)==null?void 0:Ae.mojavezSazmanHamlVaNaghl)),(je=c==null?void 0:c.attachFile)!=null&&je.parvaneNamayandegi&&((Me=M.current)==null||Me.setFileInput((ke=c==null?void 0:c.attachFile)==null?void 0:ke.parvaneNamayandegi)),z(k(c.StartActivityDate).format("jYYYY/jMM/jDD")),o(c),T("update")}};s.useEffect(()=>{},[l]);const q=a=>{U(Te[a]),R(!0)};return n("div",{className:"agance-component RegisterMoayeneFani-component",children:[D&&e("i",{className:"fa fa-arrow-left back-icon",onClick:D}),_e&&n("div",{className:"myAttachImage",children:[e("img",{className:"upload-img",src:be}),e("i",{className:"fa fa-remove close-icon",onClick:()=>R(!1)})]}),e("div",{className:"row",children:n("div",{className:"col-12",children:[e("div",{className:"page-title",children:e("i",{onClick:()=>{G("list"),E(!1)},className:x==="list"?"active":"",children:"لیست مرکز معاینه فنی ها"})}),e("div",{className:"page-title",children:e("i",{onClick:()=>{G("insert"),E(g==="insert")},className:x==="insert"?"active":"",children:g==="insert"?p:"بروزرسانی مرکز معاینه فنی"})})]})}),e("div",{style:{display:`${x==="list"?"":"none"}`},className:"row",children:n("div",{className:"col-12",children:[(v==null?void 0:v.length)<=0&&n("p",{style:{marginTop:"40px"},children:[" ","موردی برای نمایش وجود ندارد"]}),(v==null?void 0:v.length)>0&&e(Le,{clickOnRow:Ge,pagesize:J[0].value,items:v,options:J,thead:ze})]})}),n("div",{style:{display:`${x==="insert"?"":"none"}`},className:"aganceRegister-component",children:[g==="insert"&&N.CREATE===!1&&n("p",{children:[" ",e(na,{})]}),(g==="insert"&&N.CREATE===!0||g==="update")&&n(d,{children:[g==="update"&&e("button",{onClick:()=>{I(),T("insert")},className:"my-btn",children:p}),n("div",{className:"row",children:[e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"نام مرکز معاینه فنی"}),e("input",{onChange:a=>o({...l,name:a.target.value}),value:(l==null?void 0:l.name)||"",type:"text",className:"form-control"}),((K=t==null?void 0:t.name)==null?void 0:K.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(Q=t==null?void 0:t.name)==null?void 0:Q.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"تاریخ شروع فعالیت "}),e(Ke,{onChange:a=>He(a!==null?Array.isArray(a)?a[0]:a:null),calendar:Qe,locale:We,className:"datetime-picker",inputClass:"datetime-input !text-center !text-lg !p-4",value:Re,placeholder:" تاریخ"}),((W=t==null?void 0:t.StartActivityDate)==null?void 0:W.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(X=t==null?void 0:t.StartActivityDate)==null?void 0:X.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" زمینه فعالیت (سبک ، سنگین ، سبک و سنگین)  "}),n("select",{onChange:a=>o({...l,activityContext:a.target.value}),className:"form-control",value:(l==null?void 0:l.activityContext)||"خودرو سبک",children:[e("option",{value:"خودرو سبک",children:"خودرو سبک"}),e("option",{value:"خودرو سنگین",children:"خودرو سنگین"}),e("option",{value:"خودرو سبک و سنگین",children:"خودرو سبک و سنگین"})]}),((Z=t==null?void 0:t.activityContext)==null?void 0:Z.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(ee=t==null?void 0:t.activityContext)==null?void 0:ee.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"نام و نام خانوادگی مدیر  "}),e("input",{onChange:a=>o({...l,managerFullName:a.target.value}),value:(l==null?void 0:l.managerFullName)||"",type:"text",className:"form-control"}),((ae=t==null?void 0:t.managerFullName)==null?void 0:ae.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(te=t==null?void 0:t.managerFullName)==null?void 0:te.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" کد ملی مدیر "}),e("input",{onChange:a=>o({...l,managerCodeMelli:a.target.value}),value:(l==null?void 0:l.managerCodeMelli)||"",type:"text",className:"form-control"}),((le=t==null?void 0:t.managerCodeMelli)==null?void 0:le.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(ne=t==null?void 0:t.managerCodeMelli)==null?void 0:ne.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" آدرس و موقعیت مکانی "}),e("input",{onChange:a=>o({...l,address:{...l.address,address:a.target.value}}),value:((se=l==null?void 0:l.address)==null?void 0:se.address)||"",type:"text",className:"form-control"}),((ce=t["address.address"])==null?void 0:ce.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(ie=t["address.address"])==null?void 0:ie.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" کد پستی "}),e("input",{onChange:a=>o({...l,address:{...l.address,postalCode:a.target.value}}),value:((re=l==null?void 0:l.address)==null?void 0:re.postalCode)||"",type:"text",className:"form-control"}),((oe=t["address.postalCode"])==null?void 0:oe.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(me=t["address.postalCode"])==null?void 0:me.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تلفن ثابت "}),e("input",{onChange:a=>o({...l,phone:a.target.value}),value:(l==null?void 0:l.phone)||"",type:"text",className:"form-control"}),((de=t==null?void 0:t.phone)==null?void 0:de.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(he=t==null?void 0:t.phone)==null?void 0:he.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تلفن همراه مدیر "}),e("input",{onChange:a=>o({...l,managerPhone:a.target.value}),value:(l==null?void 0:l.managerPhone)||"",type:"text",className:"form-control"}),((ue=t==null?void 0:t.managerPhone)==null?void 0:ue.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(pe=t==null?void 0:t.managerPhone)==null?void 0:pe.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:"بارگزاری تصویر پروانه مرکز  "}),n("div",{className:"file-upload-div",children:[e(V,{ref:M,name:"parvaneNamayandegi",id:Y.toString(),handleGetBase64:O}),((ge=l==null?void 0:l.attachFile)==null?void 0:ge.parvaneNamayandegi)&&e("i",{className:"fa fa-eye my-eye-icon",onClick:()=>q("parvaneNamayandegi")})]})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تصویر مدیر مرکز   "}),n("div",{className:"file-upload-div",children:[e(V,{ref:u,name:"modirPic",id:Y.toString(),handleGetBase64:O}),((Ne=l==null?void 0:l.attachFile)==null?void 0:Ne.modirPic)&&e("i",{className:"fa fa-eye my-eye-icon",onClick:()=>q("modirPic")})]}),((fe=t["attachFile.modirPic"])==null?void 0:fe.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(ve=t["attachFile.modirPic"])==null?void 0:ve.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" تصویر مجوز  اتحادیه سازمان های حمل و نقل "}),n("div",{className:"file-upload-div",children:[e(V,{ref:i,name:"mojavezSazmanHamlVaNaghl",id:Y.toString(),handleGetBase64:O}),((ye=l==null?void 0:l.attachFile)==null?void 0:ye.mojavezSazmanHamlVaNaghl)&&e("i",{className:"fa fa-eye my-eye-icon",onClick:()=>q("mojavezSazmanHamlVaNaghl")})]}),((Se=t["attachFile.mojavezSazmanHamlVaNaghl"])==null?void 0:Se.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(De=t["attachFile.mojavezSazmanHamlVaNaghl"])==null?void 0:De.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-6",children:n("div",{className:"form-group",children:[e("p",{children:" وضعیت "}),n("select",{onChange:a=>o({...l,status:a.target.value}),className:"form-control",value:l.status||"1",children:[e("option",{value:"1",children:"فعال"}),e("option",{value:"2",children:"غیر فعال"})]}),((Ce=t==null?void 0:t.status)==null?void 0:Ce.length)>0&&e(d,{children:n("div",{className:"validate",children:[e("i",{className:"fa fa-exclamation-triangle"}),n("div",{className:"error-msg",children:[" ",(Fe=t==null?void 0:t.status)==null?void 0:Fe.map(a=>e("p",{children:a}))," "]})]})})]})}),e("div",{className:"col-12",children:n("div",{className:"form-group",children:[e("p",{children:" توضیحات "}),e("textarea",{onChange:a=>o({...l,desc:a.target.value}),value:(l==null?void 0:l.desc)||"",rows:5,className:"form-control"})]})}),e("div",{className:"col-12",children:n("div",{className:"form-group",children:[e("button",{disabled:Object.keys(t).length!==0,onClick:()=>Ue(g==="insert"?"insert":"update"),className:`my-btn ${Object.keys(t).length===0?"":"my-btn-inactive"}`,children:g==="insert"?"ثبت":"بروز رسانی"}),e("button",{onClick:()=>I(),className:"my-btn",children:"انصراف"})]})})]})]})]})]})};export{fa as default};
