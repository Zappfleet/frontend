import{u as I,r as c,E as f,ad as L}from"./index-a6150745.js";import{u as y,l as T}from"./useSocket-8b3223ec.js";import{u as P}from"./useVehicles-13ecc312.js";const x=(a,d,i,E,g)=>{I(),P();const[n,S]=c.useState(null),u=c.useRef({}),t=c.useRef(null),l=e=>{try{S(e)}catch(r){console.error("Error in fleetGpsUpdate:",r)}},s=y({listeners:{[f]:l}}),v=e=>{try{const r=T("http://127.0.0.1:4000",{reconnectionDelayMax:1e4,autoConnect:!0,path:"/api/v2/socket",auth:{token:localStorage.getItem("bearer_token")}});r.on("connect",()=>{let o={};o.ownerID=e,r.emit(L,JSON.stringify(o))}),r.on(f,o=>{console.log("Received GPS response:",o),l(o)}),r.on("disconnect",()=>{console.log("Disconnected from server")})}catch(r){console.error("Error in getLocationFromServer:",r)}};return c.useEffect(()=>{a&&n&&(n==null||n.map(e=>{var o,k;const r=e.owner_id;if(u.current[r]&&((o=i.current)==null||o.remove(u.current[r].marker),delete u.current[r]),e!=null&&e.coordinates&&e.coordinates.length===2){const[_,h]=e.coordinates,p=(k=i.current)==null?void 0:k.addMarker(_,h,!0,E,g);u.current[r]=p}else console.log("No GPS data found for owner_id:",r)}))},[n,i,E,g]),c.useEffect(()=>{if(!(!a||!s.current))return s.current.on(f,l),()=>{s.current&&s.current.off(f,l)}},[a,s]),c.useEffect(()=>(a?t.current=setInterval(()=>{try{v(d)}catch(e){console.error("Error in getLocationFromServer:",e)}},15e3):t.current&&(clearInterval(t.current),t.current=null),()=>{t.current&&(clearInterval(t.current),t.current=null)}),[a,d]),n},D="/assets/carIcon-54f6499e.png";export{D as c,x as g};
